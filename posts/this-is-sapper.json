{"entry":{"title":"This is Sapper!","lang":"en","summary":"This blog has been migrated from Nikola to Sapper. In this article we will go through the main reasons, performance results and some other thoughts","slug":"this-is-sapper","keywords":["Sapper","Svelte","JAMStack"],"filename":"this-is-sapper.adoc","date":"2020-04-19","otherLangs":[]},"html":"<div id=\"toc\" class=\"toc\">\n<div id=\"toctitle\">Table of Contents</div>\n<ul class=\"sectlevel1\">\n<li><a href=\"#_why_leaving_nikola\">Why leaving Nikola</a></li>\n<li><a href=\"#_why_sapper\">Why Sapper</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_dx_developer_experience\">DX: Developer experience</a></li>\n<li><a href=\"#_ux_final_result_of_blogs_in_sapper\">UX: Final result of blogs in Sapper</a></li>\n</ul>\n</li>\n<li><a href=\"#_asciidoctor\">Asciidoctor</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_rollup_plugin_asciidoc_to_the_rescue\">rollup-plugin-asciidoc to the rescue</a></li>\n<li><a href=\"#_rollup_plugin_glob_to_the_rescue\">rollup-plugin-glob to the rescue</a></li>\n</ul>\n</li>\n<li><a href=\"#_syntax_highlighting\">Syntax highlighting</a></li>\n<li><a href=\"#_result\">Result</a></li>\n<li><a href=\"#_testing\">Testing</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_writing_a_test\">Writing a test</a></li>\n</ul>\n</li>\n</ul>\n</div>\n<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>I&#8217;ve migrated my blog infrastructure from <a href=\"https://getnikola.com\" target=\"_blank\" rel=\"noopener\">Nikola</a> + <a href=\"https://en.wikipedia.org/wiki/ReStructuredText\" target=\"_blank\" rel=\"noopener\">reStructuredText</a> to <a href=\"https://sapper.svelte.dev/\" target=\"_blank\" rel=\"noopener\">Sapper</a> + <a href=\"https://asciidoctor.org/\" target=\"_blank\" rel=\"noopener\">Asciidoctor</a>.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_why_leaving_nikola\">Why leaving <a href=\"https://getnikola.com\" target=\"_blank\" rel=\"noopener\">Nikola</a></h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>This blog was powered by <a href=\"https://getnikola.com\" target=\"_blank\" rel=\"noopener\">Nikola</a> since 2014, when <a href=\"https://jamstack.org\" target=\"_blank\" rel=\"noopener\">JAMStack</a> term didn&#8217;t even exist. It really did the job, it has out-of-the-box features that I needed:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Simple multi-lang support.</p>\n</li>\n<li>\n<p><a href=\"https://en.wikipedia.org/wiki/ReStructuredText\" target=\"_blank\" rel=\"noopener\">reStructuredText</a> which I prefer over <a href=\"https://en.wikipedia.org/wiki/Markdown\" target=\"_blank\" rel=\"noopener\">Markdown</a>.</p>\n</li>\n<li>\n<p>It was developed in <a href=\"https://python.org\" target=\"_blank\" rel=\"noopener\">Python</a>, a programming language that I know and I enjoy.</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>I faced some <strong>issues</strong> which annoyed me for quite some time:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>My config file got bloated.</p>\n</li>\n<li>\n<p>It was not easy to modify or create templates, neither to find templates I liked.</p>\n</li>\n<li>\n<p>Site performance was not awesome, my last <a href=\"https://developers.google.com/web/tools/lighthouse\" target=\"_blank\" rel=\"noopener\">Lighthouse audits</a> were around 80, depending on the section. Except SEO section, which was 96.</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_why_sapper\">Why Sapper</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"_dx_developer_experience\">DX: Developer experience</h3>\n<div class=\"paragraph\">\n<p>I already used <a href=\"https://sapper.svelte.dev/\" target=\"_blank\" rel=\"noopener\">Sapper</a> for creating some tiny <a href=\"https://web.dev/progressive-web-apps\" target=\"_blank\" rel=\"noopener\">PWA</a>s <sup class=\"footnote\">[<a id=\"_footnoteref_1\" class=\"footnote\" href=\"#_footnotedef_1\" title=\"View footnote.\">1</a>]</sup>, here 2 examples I developed to learn <a href=\"https://svelte.dev\" target=\"_blank\" rel=\"noopener\">Svelte</a> and <a href=\"https://sapper.svelte.dev/\" target=\"_blank\" rel=\"noopener\">Sapper</a>:</p>\n</div>\n<div class=\"dlist\">\n<dl>\n<dt class=\"hdlist1\"><a href=\"https://currency-loss.netlify.app\" target=\"_blank\" rel=\"noopener\">Currency Exchage Loss Calculator</a></dt>\n<dd>\n<p>It is a helpful application for travellers visiting currency exchange houses. Based on the rate they offer and the money you want ot change it calculates the amount of money that you are losing in that transaction.</p>\n</dd>\n<dt class=\"hdlist1\"><a href=\"https://covid-stats-pwa.netlify.app\" target=\"_blank\" rel=\"noopener\">COVID-19 Stats</a></dt>\n<dd>\n<p>It shows COVID-19 statistics by country and date.</p>\n</dd>\n</dl>\n</div>\n<div class=\"paragraph\">\n<p>While creating those <a href=\"https://web.dev/progressive-web-apps\" target=\"_blank\" rel=\"noopener\">PWA</a>s, developing experience with <a href=\"https://sapper.svelte.dev/\" target=\"_blank\" rel=\"noopener\">Sapper</a>&amp;<a href=\"https://svelte.dev\" target=\"_blank\" rel=\"noopener\">Svelte</a> was quite impressive.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_ux_final_result_of_blogs_in_sapper\">UX: Final result of blogs in Sapper</h3>\n<div class=\"paragraph\">\n<p>Lately I&#8217;ve stumbled upon with some blogs using <a href=\"https://sapper.svelte.dev/\" target=\"_blank\" rel=\"noopener\">Sapper</a> like the own <a href=\"https://sapper.svelte.dev/\" target=\"_blank\" rel=\"noopener\">Sapper</a> blog, <a href=\"https://www.codingwithjesse.com/blog/statically-generating-a-blog-with-svelte-sapper/\" target=\"_blank\" rel=\"noopener\">Coding with Jessie</a> or <a href=\"https://www.swyx.io/writing/svelte-static/\" target=\"_blank\" rel=\"noopener\">swyx.io</a>. Check those blogs by yourself, IMHO user experience is pretty good in all of them.</p>\n</div>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\">Note</div>\n</td>\n<td class=\"content\">\n<a href=\"https://sapper.svelte.dev/\" target=\"_blank\" rel=\"noopener\">Sapper</a> is inspired in <a href=\"https://nextjs.org/\">Next.js</a>, here you can find <a href=\"https://sapper.svelte.dev/docs#Comparison_with_Next_js\">a comparison with this better known JAMStack framework</a>.\n</td>\n</tr>\n</table>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_asciidoctor\"><a href=\"https://asciidoctor.org/\" target=\"_blank\" rel=\"noopener\">Asciidoctor</a></h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>I don&#8217;t have a strong opinion about using <a href=\"https://asciidoctor.org/\" target=\"_blank\" rel=\"noopener\">Asciidoctor</a> or <a href=\"https://en.wikipedia.org/wiki/ReStructuredText\" target=\"_blank\" rel=\"noopener\">reStructuredText</a>, I am comfortable with both of them, but there is more support for <a href=\"https://asciidoctor.org/\" target=\"_blank\" rel=\"noopener\">Asciidoctor</a> in other programming languages, like <a href=\"https://en.wikipedia.org/wiki/JavaScript\" target=\"_blank\" rel=\"noopener\">JavaScript</a>. So basically I switched to <a href=\"https://asciidoctor.org/\" target=\"_blank\" rel=\"noopener\">Asciidoctor</a> because I didn&#8217;t find a <a href=\"https://en.wikipedia.org/wiki/JavaScript\" target=\"_blank\" rel=\"noopener\">JavaScript</a> library able to properly convert <a href=\"https://en.wikipedia.org/wiki/ReStructuredText\" target=\"_blank\" rel=\"noopener\">reStructuredText</a> to <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML\" target=\"_blank\" rel=\"noopener\">HTML</a>.</p>\n</div>\n<div class=\"paragraph\">\n<p>The main issue I found not using <a href=\"https://en.wikipedia.org/wiki/Markdown\" target=\"_blank\" rel=\"noopener\">Markdown</a> was the lack of <a href=\"https://rollupjs.org\" target=\"_blank\" rel=\"noopener\">Rollup</a> plugins to convert <a href=\"https://asciidoctor.org/\" target=\"_blank\" rel=\"noopener\">Asciidoctor</a> to <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML\" target=\"_blank\" rel=\"noopener\">HTML</a>, so I just created one, <a href=\"https://github.com/carlosvin/rollup-plugin-asciidoc\" target=\"_blank\" rel=\"noopener\">rollup-plugin-asciidoc</a>. Implementation was quite simple, the plugin is just using <a href=\"https://asciidoctor.org/docs/asciidoctor.js/\" target=\"_blank\" rel=\"noopener\">Asciidoctor.js</a> <a href=\"https://en.wikipedia.org/wiki/JavaScript\" target=\"_blank\" rel=\"noopener\">JavaScript</a> library to convert the text input to html.</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_rollup_plugin_asciidoc_to_the_rescue\"><a href=\"https://github.com/carlosvin/rollup-plugin-asciidoc\" target=\"_blank\" rel=\"noopener\">rollup-plugin-asciidoc</a> to the rescue</h3>\n<div class=\"admonitionblock tip\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\">Tip</div>\n</td>\n<td class=\"content\">\nWith <a href=\"https://github.com/carlosvin/rollup-plugin-asciidoc\" target=\"_blank\" rel=\"noopener\">rollup-plugin-asciidoc</a> we can import <a href=\"https://asciidoctor.org/\" target=\"_blank\" rel=\"noopener\">Asciidoctor</a> files in our blog and <a href=\"https://rollupjs.org\" target=\"_blank\" rel=\"noopener\">Rollup</a> will convert them to <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML\" target=\"_blank\" rel=\"noopener\">HTML</a>.\n</td>\n</tr>\n</table>\n</div>\n<div class=\"sect3\">\n<h4 id=\"_example\">Example</h4>\n<div class=\"listingblock\">\n<div class=\"title\">a-blog-post.adoc</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-adoc\" data-lang=\"adoc\"><span class=\"hljs-section\">= Post title</span>\n<span class=\"hljs-meta\">:date:</span> 2019-11-11\n\nSuch a post!</code></pre>\n</div>\n</div>\n<div class=\"listingblock\">\n<div class=\"title\">With <a href=\"https://github.com/carlosvin/rollup-plugin-asciidoc\" target=\"_blank\" rel=\"noopener\">rollup-plugin-asciidoc</a> we can import <a href=\"https://asciidoctor.org/\" target=\"_blank\" rel=\"noopener\">Asciidoctor</a> files one by one.</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-javascript\" data-lang=\"javascript\"><span class=\"hljs-keyword\">import</span> doc <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'./a-blog-post.adoc'</span>;\n\n<span class=\"hljs-built_in\">console</span>.log(doc);</code></pre>\n</div>\n</div>\n<div class=\"listingblock\">\n<div class=\"title\">Output</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-javascript\" data-lang=\"javascript\">{\n  <span class=\"hljs-attr\">meta</span>: {\n    <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">\"Post title\"</span>,\n    <span class=\"hljs-attr\">date</span>: <span class=\"hljs-string\">\"2019-11-11\"</span>\n  },\n  <span class=\"hljs-attr\">html</span>: <span class=\"hljs-string\">\"&lt;p&gt;Such a post!&lt;/p&gt;\"</span>\n}</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Importing files one by one is not really convenient for a blog where we have many files which we don&#8217;t want to import manually.</p>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_rollup_plugin_glob_to_the_rescue\"><a href=\"https://www.npmjs.com/package/rollup-plugin-glob\" target=\"_blank\" rel=\"noopener\">rollup-plugin-glob</a> to the rescue</h3>\n<div class=\"paragraph\">\n<p>With <a href=\"https://www.npmjs.com/package/rollup-plugin-glob\" target=\"_blank\" rel=\"noopener\">rollup-plugin-glob</a> we can import all the files in a directory by extension, so now we have our index of posts automatically converted to <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML\" target=\"_blank\" rel=\"noopener\">HTML</a>.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-javascript\" data-lang=\"javascript\"><span class=\"hljs-keyword\">import</span> allAdoc <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'../posts/**/*.adoc'</span>;\n\nallAdoc.forEach(<span class=\"hljs-function\"><span class=\"hljs-params\">post</span> =&gt;</span> <span class=\"hljs-keyword\">this</span>._add(post));</code></pre>\n</div>\n</div>\n<div class=\"listingblock\">\n<div class=\"title\">Output: List of posts already converted to HTML</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-javascript\" data-lang=\"javascript\">{ <span class=\"hljs-attr\">meta</span>: { <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">\"Post title\"</span>, <span class=\"hljs-attr\">date</span>: <span class=\"hljs-string\">\"2019-11-11\"</span> },\n  <span class=\"hljs-attr\">html</span>: <span class=\"hljs-string\">\"&lt;p&gt;Post 1.&lt;/p&gt;\"</span>\n}\n{ <span class=\"hljs-attr\">meta</span>: { <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">\"Post title\"</span>, <span class=\"hljs-attr\">date</span>: <span class=\"hljs-string\">\"2020-02-22\"</span> },\n  <span class=\"hljs-attr\">html</span>: <span class=\"hljs-string\">\"&lt;h2&gt;Title post&lt;/h2&gt;&lt;p&gt;This is a sample post...&lt;/p&gt;\"</span>\n}\n<span class=\"hljs-comment\">// ...</span></code></pre>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_syntax_highlighting\">Syntax highlighting</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>My blog is mainly about Software Engineering, so I have a strong requirement, code highlighting.</p>\n</div>\n<div class=\"paragraph\">\n<p>At the begging I started using <a href=\"https://highlightjs.org/usage/\" target=\"_blank\" rel=\"noopener\">highlightjs library from a CDN</a> for source code highlighting. We use imported library to parse the source code and for styling the result we need to import also a CSS file.</p>\n</div>\n<div class=\"paragraph\">\n<p>Later I realized that we can do the parsing work when we compile <a href=\"https://asciidoctor.org/\" target=\"_blank\" rel=\"noopener\">Asciidoctor</a> to <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML\" target=\"_blank\" rel=\"noopener\">HTML</a> in <a href=\"https://github.com/carlosvin/rollup-plugin-asciidoc\" target=\"_blank\" rel=\"noopener\">rollup-plugin-asciidoc</a> implementation, so we don&#8217;t have to download the <a href=\"https://en.wikipedia.org/wiki/JavaScript\" target=\"_blank\" rel=\"noopener\">JavaScript</a> file.</p>\n</div>\n<div class=\"admonitionblock tip\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\">Tip</div>\n</td>\n<td class=\"content\">\nDoing code highlighting transformation during the site building phase we are improving application performance and reducing bundle size.\n</td>\n</tr>\n</table>\n</div>\n<div class=\"paragraph\">\n<p>Code highlighting transformation during site build step bring 2 great benefits:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Reducing bundle size: we don&#8217;t need the 27KB of <a href=\"https://highlightjs.org/usage/\">highlightjs javascript library</a>.</p>\n</li>\n<li>\n<p>Improving performance: source code parsing is done only once while site is built.</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_result\">Result</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>I still have some <a href=\"https://github.com/carlosvin/carlosvin.github.io/issues\" target=\"_blank\" rel=\"noopener\">work to do</a>, but so far I have a blog with following features:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Automated generation of <a href=\"/sitemap.xml\">Sitemap</a> and <a href=\"/rss\">RSS feed</a>.</p>\n</li>\n<li>\n<p>Multi-language support (I still have to translate some texts).</p>\n</li>\n<li>\n<p>Syntax highlighting.</p>\n</li>\n<li>\n<p>100 score in <a href=\"https://developers.google.com/web/tools/lighthouse\" target=\"_blank\" rel=\"noopener\">Lighthouse audits</a>.</p>\n</li>\n</ul>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/lighthouse-results.webp\" alt=\"lighthouse score\" width=\"95%\">\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_testing\">Testing</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>I am a big fan of automated testing, I don&#8217;t love writing them, but I think they are the best way to know if your software is behaving as expected.</p>\n</div>\n<div class=\"paragraph\">\n<p><a href=\"https://sapper.svelte.dev/\" target=\"_blank\" rel=\"noopener\">Sapper</a> template brings a pre-configured simple end to end test. It is using <a href=\"https://www.cypress.io/\" target=\"_blank\" rel=\"noopener\">Cypress</a>, a E2E <sup class=\"footnote\">[<a id=\"_footnoteref_2\" class=\"footnote\" href=\"#_footnotedef_2\" title=\"View footnote.\">2</a>]</sup> testing framework which has a nicer developer experience than <a href=\"https://www.selenium.dev/\" target=\"_blank\" rel=\"noopener\">Selenium</a>, although I think it is still far of being <a href=\"https://blog.logrocket.com/cypress-io-the-selenium-killer/\" target=\"_blank\" rel=\"noopener\">the Selenium Killer</a>.</p>\n</div>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\">Note</div>\n</td>\n<td class=\"content\">\nNot yet a <a href=\"https://www.selenium.dev/\" target=\"_blank\" rel=\"noopener\">Selenium</a> killer: The main reason is that <a href=\"https://www.cypress.io/\" target=\"_blank\" rel=\"noopener\">Cypress</a> lacks of some features you might need, depending on the project, like cross-browser and cross-platform testing offered by <a href=\"https://www.selenium.dev/documentation/en/grid/components_of_a_grid/\" target=\"_blank\" rel=\"noopener\">Selenium grid</a>.\n</td>\n</tr>\n</table>\n</div>\n<div class=\"paragraph\">\n<p>I&#8217;ve added some tests for this blog (and I plan to add more), I&#8217;ve tested that post header information is correct, that redirection logic is working, main navigation works and metadata is correct, in a couple of hour and including bugfixes! That&#8217;s why I love writing tests with <a href=\"https://www.cypress.io/\" target=\"_blank\" rel=\"noopener\">Cypress</a>, the productivity.</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_writing_a_test\">Writing a test</h3>\n<div class=\"paragraph\">\n<p>It works pretty much as Selenium.\n. Opens a page\n. Access to an element using <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Element/id\" target=\"_blank\" rel=\"noopener\">HTML identifier</a> (<code>#element-id</code>), <a href=\"https://en.wikipedia.org/wiki/XPath\" target=\"_blank\" rel=\"noopener\">XPath</a> (<code>/a[@title='link title']</code>) or <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Selectors\" target=\"_blank\" rel=\"noopener\">CSS selector</a> (<code>div &gt; a.cssClass</code>).\n. Interact with selected element on the page.\n. Validate expectations.</p>\n</div>\n<div class=\"paragraph\">\n<p>You can find this blog tests at <a href=\"https://github.com/carlosvin/carlosvin.github.io/tree/site/cypress/integration\">cypress/integration</a> folder.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"title\">Simple test example</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-javascript\" data-lang=\"javascript\">it(<span class=\"hljs-string\">'Header'</span>, () =&gt; {\n  cy.visit(<span class=\"hljs-string\">'/posts/this-is-sapper/en'</span>) <b class=\"conum\">(1)</b>\n  cy.get(<span class=\"hljs-string\">'.subtitle .date'</span>).contains(<span class=\"hljs-string\">'19/04/2020'</span>) <b class=\"conum\">(2)</b>\n});</code></pre>\n</div>\n</div>\n<div class=\"colist arabic\">\n<ol>\n<li>\n<p>It navigates to the post absolute path</p>\n</li>\n<li>\n<p>It checks that date is correct in subtitle</p>\n</li>\n</ol>\n</div>\n</div>\n</div>\n</div>\n<div id=\"footnotes\">\n<hr>\n<div class=\"footnote\" id=\"_footnotedef_1\">\n<a href=\"#_footnoteref_1\">1</a>. Progressive Web Application\n</div>\n<div class=\"footnote\" id=\"_footnotedef_2\">\n<a href=\"#_footnoteref_2\">2</a>. End to end\n</div>\n</div>"}