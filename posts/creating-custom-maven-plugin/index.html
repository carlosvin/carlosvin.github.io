<!DOCTYPE html>
<html prefix="" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Example to understand Maven plugins concepts and how to create a custom Maven plugin from scratch">
<meta name="viewport" content="width=device-width">
<title>Example how to create custom Maven Plugin | Carlos says "bla bla"</title>
<link href="../../assets/css/all.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS (es)" href="../../es/rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" href="../../rss.xml">
<link rel="canonical" href="https://carlosvin.github.io/posts/creating-custom-maven-plugin/">
<!--[if lt IE 9]><script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-1328360-10"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-1328360-10');
</script><meta name="author" content="Carlos Martín Sánchez">
<link rel="prev" href="../choosing-modern-cpp-stack/" title="Choosing a Modern C++ stack" type="text/html">
<link rel="next" href="../creating-custom-maven-plugin-default/" title="Custom Maven Plugin: Override default build lifecycle" type="text/html">
<meta property="og:site_name" content='Carlos says "bla bla"'>
<meta property="og:title" content="Example how to create custom Maven Plugin">
<meta property="og:url" content="https://carlosvin.github.io/posts/creating-custom-maven-plugin/">
<meta property="og:description" content="Example to understand Maven plugins concepts and how to create a custom Maven plugin from scratch">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2018-03-11T19:00:00+01:00">
<meta property="article:tag" content="Build Systems">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Maven">
<meta property="article:tag" content="Maven Plugins">
<meta property="article:tag" content="maven-site-plugin">
<link rel="alternate" hreflang="es" href="../../es/posts/creating-custom-maven-plugin/">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
            styles, `#sidebar-checkbox` for behavior. -->
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><!-- Toggleable sidebar --><div class="sidebar" id="sidebar">
        <div class="sidebar-item">
<form class="form-inline" role="search" action="https://duckduckgo.com/">
  <div class="form-group">
    <input type="search" name="q" class="form-control" placeholder="Search on Carlos says " bla><input type="hidden" name="sites" value="https://carlosvin.github.io/">
</div>
  <button type="submit" class="search-icon">
    <svg viewbox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></button>
</form>
</div>
        
    <nav id="menu" role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="../../archive.html">Archives</a>
        <a class="sidebar-nav-item" href="../../categories/index.html">Tags</a>
        <a class="sidebar-nav-item" href="../../rss.xml">RSS</a>
        <a class="sidebar-nav-item" href="../../es">En Español</a>
    
    
    </nav><div class="sidebar-item">
            <!-- Go to www.addthis.com/dashboard to customize your tools -->
            <div class="addthis_inline_follow_toolbox"></div>
        </div>
        </div>
    

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          
    <h3 id="brand" class="masthead-title">
      <a href="https://carlosvin.github.io/" title="Carlos says " bla rel="home">Carlos says "bla bla"</a>
    </h3>

        </div>
      </div>

      <div class="container content" id="content">
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="post-title p-name entry-title" itemprop="headline name"><a href="." class="u-url">Example how to create custom Maven Plugin</a></h1>

        <div class="metadata">
            <p class="dateline"><a href="." rel="bookmark"><time class="post-date published dt-published" datetime="2018-03-11T19:00:00+01:00" itemprop="datePublished" title="3/11/18, 7:00 PM">3/11/18, 7:00 PM</time></a></p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/creating-custom-maven-plugin.html">Comments</a>


                <meta name="description" itemprop="description" content="Example to understand Maven plugins concepts and how to create a custom Maven plugin from scratch"></p>
</div>
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>Maven has lots of plugins to assist you in project construction, testing, packaging and deployment. For example if you want to compile C++ code instead of Java, you can use <a class="reference external" href="https://www.mojohaus.org/maven-native/native-maven-plugin/">native-maven-plugin</a> . But what if you need something more specific? Then you can create a custom Maven plugin.</p>
<p>I will explain how to create a simple custom maven plugin to generate static blog site from Markdown files. I know we can already do that with <a class="reference external" href="https://maven.apache.org/plugins/maven-site-plugin/examples/creating-content.html">maven-site-plugin</a> since version 3.3, I will just use it for learning purposes.</p>
<p>You can find whole source code example at <a class="reference external" href="https://github.com/carlosvin/blog-maven-plugin">https://github.com/carlosvin/blog-maven-plugin</a>.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#maven-plugin-concepts" id="id2">Maven plugin concepts</a></p></li>
<li>
<p><a class="reference internal" href="#create-your-custom-plugin-site-lifecycle" id="id3">Create your custom plugin (Site Lifecycle)</a></p>
<ul>
<li><p><a class="reference internal" href="#project-structure" id="id4">Project structure</a></p></li>
<li><p><a class="reference internal" href="#dependency-injection" id="id5">Dependency Injection</a></p></li>
<li>
<p><a class="reference internal" href="#write-a-custom-mojo" id="id6">Write a custom Mojo</a></p>
<ul>
<li><p><a class="reference internal" href="#implement-mojo-interface" id="id7">1. Implement Mojo interface</a></p></li>
<li><p><a class="reference internal" href="#configure-mojo-with-java-5-annotations" id="id8">2. Configure Mojo with Java 5 annotations</a></p></li>
<li><p><a class="reference internal" href="#implement-execute-method" id="id9">3. Implement <em>execute</em> method</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#unit-tests" id="id10">Unit tests</a></p></li>
<li>
<p><a class="reference internal" href="#integration-tests" id="id11">Integration tests</a></p>
<ul>
<li><p><a class="reference internal" href="#how-does-invoker-plugin-work" id="id12">How does Invoker Plugin work?</a></p></li>
<li><p><a class="reference internal" href="#configure-invoker-plugin" id="id13">Configure Invoker Plugin</a></p></li>
<li>
<p><a class="reference internal" href="#create-an-integration-test-project" id="id14">Create an Integration Test Project</a></p>
<ul>
<li><p><a class="reference internal" href="#pom-xml-arrange" id="id15">pom.xml (Arrange)</a></p></li>
<li><p><a class="reference internal" href="#invoker-properties-act" id="id16">invoker.properties (Act)</a></p></li>
<li><p><a class="reference internal" href="#verify-groovy-assert" id="id17">verify.groovy (Assert)</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<!-- TEASER_END -->
<div class="section" id="maven-plugin-concepts">
<h2><a class="toc-backref" href="#id2">Maven plugin concepts</a><a href="#maven-plugin-concepts" class="headerlink" title="Permalink to this heading">¶</a></h2>
<dl>
<dt><a class="reference external" href="https://maven.apache.org/plugin-developers/index.html">Mojo</a></dt>
<dd>
<p>An executable goal in Maven, e.g: <code class="docutils literal">mvn <span class="pre">your-plugin:your-mojo</span></code> will execute a maven goal <code class="docutils literal"><span class="pre">your-mojo</span></code> declared as part of <code class="docutils literal"><span class="pre">your-plugin</span></code>.</p>
</dd>
<dt>Goal</dt>
<dd>
<p>It is equivalent to <a class="reference external" href="https://maven.apache.org/plugin-developers/index.html">Mojo</a> execution</p>
</dd>
<dt>Lifecycle</dt>
<dd>
<p>It is a well-defined sequence of phases. Each phase consists of a sequence of goals.
Let's see an example of lifecycle, e.g: <code class="docutils literal">FooLifecycle</code> has <code class="docutils literal">clean</code>, <code class="docutils literal">prepare</code> and <code class="docutils literal">assemble</code> phases. Each of those phases has one of more goals. <strong>FooLifecycle</strong>:</p>
<ul class="simple">
<li><dl class="simple">
<dt>clean</dt>
<dd><ul>
<li><p><strong>rmSources</strong>: a goal to remove source files</p></li>
<li><p><strong>rmBuild</strong>: a goal to remove files in cache directory</p></li>
</ul></dd>
</dl></li>
<li><dl class="simple">
<dt>prepare</dt>
<dd><ul>
<li><p><strong>installDependencies</strong>: a goal to download dependencies for the project</p></li>
</ul></dd>
</dl></li>
<li><dl class="simple">
<dt>assemble</dt>
<dd><ul>
<li><p><strong>build</strong>: a goal to compile source files</p></li>
</ul></dd>
</dl></li>
</ul>
<p>To define a custom lifecycle as previous we will use <code class="docutils literal"><span class="pre">src/main/resources/META-INF/plexus/components.xml</span></code>, we will speak about that file in following sections.
Normally is enough to override <a class="reference external" href="https://maven.apache.org/ref/3.5.3/maven-core/lifecycles.html">predefined lifecycles</a>, in this example, we will override site lifecycle.</p>
</dd>
</dl>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>You can find an introduction to Maven lifecycles at <a class="reference external" href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html">https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html</a></p>
</div>
</div>
<div class="section" id="create-your-custom-plugin-site-lifecycle">
<h2><a class="toc-backref" href="#id3">Create your custom plugin (Site Lifecycle)</a><a href="#create-your-custom-plugin-site-lifecycle" class="headerlink" title="Permalink to this heading">¶</a></h2>
<p>The plugin we are about to explain will <a class="reference external" href="https://maven.apache.org/ref/3.5.3/maven-core/lifecycles.html#site_Lifecycle">override site lifecycle</a>, which has only 2 default phases, so when we run <code class="docutils literal">mvn site</code> using our new custom plugin it will execute the goals we are about to create.</p>
<p>Our plugin will work with <code class="docutils literal">md</code> file bindings: It will build the project and deploy it using <a class="reference external" href="https://maven.apache.org/plugins/maven-deploy-plugin/">maven deployment plugin</a>.</p>
<div class="section" id="project-structure">
<h3><a class="toc-backref" href="#id4">Project structure</a><a href="#project-structure" class="headerlink" title="Permalink to this heading">¶</a></h3>
<dl class="simple">
<dt><code class="docutils literal">src/main/java</code></dt>
<dd>
<p>Where Java source code is</p>
</dd>
<dt><code class="docutils literal"><span class="pre">src/main/resources/META-INF/plexus/components.xml</span></code></dt>
<dd>
<p>file to create/override maven lifecycles and artifact types. Here we can specify which goals will be executed when for an artifact type, for example, we can say that for an artifact of type <code class="docutils literal">whatever</code> when we run <code class="docutils literal">mvn foo</code> it will verify the files, run tests, run linter, compile and zip al generated files.</p>
</dd>
<dt><code class="docutils literal">src/test/java</code></dt>
<dd>
<p>Unit tests folder</p>
</dd>
<dt><code class="docutils literal">src/it</code></dt>
<dd>
<p>Folder with all integration tests. Those integration tests are running actual projects and checking that outputs are as expected.</p>
</dd>
<dt><code class="docutils literal">pom.xml</code></dt>
<dd>
<p>File to with Maven project description <a class="reference external" href="https://maven.apache.org/guides/introduction/introduction-to-the-pom.html">(Project Object Model)</a></p>
</dd>
</dl>
</div>
<div class="section" id="dependency-injection">
<h3><a class="toc-backref" href="#id5">Dependency Injection</a><a href="#dependency-injection" class="headerlink" title="Permalink to this heading">¶</a></h3>
<p>Maven has finally chosen <a class="reference external" href="https://maven.apache.org/maven-jsr330.html">JSR-330</a> as <a class="reference external" href="https://javax-inject.github.io/javax-inject/">dependency injection standard</a> (previously it was Plexus Annotations API).</p>
<p>To use dependency injection with Maven we have to:</p>
<ol class="arabic simple">
<li><p>Add <code class="docutils literal">javax.inject</code> dependency to <code class="docutils literal">pom.xml</code> so we can use <code class="docutils literal">@Inject</code>, <code class="docutils literal">@Named</code>, and <code class="docutils literal">@Singleton</code> annotations in plugin implementation Java code.</p></li>
</ol>
<pre class="code xml"><a name="rest_code_3a837c10ab1f4be9a8318875a9b46bbb-1"></a><span class="nt">&lt;dependency&gt;</span>
<a name="rest_code_3a837c10ab1f4be9a8318875a9b46bbb-2"></a>    <span class="nt">&lt;groupId&gt;</span>javax.inject<span class="nt">&lt;/groupId&gt;</span>
<a name="rest_code_3a837c10ab1f4be9a8318875a9b46bbb-3"></a>    <span class="nt">&lt;artifactId&gt;</span>javax.inject<span class="nt">&lt;/artifactId&gt;</span>
<a name="rest_code_3a837c10ab1f4be9a8318875a9b46bbb-4"></a>    <span class="nt">&lt;version&gt;</span>1<span class="nt">&lt;/version&gt;</span>
<a name="rest_code_3a837c10ab1f4be9a8318875a9b46bbb-5"></a><span class="nt">&lt;/dependency&gt;</span>
</pre>
<ol class="arabic simple" start="2">
<li><p>Set up the sisu-maven-plugin to index the JSR-330 components you want made available to Maven.</p></li>
</ol>
<pre class="code xml"><a name="rest_code_80c5404256f8422fa8fb9f08ed6efa27-1"></a><span class="nt">&lt;plugin&gt;</span>
<a name="rest_code_80c5404256f8422fa8fb9f08ed6efa27-2"></a>    <span class="nt">&lt;groupId&gt;</span>org.eclipse.sisu<span class="nt">&lt;/groupId&gt;</span>
<a name="rest_code_80c5404256f8422fa8fb9f08ed6efa27-3"></a>    <span class="nt">&lt;artifactId&gt;</span>sisu-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
<a name="rest_code_80c5404256f8422fa8fb9f08ed6efa27-4"></a>    <span class="nt">&lt;version&gt;</span>0.3.3<span class="nt">&lt;/version&gt;</span>
<a name="rest_code_80c5404256f8422fa8fb9f08ed6efa27-5"></a>    <span class="nt">&lt;executions&gt;</span>
<a name="rest_code_80c5404256f8422fa8fb9f08ed6efa27-6"></a>        <span class="nt">&lt;execution&gt;</span>
<a name="rest_code_80c5404256f8422fa8fb9f08ed6efa27-7"></a>            <span class="nt">&lt;id&gt;</span>generate-index<span class="nt">&lt;/id&gt;</span>
<a name="rest_code_80c5404256f8422fa8fb9f08ed6efa27-8"></a>            <span class="nt">&lt;goals&gt;</span>
<a name="rest_code_80c5404256f8422fa8fb9f08ed6efa27-9"></a>                <span class="nt">&lt;goal&gt;</span>main-index<span class="nt">&lt;/goal&gt;</span>
<a name="rest_code_80c5404256f8422fa8fb9f08ed6efa27-10"></a>            <span class="nt">&lt;/goals&gt;</span>
<a name="rest_code_80c5404256f8422fa8fb9f08ed6efa27-11"></a>        <span class="nt">&lt;/execution&gt;</span>
<a name="rest_code_80c5404256f8422fa8fb9f08ed6efa27-12"></a>    <span class="nt">&lt;/executions&gt;</span>
<a name="rest_code_80c5404256f8422fa8fb9f08ed6efa27-13"></a><span class="nt">&lt;/plugin&gt;</span>
</pre>
<ol class="arabic simple" start="3">
<li><p>Add annotations to your Mojo, e.g:</p></li>
</ol>
<pre class="code java"><a name="rest_code_d20b44fbfee941a78c180aca444c1f39-1"></a><span class="c1">// This annotation is not a dependency injection one, we will explain later what it is for</span>
<a name="rest_code_d20b44fbfee941a78c180aca444c1f39-2"></a><span class="nd">@Mojo</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"build"</span><span class="p">,</span> <span class="n">defaultPhase</span> <span class="o">=</span> <span class="n">LifecyclePhase</span><span class="p">.</span><span class="na">COMPILE</span><span class="p">)</span>
<a name="rest_code_d20b44fbfee941a78c180aca444c1f39-3"></a><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BuildMojo</span> <span class="kd">extends</span> <span class="n">AbstractMojo</span> <span class="p">{</span>
<a name="rest_code_d20b44fbfee941a78c180aca444c1f39-4"></a>
<a name="rest_code_d20b44fbfee941a78c180aca444c1f39-5"></a>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">FileSetManager</span> <span class="n">fileSetManager</span><span class="p">;</span>
<a name="rest_code_d20b44fbfee941a78c180aca444c1f39-6"></a>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">MdToHtml</span> <span class="n">mdToHtml</span><span class="p">;</span>
<a name="rest_code_d20b44fbfee941a78c180aca444c1f39-7"></a>
<a name="rest_code_d20b44fbfee941a78c180aca444c1f39-8"></a>    <span class="c1">// It will inject an instance of FileSetManager and MdToHtml</span>
<a name="rest_code_d20b44fbfee941a78c180aca444c1f39-9"></a>    <span class="nd">@Inject</span>
<a name="rest_code_d20b44fbfee941a78c180aca444c1f39-10"></a>    <span class="kd">public</span> <span class="nf">BuildMojo</span><span class="p">(</span><span class="n">FileSetManager</span> <span class="n">fileSetManager</span><span class="p">,</span> <span class="n">MdToHtml</span> <span class="n">mdToHtml</span><span class="p">)</span> <span class="p">{</span>
<a name="rest_code_d20b44fbfee941a78c180aca444c1f39-11"></a>        <span class="k">this</span><span class="p">.</span><span class="na">fileSetManager</span> <span class="o">=</span> <span class="n">fileSetManager</span><span class="p">;</span>
<a name="rest_code_d20b44fbfee941a78c180aca444c1f39-12"></a>        <span class="k">this</span><span class="p">.</span><span class="na">mdToHtml</span> <span class="o">=</span> <span class="n">mdToHtml</span><span class="p">;</span>
</pre>
</div>
<div class="section" id="write-a-custom-mojo">
<h3>Write a custom <a class="reference external" href="https://maven.apache.org/plugin-developers/index.html">Mojo</a>
<a href="#write-a-custom-mojo" class="headerlink" title="Permalink to this heading">¶</a></h3>
<p>It is straightforward to implement a <a class="reference external" href="https://maven.apache.org/plugin-developers/index.html">Mojo</a> class, we have to:</p>
<div class="section" id="implement-mojo-interface">
<h4><a class="toc-backref" href="#id7">1. Implement Mojo interface</a><a href="#implement-mojo-interface" class="headerlink" title="Permalink to this heading">¶</a></h4>
<p>Your <a class="reference external" href="https://maven.apache.org/plugin-developers/index.html">Mojo</a> class has to implement <code class="docutils literal">org.apache.maven.plugin.Mojo</code>, although it is more convenient to extend <code class="docutils literal">org.apache.maven.plugin.AbstractMojo</code>, an abstract class to provide most of the infrastructure required to implement a Mojo except for execute method. That interface and class are described at <a class="reference external" href="https://maven.apache.org/developers/mojo-api-specification.html">Mojo API</a>.</p>
<pre class="code java"><a name="rest_code_c100f9f60f544ea69fe09a1fa66e49a4-1"></a><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BuildMojo</span> <span class="kd">extends</span> <span class="n">AbstractMojo</span> <span class="p">{</span>
</pre>
</div>
<div class="section" id="configure-mojo-with-java-5-annotations">
<h4><a class="toc-backref" href="#id8">2. Configure Mojo with Java 5 annotations</a><a href="#configure-mojo-with-java-5-annotations" class="headerlink" title="Permalink to this heading">¶</a></h4>
<p>Annotate <a class="reference external" href="https://maven.apache.org/plugin-developers/index.html">Mojo</a> class with <code class="docutils literal">@Mojo</code> and input parameters with <code class="docutils literal">@Parameter</code>. Those annotations belong to another set of annotations to configure Mojos, <a class="reference external" href="https://maven.apache.org/plugin-tools/maven-plugin-plugin/examples/using-annotations.html">Plugin Tools Java5 Annotations</a>.</p>
<pre class="code java"><a name="rest_code_a96533f1af804cafb14e2612531551b8-1"></a><span class="cm">/**</span>
<a name="rest_code_a96533f1af804cafb14e2612531551b8-2"></a><span class="cm">* Generate HTML files from Markdown files</span>
<a name="rest_code_a96533f1af804cafb14e2612531551b8-3"></a><span class="cm">*/</span>
<a name="rest_code_a96533f1af804cafb14e2612531551b8-4"></a><span class="nd">@Mojo</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"build"</span><span class="p">,</span> <span class="n">defaultPhase</span> <span class="o">=</span> <span class="n">LifecyclePhase</span><span class="p">.</span><span class="na">COMPILE</span><span class="p">)</span>
<a name="rest_code_a96533f1af804cafb14e2612531551b8-5"></a><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BuildMojo</span> <span class="kd">extends</span> <span class="n">AbstractMojo</span> <span class="p">{</span>
<a name="rest_code_a96533f1af804cafb14e2612531551b8-6"></a>
<a name="rest_code_a96533f1af804cafb14e2612531551b8-7"></a>    <span class="cm">/**</span>
<a name="rest_code_a96533f1af804cafb14e2612531551b8-8"></a><span class="cm">    * Output directory path where HTML files are generated</span>
<a name="rest_code_a96533f1af804cafb14e2612531551b8-9"></a><span class="cm">    */</span>
<a name="rest_code_a96533f1af804cafb14e2612531551b8-10"></a>    <span class="nd">@Parameter</span><span class="p">(</span><span class="n">defaultValue</span> <span class="o">=</span> <span class="s">"${project.reporting.outputDirectory}"</span><span class="p">,</span> <span class="n">property</span> <span class="o">=</span> <span class="s">"siteOutputDirectory"</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">true</span><span class="p">)</span>
<a name="rest_code_a96533f1af804cafb14e2612531551b8-11"></a>    <span class="kd">private</span> <span class="n">File</span> <span class="n">outputDirectory</span><span class="p">;</span>
<a name="rest_code_a96533f1af804cafb14e2612531551b8-12"></a>
<a name="rest_code_a96533f1af804cafb14e2612531551b8-13"></a>    <span class="cm">/**</span>
<a name="rest_code_a96533f1af804cafb14e2612531551b8-14"></a><span class="cm">    * A specific &lt;code&gt;fileSet&lt;/code&gt; rule to select files and directories.</span>
<a name="rest_code_a96533f1af804cafb14e2612531551b8-15"></a><span class="cm">    * Fileset spec: https://maven.apache.org/shared/file-management/fileset.html</span>
<a name="rest_code_a96533f1af804cafb14e2612531551b8-16"></a><span class="cm">    */</span>
<a name="rest_code_a96533f1af804cafb14e2612531551b8-17"></a>    <span class="nd">@Parameter</span>
<a name="rest_code_a96533f1af804cafb14e2612531551b8-18"></a>    <span class="kd">private</span> <span class="n">FileSet</span> <span class="n">inputFiles</span><span class="p">;</span>
</pre>
<dl>
<dt><code class="docutils literal">@Mojo</code></dt>
<dd>
<p>Configures Mojo name and default lifecycle phase. To execute the Mojo in example we will use <code class="docutils literal">mvn site:build</code>: <em>site</em> is the plugin name and <em>build</em> is <code class="docutils literal">name</code> parameter.</p>
</dd>
<dt><code class="docutils literal">@Parameter</code></dt>
<dd>
<p>We use it to pass configuration parameters to Mojo. <code class="docutils literal">@Parameter</code> annotation accepts extra arguments</p>
<ul class="simple">
<li><p>defaultValue: You can use properties placeholder or any String. If the parameter type is not a String, then Maven will try to cast it, e.g:</p></li>
</ul>
<pre class="code java"><a name="rest_code_687b160898c84a2b9a9b928729b1dec8-1"></a><span class="c1">// If intParameter is not set in pom file, then "2" will be converted to 2 and assigned to intParameter.</span>
<a name="rest_code_687b160898c84a2b9a9b928729b1dec8-2"></a><span class="nd">@Parameter</span><span class="p">(</span><span class="n">defaultValue</span><span class="o">=</span><span class="s">"2"</span><span class="p">)</span>
<a name="rest_code_687b160898c84a2b9a9b928729b1dec8-3"></a><span class="n">Integer</span> <span class="n">intParameter</span><span class="p">;</span>
</pre>
<ul class="simple">
<li><p>property: It allows configuration of the Mojo parameter from the command line by referencing a system property that the user sets via the -D option.</p></li>
</ul>
<pre class="code bash"><a name="rest_code_5ebd2a5a66b644f09ef9e74abaf6291e-1"></a><span class="c1"># To assign "/var/www/html" value to  outputDirectory:</span>
<a name="rest_code_5ebd2a5a66b644f09ef9e74abaf6291e-2"></a>
<a name="rest_code_5ebd2a5a66b644f09ef9e74abaf6291e-3"></a>mvn site:build -DsiteOutputDirectory<span class="o">=</span>/var/www/html
</pre>
</dd>
</dl>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>More info in <a class="reference external" href="https://maven.apache.org/guides/plugin/guide-java-plugin-development.html#Parameters">Maven Plugin development guide in Parametera section</a>.</p>
</div>
</div>
<div class="section" id="implement-execute-method">
<h4><a class="toc-backref" href="#id9">3. Implement <em>execute</em> method</a><a href="#implement-execute-method" class="headerlink" title="Permalink to this heading">¶</a></h4>
<p>As I have explained before at <a class="reference internal" href="#implement-mojo-interface">1. Implement Mojo interface</a>, our <a class="reference external" href="https://maven.apache.org/plugin-developers/index.html">Mojo</a> class extends <code class="docutils literal">org.apache.maven.plugin.AbstractMojo</code> which has one unimplemented method from <code class="docutils literal">org.apache.maven.plugin.Mojo</code> interface. In that method we are going to implement the Maven goal logic.</p>
<p><a class="reference external" href="https://maven.apache.org/plugin-developers/index.html">Mojo</a> class instance is called from <a class="reference external" href="https://maven.apache.org">Maven</a> execution lifecycle by invoking <code class="docutils literal">execute()</code> method. Before calling <code class="docutils literal">execute()</code>, Maven has performed some other tasks related with the Mojo:</p>
<ol class="arabic simple">
<li><p>Maven instantiates Mojo and injects dependencies (<a class="reference internal" href="#dependency-injection">Dependency Injection</a>).</p></li>
</ol>
<pre class="code java"><a name="rest_code_fb8918b481124d23b42aa625a7425615-1"></a><span class="n">Mojo</span> <span class="n">mojo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BuildMojo</span><span class="p">(</span><span class="n">fileSetManager</span><span class="p">,</span> <span class="n">mdToHtml</span><span class="p">);</span>
</pre>
<ol class="arabic simple" start="2">
<li><p>Maven configures the Mojo by assigning values to parameters.</p></li>
<li><p>Maven calls execute method: <code class="docutils literal"><span class="pre">mojo.execute();</span></code>.</p></li>
</ol>
<p>I will simplify <code class="docutils literal">execute</code> method implementation, the <a class="reference external" href="https://github.com/carlosvin/blog-maven-plugin">sample project in github</a> is more complicated and not good for learning.</p>
<pre class="code java"><a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-1"></a><span class="c1">// If there is any error during execution, it should throw MojoExecutionException</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-2"></a><span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">MojoExecutionException</span> <span class="p">{</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-3"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">inputFiles</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-4"></a>        <span class="n">setDefaultInput</span><span class="p">();</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-5"></a>    <span class="p">}</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-6"></a>    <span class="n">inputDirPath</span> <span class="o">=</span> <span class="n">Paths</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">inputFiles</span><span class="p">.</span><span class="na">getDirectory</span><span class="p">());</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-7"></a>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-8"></a>    <span class="c1">// A way to get all selected files from FileSet</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-9"></a>    <span class="c1">// https://maven.apache.org/shared/file-management/fileset.html</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-10"></a>    <span class="n">String</span><span class="o">[]</span> <span class="n">includedFiles</span> <span class="o">=</span> <span class="n">fileSetManager</span><span class="p">.</span><span class="na">getIncludedFiles</span><span class="p">(</span><span class="n">inputFiles</span><span class="p">);</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-11"></a>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-12"></a>    <span class="n">outputDirPath</span> <span class="o">=</span> <span class="n">outputDirectory</span><span class="p">.</span><span class="na">toPath</span><span class="p">();</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-13"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">includedFiles</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">includedFiles</span><span class="p">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-14"></a>        <span class="c1">// AbstractMojo supplies logger functionality</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-15"></a>        <span class="n">getLog</span><span class="p">().</span><span class="na">warn</span><span class="p">(</span><span class="s">"SKIP: There are no input files. "</span> <span class="o">+</span> <span class="n">getInputFilesToString</span><span class="p">());</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-16"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-17"></a>        <span class="c1">// If output directory doesn't exist, it will be created</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-18"></a>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">outputDirectory</span><span class="p">.</span><span class="na">exists</span><span class="p">())</span> <span class="p">{</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-19"></a>            <span class="n">outputDirectory</span><span class="p">.</span><span class="na">mkdirs</span><span class="p">();</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-20"></a>        <span class="p">}</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-21"></a>        <span class="k">try</span> <span class="p">{</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-22"></a>            <span class="k">for</span> <span class="p">(</span><span class="n">String</span> <span class="n">f</span> <span class="p">:</span> <span class="n">includedFiles</span><span class="p">)</span> <span class="p">{</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-23"></a>                <span class="c1">// it converts each file Markdown to HTML</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-24"></a>                <span class="n">convertToHtml</span><span class="p">(</span><span class="n">Paths</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">outputDirectory</span><span class="p">);</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-25"></a>            <span class="p">}</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-26"></a>        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-27"></a>            <span class="c1">// Convert thrown exception to MojoExecutionException</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-28"></a>            <span class="k">throw</span> <span class="k">new</span> <span class="n">MojoExecutionException</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getLocalizedMessage</span><span class="p">(),</span> <span class="n">e</span><span class="p">);</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-29"></a>        <span class="p">}</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-30"></a>    <span class="p">}</span>
<a name="rest_code_3b4f4476b1d04043991cbc6f3e1dcd5a-31"></a><span class="p">}</span>
</pre>
</div>
</div>
</div>
<div class="section" id="unit-tests">
<h2><a class="toc-backref" href="#id10">Unit tests</a><a href="#unit-tests" class="headerlink" title="Permalink to this heading">¶</a></h2>
<p>In the example we use <a class="reference external" href="https://junit.org/junit4/">JUnit 4</a>, but you can use any other testing framework.</p>
<p>Firtsly, you have to add the unit test library dependency to <code class="docutils literal">pom.xml</code>.</p>
<pre class="code xml"><a name="rest_code_705b7faab1fd4c60821dd1ec1632ab6e-1"></a><span class="nt">&lt;dependency&gt;</span>
<a name="rest_code_705b7faab1fd4c60821dd1ec1632ab6e-2"></a>    <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
<a name="rest_code_705b7faab1fd4c60821dd1ec1632ab6e-3"></a>    <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
<a name="rest_code_705b7faab1fd4c60821dd1ec1632ab6e-4"></a>    <span class="nt">&lt;version&gt;</span>4.11<span class="nt">&lt;/version&gt;</span>
<a name="rest_code_705b7faab1fd4c60821dd1ec1632ab6e-5"></a>    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<a name="rest_code_705b7faab1fd4c60821dd1ec1632ab6e-6"></a><span class="nt">&lt;/dependency&gt;</span>
</pre>
<p>Then you just have to write your unit tests under <code class="docutils literal">src/test/java</code> folder, for example: <a class="reference external" href="https://github.com/carlosvin/blog-maven-plugin/blob/master/src/test/java/com/maven/plugins/blog/PathsTest.java">src/test/java/com/maven/plugins/blog/PathsTest.java</a>.</p>
<p>To run the unit tests you just need to execute <code class="docutils literal">mvn test</code>.</p>
</div>
<div class="section" id="integration-tests">
<h2><a class="toc-backref" href="#id11">Integration tests</a><a href="#integration-tests" class="headerlink" title="Permalink to this heading">¶</a></h2>
<p>The 2 most popular ways to perform integration tests on custom maven plugins are using <a class="reference external" href="https://maven.apache.org/surefire/maven-failsafe-plugin">maven-failsafe-plugin</a> or <a class="reference external" href="https://maven.apache.org/plugins/maven-invoker-plugin">maven-invoker-plugin</a>.</p>
<p>I've chosen <a class="reference external" href="https://maven.apache.org/plugins/maven-invoker-plugin">maven-invoker-plugin</a> because for me it is more straightforward. There is <a class="reference external" href="https://stackoverflow.com/questions/40010745/maven-invoker-plugin-vs-maven-failsafe-plugin-which-to-use-for-integration-test">an answer at stackoverflow where they explain thoroughly the differences between them</a></p>
<div class="section" id="how-does-invoker-plugin-work">
<h3><a class="toc-backref" href="#id12">How does Invoker Plugin work?</a><a href="#how-does-invoker-plugin-work" class="headerlink" title="Permalink to this heading">¶</a></h3>
<p>We create projects to use our custom plugin under <code class="docutils literal">src/it</code> folder, so our plugin will be applied to test projects. After that, a validation script will be executed so we can check if our plugin outputs are as expected. For example, if our plugin is supposed to generate a file named <code class="docutils literal">foo.file</code>, verification plugin will check if that file exists, if it doesn't, integration test will fail.</p>
</div>
<div class="section" id="configure-invoker-plugin">
<h3><a class="toc-backref" href="#id13">Configure Invoker Plugin</a><a href="#configure-invoker-plugin" class="headerlink" title="Permalink to this heading">¶</a></h3>
<pre class="code xml"><a name="rest_code_b2abd697054c447482479344eb1c53ea-1"></a><span class="nt">&lt;plugin&gt;</span>
<a name="rest_code_b2abd697054c447482479344eb1c53ea-2"></a>    <span class="nt">&lt;artifactId&gt;</span>maven-invoker-plugin<span class="nt">&lt;/artifactId&gt;</span>
<a name="rest_code_b2abd697054c447482479344eb1c53ea-3"></a>    <span class="nt">&lt;version&gt;</span>3.0.1<span class="nt">&lt;/version&gt;</span>
<a name="rest_code_b2abd697054c447482479344eb1c53ea-4"></a>    <span class="nt">&lt;configuration&gt;</span>
<a name="rest_code_b2abd697054c447482479344eb1c53ea-5"></a>        <span class="nt">&lt;postBuildHookScript&gt;</span>verify<span class="nt">&lt;/postBuildHookScript&gt;</span>
<a name="rest_code_b2abd697054c447482479344eb1c53ea-6"></a>        <span class="nt">&lt;showVersion&gt;</span>true<span class="nt">&lt;/showVersion&gt;</span>
<a name="rest_code_b2abd697054c447482479344eb1c53ea-7"></a>        <span class="nt">&lt;streamLogs&gt;</span>true<span class="nt">&lt;/streamLogs&gt;</span>
<a name="rest_code_b2abd697054c447482479344eb1c53ea-8"></a>        <span class="nt">&lt;noLog&gt;</span>false<span class="nt">&lt;/noLog&gt;</span>
<a name="rest_code_b2abd697054c447482479344eb1c53ea-9"></a>        <span class="nt">&lt;showErrors&gt;</span>true<span class="nt">&lt;/showErrors&gt;</span>
<a name="rest_code_b2abd697054c447482479344eb1c53ea-10"></a>    <span class="nt">&lt;/configuration&gt;</span>
<a name="rest_code_b2abd697054c447482479344eb1c53ea-11"></a>    <span class="nt">&lt;executions&gt;</span>
<a name="rest_code_b2abd697054c447482479344eb1c53ea-12"></a>        <span class="nt">&lt;execution&gt;</span>
<a name="rest_code_b2abd697054c447482479344eb1c53ea-13"></a>            <span class="nt">&lt;id&gt;</span>integration-test<span class="nt">&lt;/id&gt;</span>
<a name="rest_code_b2abd697054c447482479344eb1c53ea-14"></a>            <span class="nt">&lt;goals&gt;</span>
<a name="rest_code_b2abd697054c447482479344eb1c53ea-15"></a>                <span class="nt">&lt;goal&gt;</span>install<span class="nt">&lt;/goal&gt;</span>
<a name="rest_code_b2abd697054c447482479344eb1c53ea-16"></a>                <span class="nt">&lt;goal&gt;</span>run<span class="nt">&lt;/goal&gt;</span>
<a name="rest_code_b2abd697054c447482479344eb1c53ea-17"></a>            <span class="nt">&lt;/goals&gt;</span>
<a name="rest_code_b2abd697054c447482479344eb1c53ea-18"></a>        <span class="nt">&lt;/execution&gt;</span>
<a name="rest_code_b2abd697054c447482479344eb1c53ea-19"></a>    <span class="nt">&lt;/executions&gt;</span>
<a name="rest_code_b2abd697054c447482479344eb1c53ea-20"></a><span class="nt">&lt;/plugin&gt;</span>
</pre>
<p>In <strong>executions</strong> section we execute following goals:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal">invoker:install</code> will be executed during the phase pre-integration-test and will install the main project artifact into target/local-repo.</p></li>
<li><p><code class="docutils literal">invoker:run</code> will be executed during the integration-test phase and it will execute all defined integration tests under <code class="docutils literal">src/it</code> folder.</p></li>
</ol>
<p>In <strong>configuration</strong> section:</p>
<p><code class="docutils literal"><span class="pre">&lt;postBuildHookScript&gt;verify&lt;/postBuildHookScript&gt;</span></code> configures invoker plugin to execute validation script after integration test project execution. This script may be written with either BeanShell or Groovy (verify.groovy or verify.bsh).</p>
<p>We have used other properties to show errors, show maven log and save it to a file.</p>
<p>You can check all <code class="docutils literal">invoker:run</code> configuration properties at <a class="reference external" href="https://maven.apache.org/plugins/maven-invoker-plugin/run-mojo.html">https://maven.apache.org/plugins/maven-invoker-plugin/run-mojo.html</a>.</p>
</div>
<div class="section" id="create-an-integration-test-project">
<h3><a class="toc-backref" href="#id14">Create an Integration Test Project</a><a href="#create-an-integration-test-project" class="headerlink" title="Permalink to this heading">¶</a></h3>
<p>It is a project we use to execute custom plugin goals, so we can validate if it produces the expected output.</p>
<p>There are 3 important files that matche with <a class="reference external" href="http://wiki.c2.com/?ArrangeActAssert">AAA</a> phases ("Arrange-Act-Assert"):</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/carlosvin/blog-maven-plugin/blob/master/src/it/md-html/pom.xml">src/it/md-html/pom.xml [Arrange]</a> which has the project using our custom plugin.</p></li>
<li><p><a class="reference external" href="https://github.com/carlosvin/blog-maven-plugin/blob/master/src/it/md-html/invoker.properties">src/it/md-html/invoker.properties [Act]</a> will define how test project will be executed.</p></li>
<li><p><a class="reference external" href="https://github.com/carlosvin/blog-maven-plugin/blob/master/src/it/md-html/verify.groovy">src/it/md-html/verify.groovy [Assert]</a> is the script to check that plugin execution generated expected results.</p></li>
</ul>
<div class="section" id="pom-xml-arrange">
<h4><a class="toc-backref" href="#id15">pom.xml (Arrange)</a><a href="#pom-xml-arrange" class="headerlink" title="Permalink to this heading">¶</a></h4>
<pre class="code xml"><a name="rest_code_73bec4e3273e4d94833a3749fb41eede-1"></a><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<a name="rest_code_73bec4e3273e4d94833a3749fb41eede-2"></a><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
<a name="rest_code_73bec4e3273e4d94833a3749fb41eede-3"></a><span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
<a name="rest_code_73bec4e3273e4d94833a3749fb41eede-4"></a>    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
<a name="rest_code_73bec4e3273e4d94833a3749fb41eede-5"></a>
<a name="rest_code_73bec4e3273e4d94833a3749fb41eede-6"></a>    <span class="nt">&lt;groupId&gt;</span>com.maven.plugins.it<span class="nt">&lt;/groupId&gt;</span>
<a name="rest_code_73bec4e3273e4d94833a3749fb41eede-7"></a>    <span class="nt">&lt;artifactId&gt;</span>simple-it<span class="nt">&lt;/artifactId&gt;</span>
<a name="rest_code_73bec4e3273e4d94833a3749fb41eede-8"></a>    <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<a name="rest_code_73bec4e3273e4d94833a3749fb41eede-9"></a>
<a name="rest_code_73bec4e3273e4d94833a3749fb41eede-10"></a>    <span class="nt">&lt;build&gt;</span>
<a name="rest_code_73bec4e3273e4d94833a3749fb41eede-11"></a>        <span class="nt">&lt;plugins&gt;</span>
<a name="rest_code_73bec4e3273e4d94833a3749fb41eede-12"></a>            <span class="nt">&lt;plugin&gt;</span>
<a name="rest_code_73bec4e3273e4d94833a3749fb41eede-13"></a>                <span class="nt">&lt;groupId&gt;</span>@project.groupId@<span class="nt">&lt;/groupId&gt;</span>
<a name="rest_code_73bec4e3273e4d94833a3749fb41eede-14"></a>                <span class="nt">&lt;artifactId&gt;</span>@project.artifactId@<span class="nt">&lt;/artifactId&gt;</span>
<a name="rest_code_73bec4e3273e4d94833a3749fb41eede-15"></a>                <span class="nt">&lt;version&gt;</span>@project.version@<span class="nt">&lt;/version&gt;</span>
<a name="rest_code_73bec4e3273e4d94833a3749fb41eede-16"></a>            <span class="nt">&lt;/plugin&gt;</span>
<a name="rest_code_73bec4e3273e4d94833a3749fb41eede-17"></a>        <span class="nt">&lt;/plugins&gt;</span>
<a name="rest_code_73bec4e3273e4d94833a3749fb41eede-18"></a>    <span class="nt">&lt;/build&gt;</span>
<a name="rest_code_73bec4e3273e4d94833a3749fb41eede-19"></a><span class="nt">&lt;/project&gt;</span>
</pre>
<p>It is a very simple pom file where we use placeholders to reference to our plugin under test. When invoker plugin executes following pom file, firstly will replace those placeholders to reference to the latest version sof our custom plugin which was recently installed in the local repository:</p>
<pre class="code xml"><a name="rest_code_f41ddea5fbd542d091089ff7c6540b1f-1"></a><span class="nt">&lt;plugin&gt;</span>
<a name="rest_code_f41ddea5fbd542d091089ff7c6540b1f-2"></a>    <span class="nt">&lt;groupId&gt;</span>com.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
<a name="rest_code_f41ddea5fbd542d091089ff7c6540b1f-3"></a>        <span class="nt">&lt;artifactId&gt;</span>blog<span class="nt">&lt;/artifactId&gt;</span>
<a name="rest_code_f41ddea5fbd542d091089ff7c6540b1f-4"></a>        <span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<a name="rest_code_f41ddea5fbd542d091089ff7c6540b1f-5"></a><span class="nt">&lt;/plugin&gt;</span>
</pre>
<p>In that way invoker plugin ensures it is testing the latest version of current project.</p>
</div>
<div class="section" id="invoker-properties-act">
<h4><a class="toc-backref" href="#id16">invoker.properties (Act)</a><a href="#invoker-properties-act" class="headerlink" title="Permalink to this heading">¶</a></h4>
<pre class="code properties"><a name="rest_code_dbbc245ed2b7498099ffb6813558cfdb-1"></a><span class="na">invoker.goals</span> <span class="o">=</span> <span class="s">blog:build</span>
<a name="rest_code_dbbc245ed2b7498099ffb6813558cfdb-2"></a><span class="na">invoker.name</span> <span class="o">=</span> <span class="s">Test build MD</span>
</pre>
<p>It will execute <code class="docutils literal">mvn blog:build</code>, a goal defined in our custom plugin under example or what is the same, it will execute <a class="reference external" href="https://github.com/carlosvin/blog-maven-plugin/blob/master/src/main/java/com/maven/plugins/blog/BuildMojo.java">BuildMojo</a> described in section "<a class="reference internal" href="#write-a-custom-mojo">Write a custom Mojo</a>".</p>
</div>
<div class="section" id="verify-groovy-assert">
<h4><a class="toc-backref" href="#id17">verify.groovy (Assert)</a><a href="#verify-groovy-assert" class="headerlink" title="Permalink to this heading">¶</a></h4>
<p>Verification script, it is checking if <code class="docutils literal">target/site/README.html</code> file was generated by the plugin.</p>
<pre class="code groovy"><a name="rest_code_30967a542da54b009bed09484f9ff3ec-1"></a><span class="n">File</span> <span class="n">generated</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span> <span class="n">basedir</span><span class="o">,</span> <span class="s2">"target/site/README.html"</span> <span class="o">);</span>
<a name="rest_code_30967a542da54b009bed09484f9ff3ec-2"></a>
<a name="rest_code_30967a542da54b009bed09484f9ff3ec-3"></a><span class="k">assert</span> <span class="n">generated</span><span class="o">.</span><span class="na">isFile</span><span class="o">()</span>
</pre>
</div>
</div>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/build-systems/" rel="tag">Build Systems</a></li>
            <li><a class="tag p-category" href="../../categories/java/" rel="tag">Java</a></li>
            <li><a class="tag p-category" href="../../categories/maven/" rel="tag">Maven</a></li>
            <li><a class="tag p-category" href="../../categories/maven-plugins/" rel="tag">Maven Plugins</a></li>
            <li><a class="tag p-category" href="../../categories/maven-site-plugin/" rel="tag">maven-site-plugin</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../choosing-modern-cpp-stack/" rel="prev" title="Choosing a Modern C++ stack">Previous post</a>
            </li>
            <li class="next">
                <a href="../creating-custom-maven-plugin-default/" rel="next" title="Custom Maven Plugin: Override default build lifecycle">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="carlosvin",
            disqus_url="https://carlosvin.github.io/posts/creating-custom-maven-plugin/",
        disqus_title="Example how to create custom Maven Plugin",
        disqus_identifier="cache/posts/creating-custom-maven-plugin.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="carlosvin";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><footer id="footer"><p>
        <span>Powered by <a href="https://getnikola.com" rel="nofollow" target="_blank">Nikola</a></span>
        
   <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/2.5/">
   <img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="https://licensebuttons.net/l/by-nc-sa/2.5/ar/88x31.png"></a>
</p>
            
        </footer>
</div>
    </div>
    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    
    
    
            <script async src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script><script async src="../../assets/js/all.js"></script><!-- Go to www.addthis.com/dashboard to customize your tools --><script defer type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cbc89c8e11f495f"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>