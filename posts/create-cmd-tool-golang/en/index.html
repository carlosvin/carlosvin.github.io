<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <meta content=sapper name=generator> <meta content=a22af7614c96254d name=yandex-verification> <link href=/icons/icon-192x192.png rel=apple-touch-icon integrity=sha384-wrGPakCw2XdE/oEQRn84jTytG8qKzGn3Eu8nUKzAHeYJ9owQpEUNewZQOj4IoHI3> <base href=/ > <link href=global.css rel=preload as=style integrity=sha384-fiuqT5r+RVuofLff3X+ZyczUdcS2X+eYqZ9ZH11qUKkXpGM97J5Tqv94KeeeZqyo> <link href=global.css rel=stylesheet integrity=sha384-fiuqT5r+RVuofLff3X+ZyczUdcS2X+eYqZ9ZH11qUKkXpGM97J5Tqv94KeeeZqyo> <link href=manifest.json rel=manifest crossorigin=use-credentials integrity=sha384-uvbABvsfA2LgNgoldfTIad7QYRrMk+jJ53noiFxFxSEdOUxSJQBfr7R8Lud6Dyoo> <link href=favicon.png rel=icon integrity=sha384-k8dlcHultdr3I+D1KxjtRCLXRS3o9oW0PMaVQGBP7STX5RLtgO2XLPbDIojwN796 type=image/png> <script> window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments) }; ga.l = +new Date;
		ga('create', 'UA-1328360-10', 'auto');
		ga('send', 'pageview'); </script> <script async src=https://www.google-analytics.com/analytics.js></script> <script> (function(c,l,a,r,i,t,y){
		c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
		t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
		y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
	})(window, document, "clarity", "script", "58k0hy1db4"); </script> <title>Easily creating a golang command line tool</title><link href=/feeds/en.xml rel=alternate type=application/atom+xml title="Subscribe to Carlos says bla bla"><meta content=2021-02-14 name=date.created><meta content=2021-02-14 name=date.updated><meta content="Let's see how to easily and quickly create a command line tool in golang" name=description><link href=/posts/create-cmd-tool-golang/en.jsonld rel=alternate type=application/ld+json> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,(function(a,b){return {html:"\u003Cdiv id=\"toc\" class=\"toc\"\u003E\n\u003Cdiv id=\"toctitle\"\u003ETable of Contents\u003C\u002Fdiv\u003E\n\u003Cul class=\"sectlevel1\"\u003E\n\u003Cli\u003E\u003Ca href=\"#_flags\"\u003EFlags\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_viper\"\u003EViper\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_meta_viper\"\u003EMeta-Viper\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv id=\"preamble\"\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgolang.org\u002F\" target=\"_blank\" rel=\"noopener\"\u003EGolang\u003C\u002Fa\u003E is the one of the most useful technologies I&#8217;ve recently learned. \u003Ca href=\"https:\u002F\u002Fgolang.org\u002F\" target=\"_blank\" rel=\"noopener\"\u003EGolang\u003C\u002Fa\u003E has a pretty nice support for networking, command line or logging out of the box, you don&#8217;t need any dependency. But there are libraries making developers' life even easier.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EI&#8217;ve already talked about \u003Ca href=\"\u002Fposts\u002Frest-service-go-vs-java\u002F\" target=\"blank_\"\u003Ecreating REST service in go\u003C\u002Fa\u003E, today I&#8217;d like to focus on creating a command line tool.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect1\"\u003E\n\u003Ch2 id=\"_flags\"\u003EFlags\u003C\u002Fh2\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003ECommand line tool to read number of lines as an input integer parameter \u003Ca href=\"https:\u002F\u002Fgolang.org\u002F\" target=\"_blank\" rel=\"noopener\"\u003EGolang\u003C\u002Fa\u003E\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre tabindex=\"0\" class=\"highlight\"\u003E\u003Ccode class=\"language-go\" data-lang=\"go\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Epackage\u003C\u002Fspan\u003E main\n\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E (\n\t\u003Cspan class=\"hljs-string\"\u003E&quot;flag&quot;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"hljs-string\"\u003E&quot;fmt&quot;\u003C\u002Fspan\u003E\n)\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E {\n\t\u003Cspan class=\"hljs-keyword\"\u003Evar\u003C\u002Fspan\u003E nFlag = flag.Int(\u003Cspan class=\"hljs-string\"\u003E&quot;lines&quot;\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-number\"\u003E1234\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-string\"\u003E&quot;number of lines&quot;\u003C\u002Fspan\u003E)\n\tflag.Parse()\n\tfmt.Printf(\u003Cspan class=\"hljs-string\"\u003E&quot;Lines %d\\n&quot;\u003C\u002Fspan\u003E, *nFlag)\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EWith previous simple code we have already some useful capabilities\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003EPrint help menu\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre tabindex=\"0\" class=\"highlight\"\u003E\u003Ccode class=\"language-bash\" data-lang=\"bash\"\u003E$ cmd --\u003Cspan class=\"hljs-built_in\"\u003Ehelp\u003C\u002Fspan\u003E\n\n&gt; Usage of cmd:\n    -lines int\n        number of lines (default 1234)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003EUse default value\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre tabindex=\"0\" class=\"highlight\"\u003E\u003Ccode class=\"language-bash\" data-lang=\"bash\"\u003E$ cmd\n\n&gt; Lines 1234\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003EPass a value to the command tool\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre tabindex=\"0\" class=\"highlight\"\u003E\u003Ccode class=\"language-bash\" data-lang=\"bash\"\u003E$ cmd --lines=2\n\n&gt; Lines 2\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003EPass an invalid value\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre tabindex=\"0\" class=\"highlight\"\u003E\u003Ccode class=\"language-bash\" data-lang=\"bash\"\u003E$ cmd --lines=asdf\n\n&gt; invalid value \u003Cspan class=\"hljs-string\"\u003E&quot;asdf&quot;\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Efor\u003C\u002Fspan\u003E flag -lines: parse error\nUsage of cmd:\n    -lines int\n        number of lines (default 1234)\n\u003Cspan class=\"hljs-built_in\"\u003Eexit\u003C\u002Fspan\u003E status 2\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EFor a simple command line tool, in most of the cases, we will have enough with the default language support. But if we want to bring more features to the combo like reading configuration from environment variables or from files, then a library like the awesome \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fspf13\u002Fviper\" target=\"_blank\" rel=\"noopener\"\u003EViper\u003C\u002Fa\u003E will come really handy.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect1\"\u003E\n\u003Ch2 id=\"_viper\"\u003EViper\u003C\u002Fh2\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fspf13\u002Fviper\" target=\"_blank\" rel=\"noopener\"\u003EViper\u003C\u002Fa\u003E is very powerful and well documented library widely used from many projects, I will not get into the details or how to use it, because I&#8217;ve created an abstraction to simplify its usage, I named it \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fcarlosvin\u002Fmeta-viper\" target=\"_blank\" rel=\"noopener\"\u003EMeta-Viper\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect1\"\u003E\n\u003Ch2 id=\"_meta_viper\"\u003EMeta-Viper\u003C\u002Fh2\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fcarlosvin\u002Fmeta-viper\" target=\"_blank\" rel=\"noopener\"\u003EMeta-Viper\u003C\u002Fa\u003E abstracts you of the details of reading configuration from files, environment or flags. This extra simplicity comes with a tradeoff, we are missing some flexibility.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003ELet&#8217;s see some features with an example.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003EFirstly we have to create a go modules project with the meta-viper dependency\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre tabindex=\"0\" class=\"highlight\"\u003E\u003Ccode class=\"language-bash\" data-lang=\"bash\"\u003Ego mod init example.com\u002Fmeta-viper \u003Cb class=\"conum\"\u003E(1)\u003C\u002Fb\u003E\n\ngo get github.com\u002Fcarlosvin\u002Fmeta-viper \u003Cb class=\"conum\"\u003E(2)\u003C\u002Fb\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"colist arabic\"\u003E\n\u003Col\u003E\n\u003Cli\u003E\n\u003Cp\u003ECreate a go modules project\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003EInstall the meta-viper dependency\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003ENow let&#8217;s create a program that is configurable from files, command line params and environment variables.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003Emain.go\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre tabindex=\"0\" class=\"highlight\"\u003E\u003Ccode class=\"language-go\" data-lang=\"go\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Epackage\u003C\u002Fspan\u003E main\n\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E (\n\t\u003Cspan class=\"hljs-string\"\u003E&quot;log&quot;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"hljs-string\"\u003E&quot;os&quot;\u003C\u002Fspan\u003E\n\n\tconfig \u003Cspan class=\"hljs-string\"\u003E&quot;github.com\u002Fcarlosvin\u002Fmeta-viper&quot;\u003C\u002Fspan\u003E\n)\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Here is where you define the struct that will hold the configuration values\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F cfg_name is the parameter name\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F cfg_desc is the parameter description that will be shown in the command line help\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Etype\u003C\u002Fspan\u003E appConfig \u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E {\n\tHost      \u003Cspan class=\"hljs-keyword\"\u003Estring\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E`cfg_name:&quot;host&quot; cfg_desc:&quot;Server host&quot;`\u003C\u002Fspan\u003E\n\tPort      \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E    \u003Cspan class=\"hljs-string\"\u003E`cfg_name:&quot;port&quot; cfg_desc:&quot;Server port&quot;`\u003C\u002Fspan\u003E\n\tSearchAPI \u003Cspan class=\"hljs-keyword\"\u003Estring\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E`cfg_name:&quot;apis.search&quot; cfg_desc:&quot;Search API endpoint&quot;`\u003C\u002Fspan\u003E\n}\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E {\n\t\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Instantiate the structure with default values\u003C\u002Fspan\u003E\n\tcfg := &amp;appConfig{\n\t\tHost:      \u003Cspan class=\"hljs-string\"\u003E&quot;localhost&quot;\u003C\u002Fspan\u003E,\n\t\tPort:      \u003Cspan class=\"hljs-number\"\u003E6000\u003C\u002Fspan\u003E,\n\t\tSearchAPI: \u003Cspan class=\"hljs-string\"\u003E&quot;google&quot;\u003C\u002Fspan\u003E,\n\t}\n\n\t\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Meta-Viper instance is loading the configuration from wherever is available: files, env, or input params\u003C\u002Fspan\u003E\n\t_, err := config.New(cfg, os.Args)\n\t\u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E err != \u003Cspan class=\"hljs-literal\"\u003Enil\u003C\u002Fspan\u003E {\n\t\t\u003Cspan class=\"hljs-built_in\"\u003Epanic\u003C\u002Fspan\u003E(err)\n\t}\n\tlog.Printf(\u003Cspan class=\"hljs-string\"\u003E&quot;Loaded Configuration %v...&quot;\u003C\u002Fspan\u003E, cfg)\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003ENow let&#8217;s see some examples how this command line tool is able to load configuration.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003EPrint usage (help)\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre tabindex=\"0\" class=\"highlight\"\u003E\u003Ccode class=\"language-bash\" data-lang=\"bash\"\u003E$ cmd --\u003Cspan class=\"hljs-built_in\"\u003Ehelp\u003C\u002Fspan\u003E\n\nUsage of flagsConfig:\n    --apis.search string    Search API endpoint (default \u003Cspan class=\"hljs-string\"\u003E&quot;google&quot;\u003C\u002Fspan\u003E)\n    --config string         Configuration name\n    --config-dirs strings   Configuration directories search paths (default [.,config,configs,cfg])\n    --host string           Server host (default \u003Cspan class=\"hljs-string\"\u003E&quot;localhost&quot;\u003C\u002Fspan\u003E)\n    --port int              Server port (default 6000)\npflag: \u003Cspan class=\"hljs-built_in\"\u003Ehelp\u003C\u002Fspan\u003E requested\n\u003Cspan class=\"hljs-built_in\"\u003Eexit\u003C\u002Fspan\u003E status 2\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003ERun with default values\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre tabindex=\"0\" class=\"highlight\"\u003E\u003Ccode class=\"language-bash\" data-lang=\"bash\"\u003E$ cmd\n\n2021\u002F02\u002F15 23:12:48 No configuration name has been specified, so no configuration file will be loaded. Using flags and environment variables.\n2021\u002F02\u002F15 23:12:48 Loaded Configuration &amp;{localhost 6000 google}...\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003ERead the port from environment variable and host from input param\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre tabindex=\"0\" class=\"highlight\"\u003E\u003Ccode class=\"language-bash\" data-lang=\"bash\"\u003E$ PORT=9999 cmd --host=myhost\n\n2021\u002F02\u002F15 23:15:47 No configuration name has been specified, so no configuration file will be loaded. Using flags and environment variables.\n2021\u002F02\u002F15 23:15:47 Loaded Configuration &amp;{myhost 9999 google}...\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EThe last example will aggregate all the possible sources of configuration, it will extend the previous one adding configuration from a file. So let&#8217;s create a configuration file:\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003Ethe-config.json\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre tabindex=\"0\" class=\"highlight\"\u003E\u003Ccode class=\"language-json\" data-lang=\"json\"\u003E{\n    \u003Cspan class=\"hljs-attr\"\u003E&quot;apis&quot;\u003C\u002Fspan\u003E: {\n        \u003Cspan class=\"hljs-attr\"\u003E&quot;search&quot;\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E&quot;duckduckgo&quot;\u003C\u002Fspan\u003E\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003ERead configuration from the-config.json file, from environment and from input params\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre tabindex=\"0\" class=\"highlight\"\u003E\u003Ccode class=\"language-bash\" data-lang=\"bash\"\u003E$ PORT=9999 cmd --host=myhost --config=the-config\n\n2021\u002F02\u002F15 23:22:17 Loaded Configuration &amp;{myhost 9999 duckduckgo}...\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"admonitionblock tip\"\u003E\n\u003Ctable\u003E\n\u003Ctr\u003E\n\u003Ctd class=\"icon\"\u003E\n\u003Cdiv class=\"title\"\u003ETip\u003C\u002Fdiv\u003E\n\u003C\u002Ftd\u003E\n\u003Ctd class=\"content\"\u003E\nHere you can find a \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fcarlosvin\u002Fmeta-viper\u002Ftree\u002Fmaster\u002Fexamples\u002Fmulti-env\" target=\"_blank\" rel=\"noopener\"\u003Emulti-environment example\u003C\u002Fa\u003E a little bit more complete.\n\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftable\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E",post:{title:"Easily creating a golang command line tool",lang:"en",summary:"Let's see how to easily and quickly create a command line tool in golang",slug:"create-cmd-tool-golang",keywords:["Golang","cmd","tools"],filename:"create-cmd-tool-golang.adoc",modified:a,created:a,author:"Carlos Martin Sanchez",previewimage:"https:\u002F\u002Fgolang.org\u002Flib\u002Fgodoc\u002Fimages\u002Fgo-logo-blue.svg",otherLangs:[],path:b,url:"https:\u002F\u002Fcarlosvin.github.io\u002Fposts\u002Fcreate-cmd-tool-golang\u002Fen"},postPath:b}}(1613260800000,"\u002Fposts\u002Fcreate-cmd-tool-golang\u002Fen"))]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');var s=document.createElement("script");try{new Function("if(0)import('')")();s.src="/client/client.3b9b3283.js";s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@2.0.5.js";s.setAttribute("data-main","/client/client.3b9b3283.js")}document.head.appendChild(s)</script> <link href=client/client.css rel=stylesheet><link href=client/Details-33ee5e69.css rel=stylesheet><link href=client/[...slug]-2c0f00ca.css rel=stylesheet> <link href=/client/client.3b9b3283.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/client.css rel=preload as=style><link href=/client/[...slug].4ced8365.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/url.35c0e760.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/Details.aa7f1735.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/inject_styles.5607aec6.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/Details-33ee5e69.css rel=preload as=style><link href=/client/[...slug]-2c0f00ca.css rel=preload as=style></head> <body> <div id=sapper> <nav class=svelte-1hjvhrx><ul class=svelte-1hjvhrx><li class=svelte-1y8uoef><a href=/ rel=prefetch class=svelte-1y8uoef><img alt="Carlos says bla bla logo" class="svelte-1hjvhrx logo" src=/favicon.png></a></ul> <ul class="svelte-1hjvhrx closed"><li class=svelte-1y8uoef><a href=/ rel=prefetch class=svelte-1y8uoef><span class="svelte-1hjvhrx siteName">Carlos says bla bla</span></a></li> <li class=svelte-1y8uoef><a href=/categories rel=prefetch class=svelte-1y8uoef>Categories</a></li> <li class=svelte-1y8uoef><a href=/about rel=prefetch class=svelte-1y8uoef>About</a></ul> <div class="h svelte-1w8skyw"><a href=/feeds rel=noopener target=_blank aria-label="Subscribe to Carlos says bla bla" class="icon svelte-1lu397 rss" title="Subscribe to Carlos says bla bla"></a> <a href=https://github.com/carlosvin rel=noopener target=_blank aria-label="Find me at github" class="icon svelte-1lu397 github" title="Find me at github"></a> <a href=https://twitter.com/carlosvin rel=noopener target=_blank aria-label="Find me at twitter" class="icon svelte-1lu397 twitter" title="Find me at twitter"></a> <a href=https://stackoverflow.com/story/carlosvin rel=noopener target=_blank aria-label="Find me at stackoverflow" class="icon svelte-1lu397 stackoverflow" title="Find me at stackoverflow"></a></div> <button class=svelte-1hjvhrx type=button>≡</button></nav> <main class=svelte-bvcji9> <header class=svelte-5fppzy><h1 class=svelte-5fppzy>Easily creating a golang command line tool <span class="svelte-5fppzy share"><a href="https://twitter.com/intent/tweet?url=https://carlosvin.github.io/posts/create-cmd-tool-golang/en&text=Easily creating a golang command line tool:&amp;nbsp;Let's see how to easily and quickly create a command line tool in golang&hashtags=Golang,cmd,tools" rel=noopener target=_blank aria-label='Share "Easily creating a golang command line tool"' class="icon svelte-1lu397 twitter" title='Share "Easily creating a golang command line tool"'></a></span></h1> <p class="svelte-5fppzy summary">Let's see how to easily and quickly create a command line tool in golang</p> <div class="subtitle svelte-16mbbpz"><span class=date>14/02/2021</span> <span class="svelte-9pgfi9 tags"><a href=/categories/golang title=Golang class=svelte-1ci4az4><span class="hover svelte-askwsu">Golang</span></a><a href=/categories/cmd title=cmd class=svelte-1ci4az4><span class="hover svelte-askwsu">cmd</span></a><a href=/categories/tools title=tools class=svelte-1ci4az4><span class="hover svelte-askwsu">tools</span></a></span></div></header> <div class="content svelte-101opq9"><div class=toc id=toc> <div id=toctitle>Table of Contents</div> <ul class=sectlevel1> <li><a href=#_flags>Flags</a></li> <li><a href=#_viper>Viper</a></li> <li><a href=#_meta_viper>Meta-Viper</a></li> </ul> </div> <div id=preamble> <div class=sectionbody> <div class=paragraph> <p><a href=https://golang.org/ rel=noopener target=_blank>Golang</a> is the one of the most useful technologies I’ve recently learned. <a href=https://golang.org/ rel=noopener target=_blank>Golang</a> has a pretty nice support for networking, command line or logging out of the box, you don’t need any dependency. But there are libraries making developers' life even easier.</p> </div> <div class=paragraph> <p>I’ve already talked about <a href=/posts/rest-service-go-vs-java/ target=blank_>creating REST service in go</a>, today I’d like to focus on creating a command line tool.</p> </div> </div> </div> <div class=sect1> <h2 id=_flags>Flags</h2> <div class=sectionbody> <div class=listingblock> <div class=title>Command line tool to read number of lines as an input integer parameter <a href=https://golang.org/ rel=noopener target=_blank>Golang</a></div> <div class=content> <pre class=highlight tabindex=0><code class=language-go data-lang=go><span class=hljs-keyword>package</span> main

<span class=hljs-keyword>import</span> (
	<span class=hljs-string>"flag"</span>
	<span class=hljs-string>"fmt"</span>
)

<span class=hljs-function><span class=hljs-keyword>func</span> <span class=hljs-title>main</span><span class=hljs-params>()</span></span> {
	<span class=hljs-keyword>var</span> nFlag = flag.Int(<span class=hljs-string>"lines"</span>, <span class=hljs-number>1234</span>, <span class=hljs-string>"number of lines"</span>)
	flag.Parse()
	fmt.Printf(<span class=hljs-string>"Lines %d\n"</span>, *nFlag)
}</code></pre> </div> </div> <div class=paragraph> <p>With previous simple code we have already some useful capabilities</p> </div> <div class=listingblock> <div class=title>Print help menu</div> <div class=content> <pre class=highlight tabindex=0><code class=language-bash data-lang=bash>$ cmd --<span class=hljs-built_in>help</span>

> Usage of cmd:
    -lines int
        number of lines (default 1234)</code></pre> </div> </div> <div class=listingblock> <div class=title>Use default value</div> <div class=content> <pre class=highlight tabindex=0><code class=language-bash data-lang=bash>$ cmd

> Lines 1234</code></pre> </div> </div> <div class=listingblock> <div class=title>Pass a value to the command tool</div> <div class=content> <pre class=highlight tabindex=0><code class=language-bash data-lang=bash>$ cmd --lines=2

> Lines 2</code></pre> </div> </div> <div class=listingblock> <div class=title>Pass an invalid value</div> <div class=content> <pre class=highlight tabindex=0><code class=language-bash data-lang=bash>$ cmd --lines=asdf

> invalid value <span class=hljs-string>"asdf"</span> <span class=hljs-keyword>for</span> flag -lines: parse error
Usage of cmd:
    -lines int
        number of lines (default 1234)
<span class=hljs-built_in>exit</span> status 2</code></pre> </div> </div> <div class=paragraph> <p>For a simple command line tool, in most of the cases, we will have enough with the default language support. But if we want to bring more features to the combo like reading configuration from environment variables or from files, then a library like the awesome <a href=https://github.com/spf13/viper rel=noopener target=_blank>Viper</a> will come really handy.</p> </div> </div> </div> <div class=sect1> <h2 id=_viper>Viper</h2> <div class=sectionbody> <div class=paragraph> <p><a href=https://github.com/spf13/viper rel=noopener target=_blank>Viper</a> is very powerful and well documented library widely used from many projects, I will not get into the details or how to use it, because I’ve created an abstraction to simplify its usage, I named it <a href=https://github.com/carlosvin/meta-viper rel=noopener target=_blank>Meta-Viper</a>.</p> </div> </div> </div> <div class=sect1> <h2 id=_meta_viper>Meta-Viper</h2> <div class=sectionbody> <div class=paragraph> <p><a href=https://github.com/carlosvin/meta-viper rel=noopener target=_blank>Meta-Viper</a> abstracts you of the details of reading configuration from files, environment or flags. This extra simplicity comes with a tradeoff, we are missing some flexibility.</p> </div> <div class=paragraph> <p>Let’s see some features with an example.</p> </div> <div class=listingblock> <div class=title>Firstly we have to create a go modules project with the meta-viper dependency</div> <div class=content> <pre class=highlight tabindex=0><code class=language-bash data-lang=bash>go mod init example.com/meta-viper <b class=conum>(1)</b>

go get github.com/carlosvin/meta-viper <b class=conum>(2)</b></code></pre> </div> </div> <div class="arabic colist"> <ol> <li> <p>Create a go modules project</p> </li> <li> <p>Install the meta-viper dependency</p> </li> </ol> </div> <div class=paragraph> <p>Now let’s create a program that is configurable from files, command line params and environment variables.</p> </div> <div class=listingblock> <div class=title>main.go</div> <div class=content> <pre class=highlight tabindex=0><code class=language-go data-lang=go><span class=hljs-keyword>package</span> main

<span class=hljs-keyword>import</span> (
	<span class=hljs-string>"log"</span>
	<span class=hljs-string>"os"</span>

	config <span class=hljs-string>"github.com/carlosvin/meta-viper"</span>
)

<span class=hljs-comment>// Here is where you define the struct that will hold the configuration values</span>
<span class=hljs-comment>// cfg_name is the parameter name</span>
<span class=hljs-comment>// cfg_desc is the parameter description that will be shown in the command line help</span>
<span class=hljs-keyword>type</span> appConfig <span class=hljs-keyword>struct</span> {
	Host      <span class=hljs-keyword>string</span> <span class=hljs-string>`cfg_name:"host" cfg_desc:"Server host"`</span>
	Port      <span class=hljs-keyword>int</span>    <span class=hljs-string>`cfg_name:"port" cfg_desc:"Server port"`</span>
	SearchAPI <span class=hljs-keyword>string</span> <span class=hljs-string>`cfg_name:"apis.search" cfg_desc:"Search API endpoint"`</span>
}

<span class=hljs-function><span class=hljs-keyword>func</span> <span class=hljs-title>main</span><span class=hljs-params>()</span></span> {
	<span class=hljs-comment>// Instantiate the structure with default values</span>
	cfg := &appConfig{
		Host:      <span class=hljs-string>"localhost"</span>,
		Port:      <span class=hljs-number>6000</span>,
		SearchAPI: <span class=hljs-string>"google"</span>,
	}

	<span class=hljs-comment>// Meta-Viper instance is loading the configuration from wherever is available: files, env, or input params</span>
	_, err := config.New(cfg, os.Args)
	<span class=hljs-keyword>if</span> err != <span class=hljs-literal>nil</span> {
		<span class=hljs-built_in>panic</span>(err)
	}
	log.Printf(<span class=hljs-string>"Loaded Configuration %v..."</span>, cfg)
}</code></pre> </div> </div> <div class=paragraph> <p>Now let’s see some examples how this command line tool is able to load configuration.</p> </div> <div class=listingblock> <div class=title>Print usage (help)</div> <div class=content> <pre class=highlight tabindex=0><code class=language-bash data-lang=bash>$ cmd --<span class=hljs-built_in>help</span>

Usage of flagsConfig:
    --apis.search string    Search API endpoint (default <span class=hljs-string>"google"</span>)
    --config string         Configuration name
    --config-dirs strings   Configuration directories search paths (default [.,config,configs,cfg])
    --host string           Server host (default <span class=hljs-string>"localhost"</span>)
    --port int              Server port (default 6000)
pflag: <span class=hljs-built_in>help</span> requested
<span class=hljs-built_in>exit</span> status 2</code></pre> </div> </div> <div class=listingblock> <div class=title>Run with default values</div> <div class=content> <pre class=highlight tabindex=0><code class=language-bash data-lang=bash>$ cmd

2021/02/15 23:12:48 No configuration name has been specified, so no configuration file will be loaded. Using flags and environment variables.
2021/02/15 23:12:48 Loaded Configuration &{localhost 6000 google}...</code></pre> </div> </div> <div class=listingblock> <div class=title>Read the port from environment variable and host from input param</div> <div class=content> <pre class=highlight tabindex=0><code class=language-bash data-lang=bash>$ PORT=9999 cmd --host=myhost

2021/02/15 23:15:47 No configuration name has been specified, so no configuration file will be loaded. Using flags and environment variables.
2021/02/15 23:15:47 Loaded Configuration &{myhost 9999 google}...</code></pre> </div> </div> <div class=paragraph> <p>The last example will aggregate all the possible sources of configuration, it will extend the previous one adding configuration from a file. So let’s create a configuration file:</p> </div> <div class=listingblock> <div class=title>the-config.json</div> <div class=content> <pre class=highlight tabindex=0><code class=language-json data-lang=json>{
    <span class=hljs-attr>"apis"</span>: {
        <span class=hljs-attr>"search"</span>: <span class=hljs-string>"duckduckgo"</span>
    }
}</code></pre> </div> </div> <div class=listingblock> <div class=title>Read configuration from the-config.json file, from environment and from input params</div> <div class=content> <pre class=highlight tabindex=0><code class=language-bash data-lang=bash>$ PORT=9999 cmd --host=myhost --config=the-config

2021/02/15 23:22:17 Loaded Configuration &{myhost 9999 duckduckgo}...</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class=icon> <div class=title>Tip</div> </td> <td class=content> Here you can find a <a href=https://github.com/carlosvin/meta-viper/tree/master/examples/multi-env rel=noopener target=_blank>multi-environment example</a> a little bit more complete. </td> </tr> </table> </div> </div> </div> <div class=comments><script async src=https://utteranc.es/client.js crossorigin=anonymous issue-term=pathname repo=carlosvin/carlosvin.github.io theme=github-light></script></div></div></main> </div> 