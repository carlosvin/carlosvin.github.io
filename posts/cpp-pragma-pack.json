{"sectids":"","toc-placement":"auto","notitle":"","stylesheet":"","webfonts":"","prewrap":"","attribute-undefined":"drop-line","attribute-missing":"skip","iconfont-remote":"","caution-caption":"Caution","important-caption":"Important","note-caption":"Note","tip-caption":"Tip","warning-caption":"Warning","example-caption":"Example","figure-caption":"Figure","table-caption":"Table","toc-title":"Table of Contents","section-refsig":"Section","part-refsig":"Part","chapter-refsig":"Chapter","appendix-refsig":"Appendix","appendix-caption":"Appendix","untitled-label":"Untitled","version-label":"Version","last-update-label":"Last updated","docfile":"cpp-pragma-pack.en.adoc","docdir":"","docfilesuffix":".adoc","docname":"cpp-pragma-pack.en","embedded":"","asciidoctor":"","asciidoctor-version":"2.0.10","safe-mode-name":"secure","safe-mode-secure":"","safe-mode-level":20,"max-include-depth":64,"user-home":".","backend":"html5","max-attribute-value-size":4096,"linkcss":"","doctype":"article","htmlsyntax":"html","backend-html5-doctype-article":"","doctype-article":"","backend-html5":"","outfilesuffix":".html","filetype":"html","filetype-html":"","basebackend-html-doctype-article":"","basebackend-html":"","basebackend":"html","stylesdir":".","iconsdir":"./images/icons","localdate":"2020-05-01","localyear":"2020","localtime":"00:40:40 +0200","localdatetime":"2020-05-01 00:40:40 +0200","docdate":"2020-04-19","docyear":"2020","doctime":"10:46:31 +0200","docdatetime":"2020-04-19 10:46:31 +0200","doctitle":"C++ Struct memory alignment","date":"2012/11/26 12:00:00","keywords":["C++","Performance","Compilers","Memory"],"lang":"en","toc":"","description":"Understanding pragma pack preprocessor directive and how it affects to memory alignment","authorcount":0,"title":"C++ Struct memory alignment","summary":"Understanding pragma pack preprocessor directive and how it affects to memory alignment","html":"<div id=\"toc\" class=\"toc\">\n<div id=\"toctitle\">Table of Contents</div>\n<ul class=\"sectlevel1\">\n<li><a href=\"#_struct_example\">Struct example</a></li>\n<li><a href=\"#_pragma_pack_directive_in_c_struct\">#pragma pack directive in C++ struct</a></li>\n<li><a href=\"#_performance_test\">Performance test</a></li>\n</ul>\n</div>\n<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>A C++ struct is an element that groups attributes with different types so we can manipulate them all together using same reference. It is like a class with public visibility by default for functions and attributes.</p>\n</div>\n<div class=\"paragraph\">\n<p>If we want to work in a lower level, closer to machine, it might be useful understand how that data structure is stored in memory and how to control that mapping.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_struct_example\">Struct example</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>It has two attributes: an integer (4 bytes) and a boolean (1 byte).</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-c++\" data-lang=\"c++\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">SampleStruct</span>\n{</span>\n    <span class=\"hljs-keyword\">bool</span> flag;\n    <span class=\"hljs-keyword\">unsigned</span> <span class=\"hljs-keyword\">int</span> timeout;\n};</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>If we get the instance size using <code>sizeof</code> we should get 5 bytes size and memory would be like:</p>\n</div>\n<div id=\"5-bytes\" class=\"imageblock center\">\n<div class=\"content\">\n<img src=\"/images/c-mem-struct/5b.png\" alt=\"5Bytes\" width=\"200\" height=\"auto\">\n</div>\n<div class=\"title\">Figure 1. 5 bytes struct which uses 5 bytes in memory</div>\n</div>\n<div class=\"paragraph\">\n<p><strong>But</strong> is not that simple, memory alignment depends on compiler and system. We will learn how to control compiler alignment policy, so we can avoid getting unexpected allocation memory sizes.</p>\n</div>\n<div class=\"paragraph\">\n<p>For example, in my local host, if I get the <code>sizeof</code> the previous structure without <code>pragma</code> declarations, <strong>I get a 8 bytes size</strong>. We are getting 8 Bytes instead of expected 5 Bytes because the compiler allocates more memory at the end of structure so it fits in 2n bytes blocks. Memory actually looks like:</p>\n</div>\n<div id=\"8-bytes\" class=\"imageblock center\">\n<div class=\"content\">\n<img src=\"/images/c-mem-struct/8b.png\" alt=\"5Bytes\" width=\"200\" height=\"auto\">\n</div>\n<div class=\"title\">Without pragma: 5 bytes structure that actually spends 8 bytes in memory</div>\n</div>\n<div class=\"listingblock\">\n<div class=\"title\">It prints structure and attributes size, in this case <strong>4 + 1 is not 5</strong></div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-c++\" data-lang=\"c++\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span>  <span class=\"hljs-meta-string\">&lt;iostream&gt;</span></span>\n\n<span class=\"hljs-keyword\">using</span> <span class=\"hljs-keyword\">namespace</span> <span class=\"hljs-built_in\">std</span>;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">SampleStruct</span>\n{</span>\n    <span class=\"hljs-keyword\">bool</span> flag;\n    <span class=\"hljs-keyword\">unsigned</span> <span class=\"hljs-keyword\">int</span> timeout;\n};\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">print</span> <span class=\"hljs-params\">(<span class=\"hljs-keyword\">size_t</span> sz, <span class=\"hljs-keyword\">size_t</span> sz_flag, <span class=\"hljs-keyword\">size_t</span> sz_timeout)</span>\n</span>{\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\"\\tflag: \"</span> &lt;&lt; sz_flag &lt;&lt; <span class=\"hljs-string\">\" Bytes\"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\"\\t+\"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\"\\ttimeout: \"</span> &lt;&lt; sz_timeout &lt;&lt; <span class=\"hljs-string\">\" Bytes\"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\"\\t=\"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\"\\t\"</span> &lt;&lt; sz_timeout + sz_flag &lt;&lt; <span class=\"hljs-string\">\" Bytes\"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt;<span class=\"hljs-string\">\"sizeof struct:  \"</span> &lt;&lt; sz &lt;&lt; <span class=\"hljs-string\">\" Bytes\"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> argc, <span class=\"hljs-keyword\">char</span> *argv[])</span>\n</span>{\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\"SampleStruct\"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n    <span class=\"hljs-built_in\">print</span> (<span class=\"hljs-keyword\">sizeof</span>(SampleStruct), <span class=\"hljs-keyword\">sizeof</span>(SampleStruct::flag), <span class=\"hljs-keyword\">sizeof</span>(SampleStruct::timeout));\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\" -- \"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;\n}</code></pre>\n</div>\n</div>\n<div class=\"listingblock\">\n<div class=\"title\"><a href=\"https://coliru.stacked-crooked.com/a/7c18ee6585e57366\">Executing code with pragma pack directive</a>: We get 8 bytes instead of 5 bytes</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">SampleStruct\nflag: 1 Bytes\n+\ntimeout: 4 Bytes\n=\n5 Bytes\nsizeof struct:  8 Bytes\n--</code></pre>\n</div>\n</div>\n<div class=\"admonitionblock tip\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\">Tip</div>\n</td>\n<td class=\"content\">\nIf we want to know the exact structure size we have to specify compiler how to align the memory, to do so we have <code>#pragma pack(n)</code> directive.\n</td>\n</tr>\n</table>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_pragma_pack_directive_in_c_struct\">#pragma pack directive in C++ struct</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>It is a preprocessor directive to indicate to compiler how to align data in memory.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"title\">Example with different memory alignment configurations</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-c++\" data-lang=\"c++\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;iostream&gt;</span></span>\n\n<span class=\"hljs-keyword\">using</span> <span class=\"hljs-keyword\">namespace</span> <span class=\"hljs-built_in\">std</span>;\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">print</span> <span class=\"hljs-params\">(<span class=\"hljs-keyword\">size_t</span> sz, <span class=\"hljs-keyword\">size_t</span> sz_flag, <span class=\"hljs-keyword\">size_t</span> sz_timeout)</span>\n</span>{\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\" flag: \"</span> &lt;&lt; sz_flag &lt;&lt; <span class=\"hljs-string\">\" Bytes\"</span>&lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\" +\"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\" timeout: \"</span> &lt;&lt; sz_timeout &lt;&lt; <span class=\"hljs-string\">\"Bytes\"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\" =\"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\" \"</span> &lt;&lt; sz_timeout + sz_flag &lt;&lt; <span class=\"hljs-string\">\"Bytes\"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\" sizeof struct:  \"</span> &lt;&lt; sz &lt;&lt; <span class=\"hljs-string\">\" Bytes\"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n}\n\n<span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">pragma</span> pack (1)</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">SampleStructPack1</span>\n{</span>\n    <span class=\"hljs-keyword\">bool</span> flag;\n    <span class=\"hljs-keyword\">unsigned</span> <span class=\"hljs-keyword\">int</span> timeout;\n};\n<span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">pragma</span> pack(0)</span>\n\n<span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">pragma</span> pack (2)</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">SampleStructPack2</span>\n{</span>\n    <span class=\"hljs-keyword\">bool</span> flag;\n    <span class=\"hljs-keyword\">unsigned</span> <span class=\"hljs-keyword\">int</span> timeout;\n};\n<span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">pragma</span> pack(0)</span>\n\n<span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">pragma</span> pack (4)</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">SampleStructPack4</span>\n{</span>\n    <span class=\"hljs-keyword\">bool</span> flag;\n    <span class=\"hljs-keyword\">unsigned</span> <span class=\"hljs-keyword\">int</span> timeout;\n};\n<span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">pragma</span> pack(0)</span>\n\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">SampleStruct</span>\n{</span>\n    <span class=\"hljs-keyword\">bool</span> flag;\n    <span class=\"hljs-keyword\">unsigned</span> <span class=\"hljs-keyword\">int</span> timeout;\n};\n\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> argc, <span class=\"hljs-keyword\">char</span> *argv[])</span>\n</span>{\n\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\"SampleStructPack1\"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n    <span class=\"hljs-built_in\">print</span> (<span class=\"hljs-keyword\">sizeof</span>(SampleStructPack1), <span class=\"hljs-keyword\">sizeof</span>(SampleStructPack1::flag), <span class=\"hljs-keyword\">sizeof</span>(SampleStructPack1::timeout));\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\" -- \"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\"SampleStructPack2\"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n    <span class=\"hljs-built_in\">print</span> (<span class=\"hljs-keyword\">sizeof</span>(SampleStructPack2), <span class=\"hljs-keyword\">sizeof</span>(SampleStructPack2::flag), <span class=\"hljs-keyword\">sizeof</span>(SampleStructPack2::timeout));\n\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\"SampleStructPack4\"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n    <span class=\"hljs-built_in\">print</span> (<span class=\"hljs-keyword\">sizeof</span>(SampleStructPack4), <span class=\"hljs-keyword\">sizeof</span>(SampleStructPack4::flag), <span class=\"hljs-keyword\">sizeof</span>(SampleStructPack4::timeout));\n\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\"SampleStruct\"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n    <span class=\"hljs-built_in\">print</span> (<span class=\"hljs-keyword\">sizeof</span>(SampleStruct), <span class=\"hljs-keyword\">sizeof</span>(SampleStruct::flag), <span class=\"hljs-keyword\">sizeof</span>(SampleStruct::timeout));\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\" -- \"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;\n}</code></pre>\n</div>\n</div>\n<div class=\"listingblock\">\n<div class=\"title\"><a href=\"https://coliru.stacked-crooked.com/a/7c18ee6585e57366\">Executing code with pragma pack directive</a>, we have different results depending of pragma value.</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">SampleStructPack1 <b class=\"conum\">(1)</b>\n flag: 1 Bytes\n +\n timeout: 4Bytes\n =\n 5Bytes\n sizeof struct:  5 Bytes\n --\n\nSampleStructPack2 <b class=\"conum\">(2)</b>\n flag: 1 Bytes\n +\n timeout: 4Bytes\n =\n 5Bytes\n sizeof struct:  6 Bytes\n\nSampleStructPack4 <b class=\"conum\">(3)</b>\n flag: 1 Bytes\n +\n timeout: 4Bytes\n =\n 5Bytes\n sizeof struct:  8 Bytes\n\nSampleStruct <b class=\"conum\">(4)</b>\n flag: 1 Bytes\n +\n timeout: 4Bytes\n =\n 5Bytes\n sizeof struct:  8 Bytes</code></pre>\n</div>\n</div>\n<div class=\"colist arabic\">\n<ol>\n<li>\n<p>SampleStructPack1 <code>#pragma pack (1)</code>: It allocates 1 byte memory block, so our sample struct fits perfectly, in this case it is true that <code>4 + 1 = 5</code>.</p>\n</li>\n<li>\n<p>SampleStructPack2 <code>#pragma pack (2)</code>: Minimum block size is 2 bytes. Integer attribute fits because it just needs 2 blocks of 2 Bytes. Boolean attribute needs just 1 Byte, but minimum block size is 2 Bytes, that&#8217;s why total allocated memory is 6 bytes, <code>4 + 2 = 6</code>.</p>\n</li>\n<li>\n<p>SampleStructPack4 <code>#pragma pack (4)</code>: It is like previous one, but in this case we are wasting more memory for boolean attribute, it needs 1 Byte, but we are allocating 4 Bytes.</p>\n</li>\n<li>\n<p>SampleStruct (default compiler alignment): As you can see it behaves exactly like <code>#pragma pack (4)</code>, so we can deduct it is the default compiler alignment.</p>\n</li>\n</ol>\n</div>\n<div class=\"admonitionblock important\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\">Important</div>\n</td>\n<td class=\"content\">\nWhy don&#8217;t we always use smallest memory alignment (<code>#pragma pack (1)</code>) so we can save more memory?\n</td>\n</tr>\n</table>\n</div>\n<div class=\"admonitionblock warning\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\">Warning</div>\n</td>\n<td class=\"content\">\nBecause of performance loss.\n</td>\n</tr>\n</table>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_performance_test\">Performance test</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>The test will allocate same number of elements in arrays for each structure type (1, 2, 4).</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"title\">Test results: <a href=\"https://coliru.stacked-crooked.com/a/954ad542659c7591\">execute performance test</a></div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">SampleStructPack1: 500000000000000000 bytes allocated <span class=\"hljs-keyword\">in</span> 94311 nanoseconds\nSampleStructPack2: 600000000000000000 bytes allocated <span class=\"hljs-keyword\">in</span> 1777 nanoseconds\nSampleStructPack4: 800000000000000000 bytes allocated <span class=\"hljs-keyword\">in</span> 1519 nanoseconds</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>As you can see, the smallest memory alignment spends more time allocating and releasing memory.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"title\">Performance test source code:</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-c++\" data-lang=\"c++\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;iostream&gt;</span></span>\n<span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;chrono&gt;</span></span>\n\n<span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">pragma</span> pack (1)</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">SampleStructPack1</span>\n{</span>\n    <span class=\"hljs-keyword\">bool</span> flag;\n    <span class=\"hljs-keyword\">unsigned</span> <span class=\"hljs-keyword\">int</span> timeout;\n};\n<span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">pragma</span> pack(0)</span>\n\n<span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">pragma</span> pack (2)</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">SampleStructPack2</span>\n{</span>\n    <span class=\"hljs-keyword\">bool</span> flag;\n    <span class=\"hljs-keyword\">unsigned</span> <span class=\"hljs-keyword\">int</span> timeout;\n};\n<span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">pragma</span> pack(0)</span>\n\n<span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">pragma</span> pack (4)</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">SampleStructPack4</span>\n{</span>\n    <span class=\"hljs-keyword\">bool</span> flag;\n    <span class=\"hljs-keyword\">unsigned</span> <span class=\"hljs-keyword\">int</span> timeout;\n};\n<span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">pragma</span> pack(0)</span>\n\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">SampleStruct</span>\n{</span>\n    <span class=\"hljs-keyword\">bool</span> flag;\n    <span class=\"hljs-keyword\">unsigned</span> <span class=\"hljs-keyword\">int</span> timeout;\n};\n\n<span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">long</span> MAX_ELEMENTS = <span class=\"hljs-number\">100000000000000000</span>;\n<span class=\"hljs-keyword\">using</span> <span class=\"hljs-keyword\">namespace</span> <span class=\"hljs-built_in\">std</span>;\n<span class=\"hljs-keyword\">using</span> <span class=\"hljs-keyword\">namespace</span> <span class=\"hljs-built_in\">std</span>::chrono;\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">allocate1</span><span class=\"hljs-params\">()</span>\n</span>{\n    SampleStructPack1 elements [MAX_ELEMENTS];\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\"SampleStructPack1: \"</span> &lt;&lt; <span class=\"hljs-keyword\">sizeof</span>(elements) &lt;&lt; <span class=\"hljs-string\">\" bytes allocated\"</span>;\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">allocate2</span><span class=\"hljs-params\">()</span>\n</span>{\n    SampleStructPack2 elements [MAX_ELEMENTS];\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\"SampleStructPack2: \"</span> &lt;&lt; <span class=\"hljs-keyword\">sizeof</span>(elements) &lt;&lt; <span class=\"hljs-string\">\" bytes allocated\"</span>;\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">allocate4</span><span class=\"hljs-params\">()</span>\n</span>{\n    SampleStructPack4 elements [MAX_ELEMENTS];\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\"SampleStructPack4: \"</span> &lt;&lt; <span class=\"hljs-keyword\">sizeof</span>(elements) &lt;&lt; <span class=\"hljs-string\">\" bytes allocated\"</span>;\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">chrono1</span><span class=\"hljs-params\">()</span>\n</span>{\n    <span class=\"hljs-keyword\">auto</span> <span class=\"hljs-built_in\">begin</span> = high_resolution_clock::now() ;\n    allocate1();\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\" in \"</span> &lt;&lt; duration_cast&lt;nanoseconds&gt;(high_resolution_clock::now() - <span class=\"hljs-built_in\">begin</span>).count() &lt;&lt; <span class=\"hljs-string\">\" nanoseconds\"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">chrono2</span><span class=\"hljs-params\">()</span>\n</span>{\n    <span class=\"hljs-keyword\">auto</span> <span class=\"hljs-built_in\">begin</span> = high_resolution_clock::now() ;\n    allocate2();\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\" in \"</span> &lt;&lt; duration_cast&lt;nanoseconds&gt;(high_resolution_clock::now() - <span class=\"hljs-built_in\">begin</span>).count() &lt;&lt; <span class=\"hljs-string\">\" nanoseconds\"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">chrono4</span><span class=\"hljs-params\">()</span>\n</span>{\n    <span class=\"hljs-keyword\">auto</span> <span class=\"hljs-built_in\">begin</span> = high_resolution_clock::now() ;\n    allocate4();\n    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\" in \"</span> &lt;&lt; duration_cast&lt;nanoseconds&gt;(high_resolution_clock::now() - <span class=\"hljs-built_in\">begin</span>).count() &lt;&lt; <span class=\"hljs-string\">\" nanoseconds\"</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;\n}\n\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> argc, <span class=\"hljs-keyword\">char</span> *argv[])</span>\n</span>{\n    chrono1();\n    chrono2();\n    chrono4();\n\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;\n}</code></pre>\n</div>\n</div>\n</div>\n</div>","slug":"cpp-pragma-pack"}