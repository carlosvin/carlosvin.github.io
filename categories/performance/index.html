<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <meta content=sapper name=generator> <meta content=a22af7614c96254d name=yandex-verification> <link href=/icons/icon-192x192.png rel=apple-touch-icon> <base href=/ > <link href=global.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <link href=client/main.2949866476.css rel=stylesheet><link href=client/client.67f08357.css rel=stylesheet><link href=client/Index.375e7288.css rel=stylesheet> <noscript id=sapper-head-start></noscript><title>Performance</title><link href=/rss rel=alternate type=application/rss+xml title='Subscribe to Carlos dice "bla bla"'><meta content="Posts related with Performance" name=description><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <nav class=svelte-1v6ow72><button class=svelte-1v6ow72>≡</button> <ul class="svelte-1v6ow72 closed"><li class=svelte-1y8uoef><a href=. class=svelte-1y8uoef>Carlos dice "bla bla"</a></li> <li class=svelte-1y8uoef><a href=categories class=svelte-1y8uoef aria-current=page>Categories</a></li> <li class=svelte-1y8uoef><a href=about class=svelte-1y8uoef>About</a></ul> <div class="h svelte-1w8skyw"><a href=/rss rel=noopener class="icon svelte-hpmv97 rss" target=_blank title='Subscribe to Carlos dice "bla bla"'></a> <a href=https://github.com/carlosvin rel=noopener class="icon svelte-hpmv97 github" target=_blank title="Me at github"></a> <a href=https://twitter.com/carlosvin rel=noopener class="icon svelte-hpmv97 twitter" target=_blank title="Me at twitter"></a> <a href=https://stackoverflow.com/story/carlosvin rel=noopener class="icon svelte-hpmv97 stackoverflow" target=_blank title="Me at stackoverflow"></a></div></nav> <main class=svelte-1uhnsl8> <h1>Posts related with Performance</h1> <ul class=svelte-so88q0><li class=svelte-155n7ke><a href=/posts/cpp-pragma-pack/ rel=prefetch>C++ Struct memory alignment <span class="svelte-155n7ke date">26/11/2012</span></a> <div><span class="svelte-155n7ke summary">Understanding pragma pack preprocessor directive and how it affects to memory alignment.</span> <span class="svelte-155n7ke summary langs">Available in <span class="svelte-155n7ke lang"><a href=/posts/cpp-pragma-pack/en>en</a></span> </span></div><li class=svelte-155n7ke><a href=/posts/cpp-pragma-pack/ rel=prefetch>Alineación de una Estructura C++ en Memoria <span class="svelte-155n7ke date">26/11/2012</span></a> <div><span class="svelte-155n7ke summary">Comprendiendo cómo funciona la directiva C++ pragma pack y cómo afecta a la alineación de la memoria.</span> <span class="svelte-155n7ke summary langs">Available in <span class="svelte-155n7ke lang"><a href=/posts/cpp-pragma-pack/es>es</a></span> </span></div><li class=svelte-155n7ke><a href=/posts/serialization-java-serializable-externalizable/ rel=prefetch>Java serialization ways: Performance Comparison <span class="svelte-155n7ke date">13/05/2014</span></a> <div><span class="svelte-155n7ke summary">Java serialization ways, performance comparison.</span> <span class="svelte-155n7ke summary langs">Available in <span class="svelte-155n7ke lang"><a href=/posts/serialization-java-serializable-externalizable/en>en</a></span> </span></div><li class=svelte-155n7ke><a href=/posts/serialization-java-serializable-externalizable/ rel=prefetch>Distintas formas de serialización en Java: Comparación de rendimiento <span class="svelte-155n7ke date">13/05/2014</span></a> <div><span class="svelte-155n7ke summary">Comparación de rendimientos entre distintas formas de serialización en Java.</span> <span class="svelte-155n7ke summary langs">Available in <span class="svelte-155n7ke lang"><a href=/posts/serialization-java-serializable-externalizable/es>es</a></span> </span></div></ul></main></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al){return {category:f,posts:[{sectids:a,"toc-placement":g,notitle:a,stylesheet:a,webfonts:a,prewrap:a,"attribute-undefined":h,"attribute-missing":i,"iconfont-remote":a,"caution-caption":j,"important-caption":k,"note-caption":l,"tip-caption":m,"warning-caption":n,"example-caption":o,"figure-caption":p,"table-caption":q,"toc-title":r,"section-refsig":s,"part-refsig":t,"chapter-refsig":u,"appendix-refsig":c,"appendix-caption":c,"untitled-label":v,"version-label":w,"last-update-label":x,docfile:"cpp-pragma-pack.en.adoc",docdir:a,docfilesuffix:y,docname:"cpp-pragma-pack.en",embedded:a,asciidoctor:a,"asciidoctor-version":z,"safe-mode-name":A,"safe-mode-secure":a,"safe-mode-level":B,"max-include-depth":C,"user-home":d,backend:D,"max-attribute-value-size":E,linkcss:a,doctype:F,htmlsyntax:b,"backend-html5-doctype-article":a,"doctype-article":a,"backend-html5":a,outfilesuffix:G,filetype:b,"filetype-html":a,"basebackend-html-doctype-article":a,"basebackend-html":a,basebackend:b,stylesdir:d,iconsdir:H,localdate:I,localyear:e,localtime:N,localdatetime:O,docdate:J,docyear:e,doctime:K,docdatetime:L,doctitle:P,date:Q,keywords:[R,f,S,T],lang:U,toc:a,description:V,authorcount:M,title:P,summary:V,html:"\u003Cdiv id=\"toc\" class=\"toc\"\u003E\n\u003Cdiv id=\"toctitle\"\u003ETable of Contents\u003C\u002Fdiv\u003E\n\u003Cul class=\"sectlevel1\"\u003E\n\u003Cli\u003E\u003Ca href=\"#_struct_example\"\u003EStruct example\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_pragma_pack_directive_in_c_struct\"\u003E#pragma pack directive in C++ struct\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_performance_test\"\u003EPerformance test\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv id=\"preamble\"\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EA C++ struct is an element that groups attributes with different types so we can manipulate them all together using same reference. It is like a class with public visibility by default for functions and attributes.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EIf we want to work in a lower level, closer to machine, it might be useful understand how that data structure is stored in memory and how to control that mapping.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect1\"\u003E\n\u003Ch2 id=\"_struct_example\"\u003EStruct example\u003C\u002Fh2\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EIt has two attributes: an integer (4 bytes) and a boolean (1 byte).\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-c++\" data-lang=\"c++\"\u003E\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESampleStruct\u003C\u002Fspan\u003E\n{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ebool\u003C\u002Fspan\u003E flag;\n    \u003Cspan class=\"hljs-keyword\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E timeout;\n};\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EIf we get the instance size using \u003Ccode\u003Esizeof\u003C\u002Fcode\u003E we should get 5 bytes size and memory would be like:\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv id=\"5-bytes\" class=\"imageblock center\"\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cimg src=\"\u002Fimages\u002Fc-mem-struct\u002F5b.png\" alt=\"5Bytes\" width=\"200\" height=\"auto\"\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"title\"\u003EFigure 1. 5 bytes struct which uses 5 bytes in memory\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003E\u003Cstrong\u003EBut\u003C\u002Fstrong\u003E is not that simple, memory alignment depends on compiler and system. We will learn how to control compiler alignment policy, so we can avoid getting unexpected allocation memory sizes.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EFor example, in my local host, if I get the \u003Ccode\u003Esizeof\u003C\u002Fcode\u003E the previous structure without \u003Ccode\u003Epragma\u003C\u002Fcode\u003E declarations, \u003Cstrong\u003EI get a 8 bytes size\u003C\u002Fstrong\u003E. We are getting 8 Bytes instead of expected 5 Bytes because the compiler allocates more memory at the end of structure so it fits in 2n bytes blocks. Memory actually looks like:\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv id=\"8-bytes\" class=\"imageblock center\"\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cimg src=\"\u002Fimages\u002Fc-mem-struct\u002F8b.png\" alt=\"5Bytes\" width=\"200\" height=\"auto\"\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"title\"\u003EWithout pragma: 5 bytes structure that actually spends 8 bytes in memory\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003EIt prints structure and attributes size, in this case \u003Cstrong\u003E4 + 1 is not 5\u003C\u002Fstrong\u003E\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-c++\" data-lang=\"c++\"\u003E\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Einclude\u003C\u002Fspan\u003E  \u003Cspan class=\"hljs-meta-string\"\u003E&lt;iostream&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-keyword\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Enamespace\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003Estd\u003C\u002Fspan\u003E;\n\n\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESampleStruct\u003C\u002Fspan\u003E\n{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ebool\u003C\u002Fspan\u003E flag;\n    \u003Cspan class=\"hljs-keyword\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E timeout;\n};\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estatic\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Eprint\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-params\"\u003E(\u003Cspan class=\"hljs-keyword\"\u003Esize_t\u003C\u002Fspan\u003E sz, \u003Cspan class=\"hljs-keyword\"\u003Esize_t\u003C\u002Fspan\u003E sz_flag, \u003Cspan class=\"hljs-keyword\"\u003Esize_t\u003C\u002Fspan\u003E sz_timeout)\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"\\tflag: \"\u003C\u002Fspan\u003E &lt;&lt; sz_flag &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" Bytes\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"\\t+\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"\\ttimeout: \"\u003C\u002Fspan\u003E &lt;&lt; sz_timeout &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" Bytes\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"\\t=\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"\\t\"\u003C\u002Fspan\u003E &lt;&lt; sz_timeout + sz_flag &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" Bytes\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt;\u003Cspan class=\"hljs-string\"\u003E\"sizeof struct:  \"\u003C\u002Fspan\u003E &lt;&lt; sz &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" Bytes\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n}\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E(\u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E argc, \u003Cspan class=\"hljs-keyword\"\u003Echar\u003C\u002Fspan\u003E *argv[])\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"SampleStruct\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Eprint\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStruct), \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStruct::flag), \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStruct::timeout));\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" -- \"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E;\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003E\u003Ca href=\"https:\u002F\u002Fcoliru.stacked-crooked.com\u002Fa\u002F7c18ee6585e57366\"\u003EExecuting code with pragma pack directive\u003C\u002Fa\u003E: We get 8 bytes instead of 5 bytes\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-bash\" data-lang=\"bash\"\u003ESampleStruct\nflag: 1 Bytes\n+\ntimeout: 4 Bytes\n=\n5 Bytes\nsizeof struct:  8 Bytes\n--\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"admonitionblock tip\"\u003E\n\u003Ctable\u003E\n\u003Ctr\u003E\n\u003Ctd class=\"icon\"\u003E\n\u003Cdiv class=\"title\"\u003ETip\u003C\u002Fdiv\u003E\n\u003C\u002Ftd\u003E\n\u003Ctd class=\"content\"\u003E\nIf we want to know the exact structure size we have to specify compiler how to align the memory, to do so we have \u003Ccode\u003E#pragma pack(n)\u003C\u002Fcode\u003E directive.\n\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftable\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect1\"\u003E\n\u003Ch2 id=\"_pragma_pack_directive_in_c_struct\"\u003E#pragma pack directive in C++ struct\u003C\u002Fh2\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EIt is a preprocessor directive to indicate to compiler how to align data in memory.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003EExample with different memory alignment configurations\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-c++\" data-lang=\"c++\"\u003E\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Einclude\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-meta-string\"\u003E&lt;iostream&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-keyword\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Enamespace\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003Estd\u003C\u002Fspan\u003E;\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estatic\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Eprint\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-params\"\u003E(\u003Cspan class=\"hljs-keyword\"\u003Esize_t\u003C\u002Fspan\u003E sz, \u003Cspan class=\"hljs-keyword\"\u003Esize_t\u003C\u002Fspan\u003E sz_flag, \u003Cspan class=\"hljs-keyword\"\u003Esize_t\u003C\u002Fspan\u003E sz_timeout)\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" flag: \"\u003C\u002Fspan\u003E &lt;&lt; sz_flag &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" Bytes\"\u003C\u002Fspan\u003E&lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" +\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" timeout: \"\u003C\u002Fspan\u003E &lt;&lt; sz_timeout &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"Bytes\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" =\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" \"\u003C\u002Fspan\u003E &lt;&lt; sz_timeout + sz_flag &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"Bytes\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" sizeof struct:  \"\u003C\u002Fspan\u003E &lt;&lt; sz &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" Bytes\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n}\n\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack (1)\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESampleStructPack1\u003C\u002Fspan\u003E\n{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ebool\u003C\u002Fspan\u003E flag;\n    \u003Cspan class=\"hljs-keyword\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E timeout;\n};\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack(0)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack (2)\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESampleStructPack2\u003C\u002Fspan\u003E\n{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ebool\u003C\u002Fspan\u003E flag;\n    \u003Cspan class=\"hljs-keyword\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E timeout;\n};\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack(0)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack (4)\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESampleStructPack4\u003C\u002Fspan\u003E\n{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ebool\u003C\u002Fspan\u003E flag;\n    \u003Cspan class=\"hljs-keyword\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E timeout;\n};\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack(0)\u003C\u002Fspan\u003E\n\n\n\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESampleStruct\u003C\u002Fspan\u003E\n{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ebool\u003C\u002Fspan\u003E flag;\n    \u003Cspan class=\"hljs-keyword\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E timeout;\n};\n\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E(\u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E argc, \u003Cspan class=\"hljs-keyword\"\u003Echar\u003C\u002Fspan\u003E *argv[])\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"SampleStructPack1\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Eprint\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStructPack1), \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStructPack1::flag), \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStructPack1::timeout));\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" -- \"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"SampleStructPack2\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Eprint\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStructPack2), \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStructPack2::flag), \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStructPack2::timeout));\n\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"SampleStructPack4\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Eprint\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStructPack4), \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStructPack4::flag), \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStructPack4::timeout));\n\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"SampleStruct\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Eprint\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStruct), \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStruct::flag), \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStruct::timeout));\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" -- \"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E;\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003E\u003Ca href=\"https:\u002F\u002Fcoliru.stacked-crooked.com\u002Fa\u002F7c18ee6585e57366\"\u003EExecuting code with pragma pack directive\u003C\u002Fa\u003E, we have different results depending of pragma value.\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-bash\" data-lang=\"bash\"\u003ESampleStructPack1 \u003Cb class=\"conum\"\u003E(1)\u003C\u002Fb\u003E\n flag: 1 Bytes\n +\n timeout: 4Bytes\n =\n 5Bytes\n sizeof struct:  5 Bytes\n --\n\nSampleStructPack2 \u003Cb class=\"conum\"\u003E(2)\u003C\u002Fb\u003E\n flag: 1 Bytes\n +\n timeout: 4Bytes\n =\n 5Bytes\n sizeof struct:  6 Bytes\n\nSampleStructPack4 \u003Cb class=\"conum\"\u003E(3)\u003C\u002Fb\u003E\n flag: 1 Bytes\n +\n timeout: 4Bytes\n =\n 5Bytes\n sizeof struct:  8 Bytes\n\nSampleStruct \u003Cb class=\"conum\"\u003E(4)\u003C\u002Fb\u003E\n flag: 1 Bytes\n +\n timeout: 4Bytes\n =\n 5Bytes\n sizeof struct:  8 Bytes\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"colist arabic\"\u003E\n\u003Col\u003E\n\u003Cli\u003E\n\u003Cp\u003ESampleStructPack1 \u003Ccode\u003E#pragma pack (1)\u003C\u002Fcode\u003E: It allocates 1 byte memory block, so our sample struct fits perfectly, in this case it is true that \u003Ccode\u003E4 + 1 = 5\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003ESampleStructPack2 \u003Ccode\u003E#pragma pack (2)\u003C\u002Fcode\u003E: Minimum block size is 2 bytes. Integer attribute fits because it just needs 2 blocks of 2 Bytes. Boolean attribute needs just 1 Byte, but minimum block size is 2 Bytes, that&#8217;s why total allocated memory is 6 bytes, \u003Ccode\u003E4 + 2 = 6\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003ESampleStructPack4 \u003Ccode\u003E#pragma pack (4)\u003C\u002Fcode\u003E: It is like previous one, but in this case we are wasting more memory for boolean attribute, it needs 1 Byte, but we are allocating 4 Bytes.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003ESampleStruct (default compiler alignment): As you can see it behaves exactly like \u003Ccode\u003E#pragma pack (4)\u003C\u002Fcode\u003E, so we can deduct it is the default compiler alignment.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"admonitionblock important\"\u003E\n\u003Ctable\u003E\n\u003Ctr\u003E\n\u003Ctd class=\"icon\"\u003E\n\u003Cdiv class=\"title\"\u003EImportant\u003C\u002Fdiv\u003E\n\u003C\u002Ftd\u003E\n\u003Ctd class=\"content\"\u003E\nWhy don&#8217;t we always use smallest memory alignment (\u003Ccode\u003E#pragma pack (1)\u003C\u002Fcode\u003E) so we can save more memory?\n\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftable\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"admonitionblock warning\"\u003E\n\u003Ctable\u003E\n\u003Ctr\u003E\n\u003Ctd class=\"icon\"\u003E\n\u003Cdiv class=\"title\"\u003EWarning\u003C\u002Fdiv\u003E\n\u003C\u002Ftd\u003E\n\u003Ctd class=\"content\"\u003E\nBecause of performance loss.\n\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftable\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect1\"\u003E\n\u003Ch2 id=\"_performance_test\"\u003EPerformance test\u003C\u002Fh2\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EThe test will allocate same number of elements in arrays for each structure type (1, 2, 4).\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003ETest results: \u003Ca href=\"https:\u002F\u002Fcoliru.stacked-crooked.com\u002Fa\u002F954ad542659c7591\"\u003Eexecute performance test\u003C\u002Fa\u003E\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-bash\" data-lang=\"bash\"\u003ESampleStructPack1: 500000000000000000 bytes allocated \u003Cspan class=\"hljs-keyword\"\u003Ein\u003C\u002Fspan\u003E 94311 nanoseconds\nSampleStructPack2: 600000000000000000 bytes allocated \u003Cspan class=\"hljs-keyword\"\u003Ein\u003C\u002Fspan\u003E 1777 nanoseconds\nSampleStructPack4: 800000000000000000 bytes allocated \u003Cspan class=\"hljs-keyword\"\u003Ein\u003C\u002Fspan\u003E 1519 nanoseconds\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EAs you can see, the smallest memory alignment spends more time allocating and releasing memory.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003EPerformance test source code:\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-c++\" data-lang=\"c++\"\u003E\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Einclude\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-meta-string\"\u003E&lt;iostream&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Einclude\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-meta-string\"\u003E&lt;chrono&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack (1)\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESampleStructPack1\u003C\u002Fspan\u003E\n{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ebool\u003C\u002Fspan\u003E flag;\n    \u003Cspan class=\"hljs-keyword\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E timeout;\n};\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack(0)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack (2)\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESampleStructPack2\u003C\u002Fspan\u003E\n{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ebool\u003C\u002Fspan\u003E flag;\n    \u003Cspan class=\"hljs-keyword\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E timeout;\n};\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack(0)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack (4)\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESampleStructPack4\u003C\u002Fspan\u003E\n{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ebool\u003C\u002Fspan\u003E flag;\n    \u003Cspan class=\"hljs-keyword\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E timeout;\n};\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack(0)\u003C\u002Fspan\u003E\n\n\n\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESampleStruct\u003C\u002Fspan\u003E\n{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ebool\u003C\u002Fspan\u003E flag;\n    \u003Cspan class=\"hljs-keyword\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E timeout;\n};\n\n\u003Cspan class=\"hljs-keyword\"\u003Estatic\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Elong\u003C\u002Fspan\u003E MAX_ELEMENTS = \u003Cspan class=\"hljs-number\"\u003E100000000000000000\u003C\u002Fspan\u003E;\n\u003Cspan class=\"hljs-keyword\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Enamespace\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003Estd\u003C\u002Fspan\u003E;\n\u003Cspan class=\"hljs-keyword\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Enamespace\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003Estd\u003C\u002Fspan\u003E::chrono;\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Eallocate1\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n    SampleStructPack1 elements [MAX_ELEMENTS];\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"SampleStructPack1: \"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(elements) &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" bytes allocated\"\u003C\u002Fspan\u003E;\n}\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Eallocate2\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n    SampleStructPack2 elements [MAX_ELEMENTS];\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"SampleStructPack2: \"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(elements) &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" bytes allocated\"\u003C\u002Fspan\u003E;\n}\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Eallocate4\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n    SampleStructPack4 elements [MAX_ELEMENTS];\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"SampleStructPack4: \"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(elements) &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" bytes allocated\"\u003C\u002Fspan\u003E;\n}\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Echrono1\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n    \u003Cspan class=\"hljs-keyword\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003Ebegin\u003C\u002Fspan\u003E = high_resolution_clock::now() ;\n    allocate1();\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" in \"\u003C\u002Fspan\u003E &lt;&lt; duration_cast&lt;nanoseconds&gt;(high_resolution_clock::now() - \u003Cspan class=\"hljs-built_in\"\u003Ebegin\u003C\u002Fspan\u003E).count() &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" nanoseconds\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n}\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Echrono2\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n    \u003Cspan class=\"hljs-keyword\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003Ebegin\u003C\u002Fspan\u003E = high_resolution_clock::now() ;\n    allocate2();\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" in \"\u003C\u002Fspan\u003E &lt;&lt; duration_cast&lt;nanoseconds&gt;(high_resolution_clock::now() - \u003Cspan class=\"hljs-built_in\"\u003Ebegin\u003C\u002Fspan\u003E).count() &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" nanoseconds\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n}\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Echrono4\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n    \u003Cspan class=\"hljs-keyword\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003Ebegin\u003C\u002Fspan\u003E = high_resolution_clock::now() ;\n    allocate4();\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" in \"\u003C\u002Fspan\u003E &lt;&lt; duration_cast&lt;nanoseconds&gt;(high_resolution_clock::now() - \u003Cspan class=\"hljs-built_in\"\u003Ebegin\u003C\u002Fspan\u003E).count() &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" nanoseconds\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n}\n\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E(\u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E argc, \u003Cspan class=\"hljs-keyword\"\u003Echar\u003C\u002Fspan\u003E *argv[])\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n    chrono1();\n    chrono2();\n    chrono4();\n\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E;\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E",slug:W},{sectids:a,"toc-placement":g,notitle:a,stylesheet:a,webfonts:a,prewrap:a,"attribute-undefined":h,"attribute-missing":i,"iconfont-remote":a,"caution-caption":j,"important-caption":k,"note-caption":l,"tip-caption":m,"warning-caption":n,"example-caption":o,"figure-caption":p,"table-caption":q,"toc-title":r,"section-refsig":s,"part-refsig":t,"chapter-refsig":u,"appendix-refsig":c,"appendix-caption":c,"untitled-label":v,"version-label":w,"last-update-label":x,docfile:"cpp-pragma-pack.es.adoc",docdir:a,docfilesuffix:y,docname:"cpp-pragma-pack.es",embedded:a,asciidoctor:a,"asciidoctor-version":z,"safe-mode-name":A,"safe-mode-secure":a,"safe-mode-level":B,"max-include-depth":C,"user-home":d,backend:D,"max-attribute-value-size":E,linkcss:a,doctype:F,htmlsyntax:b,"backend-html5-doctype-article":a,"doctype-article":a,"backend-html5":a,outfilesuffix:G,filetype:b,"filetype-html":a,"basebackend-html-doctype-article":a,"basebackend-html":a,basebackend:b,stylesdir:d,iconsdir:H,localdate:I,localyear:e,localtime:N,localdatetime:O,docdate:J,docyear:e,doctime:K,docdatetime:L,doctitle:X,date:Q,keywords:[R,f,S,T],description:Y,lang:Z,previewimage:"\u002Fimages\u002Fc-mem-struct\u002F5b.png",toc:a,authorcount:M,title:X,summary:Y,html:"\u003Cdiv id=\"toc\" class=\"toc\"\u003E\n\u003Cdiv id=\"toctitle\"\u003ETable of Contents\u003C\u002Fdiv\u003E\n\u003Cul class=\"sectlevel1\"\u003E\n\u003Cli\u003E\u003Ca href=\"#_estructura_de_ejemplo\"\u003EEstructura de ejemplo\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_la_directiva_pragma_pack_en_struct_c\"\u003ELa directiva #pragma pack en struct C++\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_rendimiento\"\u003ERendimiento\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv id=\"preamble\"\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EUn struct de C++ es un elemento que permite agrupar elementos de tipos distintos con alguna relación entre ellos. Esto permite manipular todos los elementos en bloque mediante una única referencia. Podemos considerarlo como una clase con visibilidad publica por defecto para sus atributos y funciones.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003ESi alguna vez nos interesa trabajar a un nivel más bajo, nos puede resultar útil entender cómo se mapea una estructura en memoria y cómo controlar este mapeo.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect1\"\u003E\n\u003Ch2 id=\"_estructura_de_ejemplo\"\u003EEstructura de ejemplo\u003C\u002Fh2\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EEsta estructura estará compuesta por dos campos, un entero (4 bytes) y un booleano (un byte). En C++ queda de la siguiente forma:\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-c++\" data-lang=\"c++\"\u003E\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESampleStruct\u003C\u002Fspan\u003E\n{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ebool\u003C\u002Fspan\u003E flag;\n    \u003Cspan class=\"hljs-keyword\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E timeout;\n};\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003ESi hacemos un \u003Ccode\u003Esizeof\u003C\u002Fcode\u003E de una instancia de la estructura deberíamos obtener un tamaño de 5 bytes. Y la memoria quedaría de la siguiente forma:\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv id=\"5-bytes\" class=\"imageblock center\"\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cimg src=\"\u002Fimages\u002Fc-mem-struct\u002F5b.png\" alt=\"5Bytes\" width=\"200\" height=\"auto\"\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"title\"\u003EFigure 1. Estructura de 5 bytes que realmente ocupa 5 bytes en memoria\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003E\u003Cstrong\u003EPero\u003C\u002Fstrong\u003E no es tan sencillo, a continuación veremos que no nos podemos olvidar de la alineación de la memoria que hace el compilador en ese sistema y veremos cómo controlarlo para no encontrarnos con tamaños inesperados, ya que esto depende del compilador del sistema.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EPor ejemplo, si en mi máquina hago un \u003Ccode\u003Esizeof\u003C\u002Fcode\u003E de la estructura de ejemplo, \u003Cstrong\u003Eobtengo un tamaño de 8 bytes\u003C\u002Fstrong\u003E. Lo que está sucediendo es que el compilador reserva más memoria al final de la estructura para que cuadre en bloques de 2n Bytes. La memoria realmente queda de la siguiente forma:\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv id=\"8-bytes\" class=\"imageblock center\"\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cimg src=\"\u002Fimages\u002Fc-mem-struct\u002F8b.png\" alt=\"5Bytes\" width=\"200\" height=\"auto\"\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"title\"\u003ESin pragma: Estructura de 5 Bytes que realmente ocupa 8 Bytes en memoria\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003EFragmento de código que imprime el tamaño de la estructura y el de cada uno de sus atributos, en este caso 4 + 1 no es 5\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-c++\" data-lang=\"c++\"\u003E\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Einclude\u003C\u002Fspan\u003E  \u003Cspan class=\"hljs-meta-string\"\u003E&lt;iostream&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-keyword\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Enamespace\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003Estd\u003C\u002Fspan\u003E;\n\n\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESampleStruct\u003C\u002Fspan\u003E\n{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ebool\u003C\u002Fspan\u003E flag;\n    \u003Cspan class=\"hljs-keyword\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E timeout;\n};\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estatic\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Eprint\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-params\"\u003E(\u003Cspan class=\"hljs-keyword\"\u003Esize_t\u003C\u002Fspan\u003E sz, \u003Cspan class=\"hljs-keyword\"\u003Esize_t\u003C\u002Fspan\u003E sz_flag, \u003Cspan class=\"hljs-keyword\"\u003Esize_t\u003C\u002Fspan\u003E sz_timeout)\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"\\tflag: \"\u003C\u002Fspan\u003E &lt;&lt; sz_flag &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" Bytes\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"\\t+\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"\\ttimeout: \"\u003C\u002Fspan\u003E &lt;&lt; sz_timeout &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" Bytes\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"\\t=\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"\\t\"\u003C\u002Fspan\u003E &lt;&lt; sz_timeout + sz_flag &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" Bytes\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt;\u003Cspan class=\"hljs-string\"\u003E\"sizeof struct:  \"\u003C\u002Fspan\u003E &lt;&lt; sz &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" Bytes\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n}\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E(\u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E argc, \u003Cspan class=\"hljs-keyword\"\u003Echar\u003C\u002Fspan\u003E *argv[])\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"SampleStruct\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Eprint\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStruct), \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStruct::flag), \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStruct::timeout));\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" -- \"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E;\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003E\u003Ca href=\"https:\u002F\u002Fcoliru.stacked-crooked.com\u002Fa\u002Fc7deb3df49bebd40\"\u003EEjecutando el código sin la directiva pragma\u003C\u002Fa\u003E, tenemos que nuestra estructura ocupa 8 bytes en lugar de 5 bytes.\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-bash\" data-lang=\"bash\"\u003ESampleStruct\nflag: 1 Bytes\n+\ntimeout: 4 Bytes\n=\n5 Bytes\nsizeof struct:  8 Bytes\n--\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"admonitionblock tip\"\u003E\n\u003Ctable\u003E\n\u003Ctr\u003E\n\u003Ctd class=\"icon\"\u003E\n\u003Cdiv class=\"title\"\u003ETip\u003C\u002Fdiv\u003E\n\u003C\u002Ftd\u003E\n\u003Ctd class=\"content\"\u003E\nSi queremos conocer el tamaño exacto de las estructuras que vamos a utilizar, tenemos que especificar al compilador la forma de alinear la estructura en memoria, para ello utilizaremos la directiva \u003Ccode\u003E#pragma pack(n)\u003C\u002Fcode\u003E.\n\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftable\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect1\"\u003E\n\u003Ch2 id=\"_la_directiva_pragma_pack_en_struct_c\"\u003ELa directiva #pragma pack en struct C++\u003C\u002Fh2\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003ESe trata de una directiva del preprocesador que indica al compilador cómo debe realizar la alineación de la memoria.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003EEjemplo con diferentes configuraciones de alineamiento de memoria\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-c++\" data-lang=\"c++\"\u003E\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Einclude\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-meta-string\"\u003E&lt;iostream&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-keyword\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Enamespace\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003Estd\u003C\u002Fspan\u003E;\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estatic\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Eprint\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-params\"\u003E(\u003Cspan class=\"hljs-keyword\"\u003Esize_t\u003C\u002Fspan\u003E sz, \u003Cspan class=\"hljs-keyword\"\u003Esize_t\u003C\u002Fspan\u003E sz_flag, \u003Cspan class=\"hljs-keyword\"\u003Esize_t\u003C\u002Fspan\u003E sz_timeout)\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" flag: \"\u003C\u002Fspan\u003E &lt;&lt; sz_flag &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" Bytes\"\u003C\u002Fspan\u003E&lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" +\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" timeout: \"\u003C\u002Fspan\u003E &lt;&lt; sz_timeout &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"Bytes\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" =\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" \"\u003C\u002Fspan\u003E &lt;&lt; sz_timeout + sz_flag &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"Bytes\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" sizeof struct:  \"\u003C\u002Fspan\u003E &lt;&lt; sz &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" Bytes\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n}\n\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack (1)\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESampleStructPack1\u003C\u002Fspan\u003E\n{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ebool\u003C\u002Fspan\u003E flag;\n    \u003Cspan class=\"hljs-keyword\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E timeout;\n};\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack(0)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack (2)\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESampleStructPack2\u003C\u002Fspan\u003E\n{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ebool\u003C\u002Fspan\u003E flag;\n    \u003Cspan class=\"hljs-keyword\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E timeout;\n};\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack(0)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack (4)\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESampleStructPack4\u003C\u002Fspan\u003E\n{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ebool\u003C\u002Fspan\u003E flag;\n    \u003Cspan class=\"hljs-keyword\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E timeout;\n};\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack(0)\u003C\u002Fspan\u003E\n\n\n\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESampleStruct\u003C\u002Fspan\u003E\n{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ebool\u003C\u002Fspan\u003E flag;\n    \u003Cspan class=\"hljs-keyword\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E timeout;\n};\n\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E(\u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E argc, \u003Cspan class=\"hljs-keyword\"\u003Echar\u003C\u002Fspan\u003E *argv[])\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"SampleStructPack1\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Eprint\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStructPack1), \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStructPack1::flag), \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStructPack1::timeout));\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" -- \"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"SampleStructPack2\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Eprint\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStructPack2), \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStructPack2::flag), \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStructPack2::timeout));\n\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"SampleStructPack4\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Eprint\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStructPack4), \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStructPack4::flag), \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStructPack4::timeout));\n\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"SampleStruct\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-built_in\"\u003Eprint\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStruct), \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStruct::flag), \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(SampleStruct::timeout));\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" -- \"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E;\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003E\u003Ca href=\"https:\u002F\u002Fcoliru.stacked-crooked.com\u002Fa\u002F7c18ee6585e57366\"\u003EEjecutando el código con las directivas pragma\u003C\u002Fa\u003E, tenemos distintos resultados dependiendo del valor de pragma.\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-bash\" data-lang=\"bash\"\u003ESampleStructPack1 \u003Cb class=\"conum\"\u003E(1)\u003C\u002Fb\u003E\n flag: 1 Bytes\n +\n timeout: 4Bytes\n =\n 5Bytes\n sizeof struct:  5 Bytes\n --\n\nSampleStructPack2 \u003Cb class=\"conum\"\u003E(2)\u003C\u002Fb\u003E\n flag: 1 Bytes\n +\n timeout: 4Bytes\n =\n 5Bytes\n sizeof struct:  6 Bytes\n\nSampleStructPack4 \u003Cb class=\"conum\"\u003E(3)\u003C\u002Fb\u003E\n flag: 1 Bytes\n +\n timeout: 4Bytes\n =\n 5Bytes\n sizeof struct:  8 Bytes\n\nSampleStruct \u003Cb class=\"conum\"\u003E(4)\u003C\u002Fb\u003E\n flag: 1 Bytes\n +\n timeout: 4Bytes\n =\n 5Bytes\n sizeof struct:  8 Bytes\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"colist arabic\"\u003E\n\u003Col\u003E\n\u003Cli\u003E\n\u003Cp\u003ESampleStructPack1 \u003Ccode\u003E#pragma pack (1)\u003C\u002Fcode\u003E: Reserva bloques de memoria de un byte, nuestra estructura se ha ajustado perfectamente; en este caso sí que \u003Ccode\u003E4 + 1 = 5\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003ESampleStructPack2 \u003Ccode\u003E#pragma pack (2)\u003C\u002Fcode\u003E: Ahora el mínimo tamaño del bloque de memoria es de 2 bytes. Para el entero, hay un ajuste exacto porque necesita 2 bloques que 2 bytes para alojar sus 4 bytes. Para el caso del booleano, necesita un bloque de 1 byte, pero como mínimo tiene que asignar un bloque de 2 bytes, por eso en total reserva 6 bytes, \u003Ccode\u003E4 + 2 = 6\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003ESampleStructPack4 \u003Ccode\u003E#pragma pack (4)\u003C\u002Fcode\u003E: Es el mismo caso que el anterior, aunque en el caso del booleano, hay un mayor \"desperdicio\" de memoria. Necesita 1 byte, pero reserva 4 bytes que es tamaño mínimo de bloque de memoria que puede asignar el compilador.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003ESampleStruct (default compiler alignment): Como vemos se comporta exactamente igual que \u003Ccode\u003E#pragma pack (4)\u003C\u002Fcode\u003E, podemos deducir que la alineación por defecto del compilador que estamos utilizando es de 4 bytes.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"admonitionblock important\"\u003E\n\u003Ctable\u003E\n\u003Ctr\u003E\n\u003Ctd class=\"icon\"\u003E\n\u003Cdiv class=\"title\"\u003EImportant\u003C\u002Fdiv\u003E\n\u003C\u002Ftd\u003E\n\u003Ctd class=\"content\"\u003E\n¿Por qué no utilizamos siempre la alineación de memoria más ajustada (\u003Ccode\u003E#pragma pack (1)\u003C\u002Fcode\u003E) para aprovechar mejor la memoria?\n\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftable\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"admonitionblock warning\"\u003E\n\u003Ctable\u003E\n\u003Ctr\u003E\n\u003Ctd class=\"icon\"\u003E\n\u003Cdiv class=\"title\"\u003EWarning\u003C\u002Fdiv\u003E\n\u003C\u002Ftd\u003E\n\u003Ctd class=\"content\"\u003E\nPorque perderemos rendimiento.\n\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftable\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect1\"\u003E\n\u003Ch2 id=\"_rendimiento\"\u003ERendimiento\u003C\u002Fh2\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EVamos a hacer una prueba simple de rendimiento, en la que se va a reservar el mismo número de elementos en arrays para cada tipo de estructura.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EEste es el resultado:\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003E\u003Ca href=\"https:\u002F\u002Fcoliru.stacked-crooked.com\u002Fa\u002F954ad542659c7591\"\u003EResultados de la prueba de rendimiento\u003C\u002Fa\u003E.\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-bash\" data-lang=\"bash\"\u003ESampleStructPack1: 500000000000000000 bytes allocated \u003Cspan class=\"hljs-keyword\"\u003Ein\u003C\u002Fspan\u003E 94311 nanoseconds\nSampleStructPack2: 600000000000000000 bytes allocated \u003Cspan class=\"hljs-keyword\"\u003Ein\u003C\u002Fspan\u003E 1777 nanoseconds\nSampleStructPack4: 800000000000000000 bytes allocated \u003Cspan class=\"hljs-keyword\"\u003Ein\u003C\u002Fspan\u003E 1519 nanoseconds\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EComo vemos cuanto más ajustada es la alineación de memoria, más tiempo se tarda en reservar y liberar.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EA continuación pego el código de la prueba de rendimiento.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003ECódigo de las pruebas de rendimiento\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-c++\" data-lang=\"c++\"\u003E\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Einclude\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-meta-string\"\u003E&lt;iostream&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Einclude\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-meta-string\"\u003E&lt;chrono&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack (1)\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESampleStructPack1\u003C\u002Fspan\u003E\n{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ebool\u003C\u002Fspan\u003E flag;\n    \u003Cspan class=\"hljs-keyword\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E timeout;\n};\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack(0)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack (2)\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESampleStructPack2\u003C\u002Fspan\u003E\n{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ebool\u003C\u002Fspan\u003E flag;\n    \u003Cspan class=\"hljs-keyword\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E timeout;\n};\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack(0)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack (4)\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESampleStructPack4\u003C\u002Fspan\u003E\n{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ebool\u003C\u002Fspan\u003E flag;\n    \u003Cspan class=\"hljs-keyword\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E timeout;\n};\n\u003Cspan class=\"hljs-meta\"\u003E#\u003Cspan class=\"hljs-meta-keyword\"\u003Epragma\u003C\u002Fspan\u003E pack(0)\u003C\u002Fspan\u003E\n\n\n\u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESampleStruct\u003C\u002Fspan\u003E\n{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ebool\u003C\u002Fspan\u003E flag;\n    \u003Cspan class=\"hljs-keyword\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E timeout;\n};\n\n\u003Cspan class=\"hljs-keyword\"\u003Estatic\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Elong\u003C\u002Fspan\u003E MAX_ELEMENTS = \u003Cspan class=\"hljs-number\"\u003E100000000000000000\u003C\u002Fspan\u003E;\n\u003Cspan class=\"hljs-keyword\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Enamespace\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003Estd\u003C\u002Fspan\u003E;\n\u003Cspan class=\"hljs-keyword\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Enamespace\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003Estd\u003C\u002Fspan\u003E::chrono;\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Eallocate1\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n    SampleStructPack1 elements [MAX_ELEMENTS];\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"SampleStructPack1: \"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(elements) &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" bytes allocated\"\u003C\u002Fspan\u003E;\n}\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Eallocate2\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n    SampleStructPack2 elements [MAX_ELEMENTS];\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"SampleStructPack2: \"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(elements) &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" bytes allocated\"\u003C\u002Fspan\u003E;\n}\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Eallocate4\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n    SampleStructPack4 elements [MAX_ELEMENTS];\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\"SampleStructPack4: \"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-keyword\"\u003Esizeof\u003C\u002Fspan\u003E(elements) &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" bytes allocated\"\u003C\u002Fspan\u003E;\n}\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Echrono1\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n    \u003Cspan class=\"hljs-keyword\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003Ebegin\u003C\u002Fspan\u003E = high_resolution_clock::now() ;\n    allocate1();\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" in \"\u003C\u002Fspan\u003E &lt;&lt; duration_cast&lt;nanoseconds&gt;(high_resolution_clock::now() - \u003Cspan class=\"hljs-built_in\"\u003Ebegin\u003C\u002Fspan\u003E).count() &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" nanoseconds\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n}\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Echrono2\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n    \u003Cspan class=\"hljs-keyword\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003Ebegin\u003C\u002Fspan\u003E = high_resolution_clock::now() ;\n    allocate2();\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" in \"\u003C\u002Fspan\u003E &lt;&lt; duration_cast&lt;nanoseconds&gt;(high_resolution_clock::now() - \u003Cspan class=\"hljs-built_in\"\u003Ebegin\u003C\u002Fspan\u003E).count() &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" nanoseconds\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n}\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Echrono4\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n    \u003Cspan class=\"hljs-keyword\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003Ebegin\u003C\u002Fspan\u003E = high_resolution_clock::now() ;\n    allocate4();\n    \u003Cspan class=\"hljs-built_in\"\u003Ecout\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" in \"\u003C\u002Fspan\u003E &lt;&lt; duration_cast&lt;nanoseconds&gt;(high_resolution_clock::now() - \u003Cspan class=\"hljs-built_in\"\u003Ebegin\u003C\u002Fspan\u003E).count() &lt;&lt; \u003Cspan class=\"hljs-string\"\u003E\" nanoseconds\"\u003C\u002Fspan\u003E &lt;&lt; \u003Cspan class=\"hljs-built_in\"\u003Eendl\u003C\u002Fspan\u003E;\n}\n\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E(\u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E argc, \u003Cspan class=\"hljs-keyword\"\u003Echar\u003C\u002Fspan\u003E *argv[])\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E{\n    chrono1();\n    chrono2();\n    chrono4();\n\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E;\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E",slug:W},{sectids:a,"toc-placement":g,notitle:a,stylesheet:a,webfonts:a,prewrap:a,"attribute-undefined":h,"attribute-missing":i,"iconfont-remote":a,"caution-caption":j,"important-caption":k,"note-caption":l,"tip-caption":m,"warning-caption":n,"example-caption":o,"figure-caption":p,"table-caption":q,"toc-title":r,"section-refsig":s,"part-refsig":t,"chapter-refsig":u,"appendix-refsig":c,"appendix-caption":c,"untitled-label":v,"version-label":w,"last-update-label":x,docfile:"serialization-java-serializable-externalizable.en.adoc",docdir:a,docfilesuffix:y,docname:"serialization-java-serializable-externalizable.en",embedded:a,asciidoctor:a,"asciidoctor-version":z,"safe-mode-name":A,"safe-mode-secure":a,"safe-mode-level":B,"max-include-depth":C,"user-home":d,backend:D,"max-attribute-value-size":E,linkcss:a,doctype:F,htmlsyntax:b,"backend-html5-doctype-article":a,"doctype-article":a,"backend-html5":a,outfilesuffix:G,filetype:b,"filetype-html":a,"basebackend-html-doctype-article":a,"basebackend-html":a,basebackend:b,stylesdir:d,iconsdir:H,localdate:I,localyear:e,localtime:_,localdatetime:$,docdate:J,docyear:e,doctime:K,docdatetime:L,doctitle:aa,date:ab,lang:U,toc:a,description:ac,keywords:[ad,f],java:ae,json:af,xml:ag,serializable:ah,externalizable:ai,authorcount:M,title:aa,summary:ac,html:"\u003Cdiv id=\"toc\" class=\"toc\"\u003E\n\u003Cdiv id=\"toctitle\"\u003ETable of Contents\u003C\u002Fdiv\u003E\n\u003Cul class=\"sectlevel1\"\u003E\n\u003Cli\u003E\u003Ca href=\"#_serializable\"\u003ESerializable\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_externalizable\"\u003EExternalizable\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_performance_tests_serializable_vs_externalizable\"\u003EPerformance tests (Serializable vs. Externalizable)\u003C\u002Fa\u003E\n\u003Cul class=\"sectlevel2\"\u003E\n\u003Cli\u003E\u003Ca href=\"#_implementing_serializable\"\u003EImplementing Serializable\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_implementing_externalizable_wrong_way\"\u003EImplementing Externalizable (wrong way)\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_implementing_externalizable_right_way\"\u003EImplementing Externalizable (right way)\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_results_analysis\"\u003EResults Analysis\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv id=\"preamble\"\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003ERecently I&#8217;ve had to serialize\u002Fdeserialize some data in \u003Ca href=\"https:\u002F\u002Fwww.java.com\" target=\"_blank\" rel=\"noopener\"\u003EJava\u003C\u002Fa\u003E binary format. Lately I use \u003Ca href=\"https:\u002F\u002Fwww.json.org\" target=\"_blank\" rel=\"noopener\"\u003EJSON\u003C\u002Fa\u003E or \u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FXML\" target=\"_blank\" rel=\"noopener\"\u003EXML\u003C\u002Fa\u003E formats.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EI remember that to serialize \u003Ca href=\"https:\u002F\u002Fwww.java.com\" target=\"_blank\" rel=\"noopener\"\u003EJava\u003C\u002Fa\u003E objects they must implement the \u003Ca href=\"https:\u002F\u002Fdocs.oracle.com\u002Fjavase\u002F7\u002Fdocs\u002Fapi\u002Fjava\u002Fio\u002FSerializable.html\" target=\"_blank\" rel=\"noopener\"\u003ESerializable\u003C\u002Fa\u003E interface, but I had also read in Internet other way, implementing the \u003Ca href=\"https:\u002F\u002Fdocs.oracle.com\u002Fjavase\u002F7\u002Fdocs\u002Fapi\u002Fjava\u002Fio\u002FExternalizable.html\" target=\"_blank\" rel=\"noopener\"\u003EExternalizable\u003C\u002Fa\u003E interface, then, which interface must I implement? It depends on what you want such as everything in the life.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EWhen to use \u003Ca href=\"#_serializable\"\u003ESerializable\u003C\u002Fa\u003E or \u003Ca href=\"#_externalizable\"\u003EExternalizable\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect1\"\u003E\n\u003Ch2 id=\"_serializable\"\u003ESerializable\u003C\u002Fh2\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"ulist\"\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003ETo serialize easily. You have to write less code.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003EThis way has some restrictions: The object to serialize must implement the default constructor (0 args). It must be responsible to manage the parent class attributes.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003EThe performance is not as important, we will see more about that in \u003Ca href=\"#_performance_tests_serializable_vs_externalizable\"\u003EPerformance tests (Serializable vs. Externalizable)\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect1\"\u003E\n\u003Ch2 id=\"_externalizable\"\u003EExternalizable\u003C\u002Fh2\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"ulist\"\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003EYou must implement the serialization\u002Fdeserialization methods, so you have to write more code.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003EWhen you cannot use \u003Ca href=\"#_serializable\"\u003ESerializable\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003EWhen you want to improve the performance, as we&#8217;ll see in \u003Ca href=\"#_performance_tests_serializable_vs_externalizable\"\u003EPerformance tests (Serializable vs. Externalizable)\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003EIf you have to manage the serialization of parent class attributes, then I recommend you use \u003Ca href=\"https:\u002F\u002Fdocs.oracle.com\u002Fjavase\u002F7\u002Fdocs\u002Fapi\u002Fjava\u002Fio\u002FExternalizable.html\" target=\"_blank\" rel=\"noopener\"\u003EExternalizable\u003C\u002Fa\u003E, because we&#8217;ll avoid a weird private methods overriding.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-java\" data-lang=\"java\"\u003E\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eprivate\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EwriteObject\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E(ObjectOutputStream oos)\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Eprivate\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EreadObject\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E(ObjectInputStream ois)\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect1\"\u003E\n\u003Ch2 id=\"_performance_tests_serializable_vs_externalizable\"\u003EPerformance tests (Serializable vs. Externalizable)\u003C\u002Fh2\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003E\u003Ca href=\"#_serializable\"\u003ESerializable\u003C\u002Fa\u003E: Java, through introspection, guesses the types of class attributes to know how to serialize\u002Fdeserialize them, but this \"magic\" is not free, it has a performance penalty.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EWhen we use \u003Ca href=\"#_externalizable\"\u003EExternalizable\u003C\u002Fa\u003E interface, we decide how to serialize\u002Fdeserialize, namely we have to write the code that does it. We&#8217;ve lost ease, but also we avoid that \u003Ca href=\"https:\u002F\u002Fwww.java.com\" target=\"_blank\" rel=\"noopener\"\u003EJava\u003C\u002Fa\u003E does some tasks, so if we override the methods properly, we&#8217;ll get a performance improvement.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003ETo know how big is the performance difference between both interfaces, I&#8217;ve written a \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fcarlosvin\u002Fserializations-performance-java\" target=\"_blank\" rel=\"noopener\"\u003Etiny example in which we serialize an object with 2 collections with 100000 elements each one\u003C\u002Fa\u003E. Here you can find the \u003Ca href=\"http:\u002F\u002Fcarlosvin.github.io\u002Fserializations-performance-java\u002Fclasses\u002Fcom.github.carlosvin.contacts.SerializationTest.html\" target=\"_blank\" rel=\"noopener\"\u003Etests execution results\u003C\u002Fa\u003E. There are 3 different implementations:\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect2\"\u003E\n\u003Ch3 id=\"_implementing_serializable\"\u003EImplementing Serializable\u003C\u002Fh3\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EAs we mentioned above, \u003Ca href=\"https:\u002F\u002Fwww.java.com\" target=\"_blank\" rel=\"noopener\"\u003EJava\u003C\u002Fa\u003E has to guess certain things. During this process it sacrifices some of performance (slowest way), in exchange we get really simple source code, the class to serialize just has to implement the \u003Ca href=\"https:\u002F\u002Fdocs.oracle.com\u002Fjavase\u002F7\u002Fdocs\u002Fapi\u002Fjava\u002Fio\u002FSerializable.html\" target=\"_blank\" rel=\"noopener\"\u003ESerializable\u003C\u002Fa\u003E interface.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-java\" data-lang=\"java\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Epublic\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EContacts\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eimplements\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESerializable\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E{\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F ...\u003C\u002Fspan\u003E\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"ulist\"\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003Eserializing: 1133 millisecond\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003Edeserializing: 506 millisecond\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect2\"\u003E\n\u003Ch3 id=\"_implementing_externalizable_wrong_way\"\u003EImplementing Externalizable (wrong way)\u003C\u002Fh3\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EIf the class implements \u003Ca href=\"https:\u002F\u002Fdocs.oracle.com\u002Fjavase\u002F7\u002Fdocs\u002Fapi\u002Fjava\u002Fio\u002FExternalizable.html\" target=\"_blank\" rel=\"noopener\"\u003EExternalizable\u003C\u002Fa\u003E, we must tell to \u003Ca href=\"https:\u002F\u002Fwww.java.com\" target=\"_blank\" rel=\"noopener\"\u003EJava\u003C\u002Fa\u003E how it has to serialize\u002Fdeserialize the class attributes. We just have to be careful, because if we did it bad, then we&#8217;ll get the worst of the both worlds: more complex implementation and bad performance, i.e: If we serialize\u002Fdeserialize complex class attributes (like collections), \u003Ca href=\"https:\u002F\u002Fwww.java.com\" target=\"_blank\" rel=\"noopener\"\u003EJava\u003C\u002Fa\u003E will also have to guess many things about the attributes type.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-java\" data-lang=\"java\"\u003E\u003Cspan class=\"hljs-meta\"\u003E@Override\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Epublic\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EreadExternal\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E(ObjectInput in)\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ethrows\u003C\u002Fspan\u003E IOException, ClassNotFoundException \u003C\u002Fspan\u003E{\n  setEmails((Set&lt;String&gt;) in.readObject());\n  setPhones((Set&lt;String&gt;) in.readObject());\n}\n\n\u003Cspan class=\"hljs-meta\"\u003E@Override\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Epublic\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EwriteExternal\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E(ObjectOutput out)\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ethrows\u003C\u002Fspan\u003E IOException \u003C\u002Fspan\u003E{\n  out.writeObject(emails);\n  out.writeObject(phones);\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"ulist\"\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003Eserializing: 737 millisecond\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003Edeserializing: 367 millisecond\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect2\"\u003E\n\u003Ch3 id=\"_implementing_externalizable_right_way\"\u003EImplementing Externalizable (right way)\u003C\u002Fh3\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EIf we serialize one by one the collection elements, then we&#8217;ll save more time, because \u003Ca href=\"https:\u002F\u002Fwww.java.com\" target=\"_blank\" rel=\"noopener\"\u003EJava\u003C\u002Fa\u003E serializes simple types, this way avoids guessing things that we actually know.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-java\" data-lang=\"java\"\u003E\u003Cspan class=\"hljs-meta\"\u003E@Override\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Epublic\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EreadExternal\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E(ObjectInput in)\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ethrows\u003C\u002Fspan\u003E IOException, ClassNotFoundException \u003C\u002Fspan\u003E{\n  emails.clear();\n  phones.clear();\n  \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E nEmails = in.readInt();\n  \u003Cspan class=\"hljs-keyword\"\u003Efor\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E i = \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E; i &lt; nEmails; i++) {\n    emails.add(in.readUTF());\n  }\n  \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E nPhones = in.readInt();\n  \u003Cspan class=\"hljs-keyword\"\u003Efor\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E i = \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E; i &lt; nPhones; i++) {\n    phones.add(in.readUTF());\n  }\n}\n\n\u003Cspan class=\"hljs-meta\"\u003E@Override\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Epublic\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EwriteExternal\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E(ObjectOutput out)\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ethrows\u003C\u002Fspan\u003E IOException \u003C\u002Fspan\u003E{\n  out.writeInt(emails.size());\n  \u003Cspan class=\"hljs-keyword\"\u003Efor\u003C\u002Fspan\u003E (String e : emails) {\n    out.writeUTF(e);\n  }\n  out.writeInt(phones.size());\n  \u003Cspan class=\"hljs-keyword\"\u003Efor\u003C\u002Fspan\u003E (String p : phones) {\n    out.writeUTF(p);\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"ulist\"\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003Eserializing: 204 millisecond\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003Edeserializing: 92 millisecond\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EWe&#8217;ve gained performance at expense of write more code.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect2\"\u003E\n\u003Ch3 id=\"_results_analysis\"\u003EResults Analysis\u003C\u002Fh3\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EWe don&#8217;t gain performance due to use an interface or the other one.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EWe gain performance because \u003Ca href=\"#_externalizable\"\u003EExternalizable\u003C\u002Fa\u003E interface forces us to implement ourselves the guessing code, so \u003Ca href=\"https:\u002F\u002Fwww.java.com\" target=\"_blank\" rel=\"noopener\"\u003EJava\u003C\u002Fa\u003E doesn&#8217;t have to do that.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EAs we have seen at \u003Ca href=\"#_implementing_externalizable_wrong_way\"\u003EImplementing Externalizable (wrong way)\u003C\u002Fa\u003E, si no tenemos cuidado, conseguiremos una mejora poco significativa a costa de complicar nuestro código fuente.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"ulist\"\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Ca href=\"http:\u002F\u002Fcarlosvin.github.io\u002Fserializations-performance-java\u002Fclasses\u002Fcom.github.carlosvin.contacts.SerializationTest.html\" target=\"_blank\" rel=\"noopener\"\u003ETest results\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fcarlosvin\u002Fserializations-performance-java\u002F\"\u003ECode in Github\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E",slug:aj},{sectids:a,"toc-placement":g,notitle:a,stylesheet:a,webfonts:a,prewrap:a,"attribute-undefined":h,"attribute-missing":i,"iconfont-remote":a,"caution-caption":j,"important-caption":k,"note-caption":l,"tip-caption":m,"warning-caption":n,"example-caption":o,"figure-caption":p,"table-caption":q,"toc-title":r,"section-refsig":s,"part-refsig":t,"chapter-refsig":u,"appendix-refsig":c,"appendix-caption":c,"untitled-label":v,"version-label":w,"last-update-label":x,docfile:"serialization-java-serializable-externalizable.es.adoc",docdir:a,docfilesuffix:y,docname:"serialization-java-serializable-externalizable.es",embedded:a,asciidoctor:a,"asciidoctor-version":z,"safe-mode-name":A,"safe-mode-secure":a,"safe-mode-level":B,"max-include-depth":C,"user-home":d,backend:D,"max-attribute-value-size":E,linkcss:a,doctype:F,htmlsyntax:b,"backend-html5-doctype-article":a,"doctype-article":a,"backend-html5":a,outfilesuffix:G,filetype:b,"filetype-html":a,"basebackend-html-doctype-article":a,"basebackend-html":a,basebackend:b,stylesdir:d,iconsdir:H,localdate:I,localyear:e,localtime:_,localdatetime:$,docdate:J,docyear:e,doctime:K,docdatetime:L,doctitle:ak,date:ab,lang:Z,toc:a,description:al,keywords:[ad,f],java:ae,json:af,xml:ag,serializable:ah,externalizable:ai,authorcount:M,title:ak,summary:al,html:"\u003Cdiv id=\"toc\" class=\"toc\"\u003E\n\u003Cdiv id=\"toctitle\"\u003ETable of Contents\u003C\u002Fdiv\u003E\n\u003Cul class=\"sectlevel1\"\u003E\n\u003Cli\u003E\u003Ca href=\"#_serializable\"\u003ESerializable\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_externalizable\"\u003EExternalizable\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_pruebas_de_rendimiento_serializable_vs_externalizable\"\u003EPruebas de Rendimiento (Serializable vs Externalizable)\u003C\u002Fa\u003E\n\u003Cul class=\"sectlevel2\"\u003E\n\u003Cli\u003E\u003Ca href=\"#_implementando_el_interfaz_serializable\"\u003EImplementando el interfaz Serializable\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_utilizando_el_interfaz_externalizable_mal\"\u003EUtilizando el interfaz Externalizable (mal)\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_utilizando_el_interfaz_externalizable_correctamente\"\u003EUtilizando el interfaz Externalizable (correctamente)\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_analizando_los_resultados\"\u003EAnalizando los resultados\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv id=\"preamble\"\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EHace poco, he tenido que serializar\u002Fdeserializar unos datos en \u003Ca href=\"https:\u002F\u002Fwww.java.com\" target=\"_blank\" rel=\"noopener\"\u003EJava\u003C\u002Fa\u003E, hacía mucho que no lo hacía en formato binario directamente (ultimamente he utilizado \u003Ca href=\"https:\u002F\u002Fwww.json.org\" target=\"_blank\" rel=\"noopener\"\u003EJSON\u003C\u002Fa\u003E o \u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FXML\" target=\"_blank\" rel=\"noopener\"\u003EXML\u003C\u002Fa\u003E). Recordaba haber serializado objetos implementando el interfaz \u003Ca href=\"https:\u002F\u002Fdocs.oracle.com\u002Fjavase\u002F7\u002Fdocs\u002Fapi\u002Fjava\u002Fio\u002FSerializable.html\" target=\"_blank\" rel=\"noopener\"\u003ESerializable\u003C\u002Fa\u003E, pero había visto por Internet otra forma implementando el interfaz \u003Ca href=\"https:\u002F\u002Fdocs.oracle.com\u002Fjavase\u002F7\u002Fdocs\u002Fapi\u002Fjava\u002Fio\u002FExternalizable.html\" target=\"_blank\" rel=\"noopener\"\u003EExternalizable\u003C\u002Fa\u003E, ¿cuál interfaz utilizo? Pues depende lo que quieras y necesites, como todo.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EVeamos cuándo utilizar \u003Ca href=\"#_serializable\"\u003ESerializable\u003C\u002Fa\u003E o \u003Ca href=\"#_externalizable\"\u003EExternalizable\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect1\"\u003E\n\u003Ch2 id=\"_serializable\"\u003ESerializable\u003C\u002Fh2\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"ulist\"\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003ECuando quieras escribir poco código, es la forma fácil.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003EPero tiene algunas restricciones: El objeto a serializar debe implementar el constructor por defecto. Debe hacerse responsable de los atributos no accesibles de la clase padre.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003ECuando no te importe mucho el rendimiento, como veremos en la sección \u003Ca href=\"#_pruebas_de_rendimiento_serializable_vs_externalizable\"\u003EPruebas de Rendimiento (Serializable vs Externalizable)\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect1\"\u003E\n\u003Ch2 id=\"_externalizable\"\u003EExternalizable\u003C\u002Fh2\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"ulist\"\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003EVas a tener que implementar tú mismo los métodos de serialización.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003ECuando no puedas utilizar \u003Ca href=\"#_serializable\"\u003ESerializable\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003ECuando quieras obtener un mejor rendimiento, como veremos en la sección \u003Ca href=\"#_pruebas_de_rendimiento_serializable_vs_externalizable\"\u003EPruebas de Rendimiento (Serializable vs Externalizable)\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003ESi tienes que encargarte de la serialización de los atributos de la clase padre, te recomiendo utilizar \u003Ca href=\"https:\u002F\u002Fdocs.oracle.com\u002Fjavase\u002F7\u002Fdocs\u002Fapi\u002Fjava\u002Fio\u002FExternalizable.html\" target=\"_blank\" rel=\"noopener\"\u003EExternalizable\u003C\u002Fa\u003E, porque evitamos una sobrescritura extraña de métodos privados.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-java\" data-lang=\"java\"\u003E\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eprivate\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EwriteObject\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E(ObjectOutputStream oos)\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Eprivate\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EreadObject\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E(ObjectInputStream ois)\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect1\"\u003E\n\u003Ch2 id=\"_pruebas_de_rendimiento_serializable_vs_externalizable\"\u003EPruebas de Rendimiento (Serializable vs Externalizable)\u003C\u002Fh2\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EEl interfaz \u003Ca href=\"#_serializable\"\u003ESerializable\u003C\u002Fa\u003E utilizando la introspección de \u003Ca href=\"https:\u002F\u002Fwww.java.com\" target=\"_blank\" rel=\"noopener\"\u003EJava\u003C\u002Fa\u003E, adivina los tipos de los atributos de las clases que va a serializar\u002Fdeserializar, pero esta \"magia\" tiene una penalización en el rendimiento.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EAl utilizar el interfaz \u003Ca href=\"#_externalizable\"\u003EExternalizable\u003C\u002Fa\u003E somos nosotros los que decidimos cómo serializar\u002Fdeserializar los objetos, es decir, tenemos que escribir nosotros el código que hace esto. Hemos perdido comodidad, pero evitamos que \u003Ca href=\"https:\u002F\u002Fwww.java.com\" target=\"_blank\" rel=\"noopener\"\u003EJava\u003C\u002Fa\u003E haga algunas tareas y, si sobrescribimos correctamente los métodos del interfaz \u003Ca href=\"#_externalizable\"\u003EExternalizable\u003C\u002Fa\u003E, conseguiremos una mejora de rendimiento.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EPara saber cuánto es la diferencia de rendimiento, he escrito un \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fcarlosvin\u002Fserializations-performance-java\" target=\"_blank\" rel=\"noopener\"\u003Epequeño ejemplo en el que se serializa un objeto con dos colecciones con 100000 emails y 100000 teléfonos\u003C\u002Fa\u003E. He contemplado 3 casos:\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect2\"\u003E\n\u003Ch3 id=\"_implementando_el_interfaz_serializable\"\u003EImplementando el interfaz Serializable\u003C\u002Fh3\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EComo dijimos más arriba, cuando implementamos el interfaz \u003Ca href=\"https:\u002F\u002Fdocs.oracle.com\u002Fjavase\u002F7\u002Fdocs\u002Fapi\u002Fjava\u002Fio\u002FSerializable.html\" target=\"_blank\" rel=\"noopener\"\u003ESerializable\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fwww.java.com\" target=\"_blank\" rel=\"noopener\"\u003EJava\u003C\u002Fa\u003E tiene que adivinar ciertas cosas, en este proceso sacrifica algo de rendimiento (es el que más tarda), a cambio ĺo único que tenemos que hacer es que nuestra clase implemente el interfaz \u003Ca href=\"https:\u002F\u002Fdocs.oracle.com\u002Fjavase\u002F7\u002Fdocs\u002Fapi\u002Fjava\u002Fio\u002FSerializable.html\" target=\"_blank\" rel=\"noopener\"\u003ESerializable\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-java\" data-lang=\"java\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Epublic\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-class\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EContacts\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eimplements\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003ESerializable\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E{\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F ...\u003C\u002Fspan\u003E\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"ulist\"\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003E1133 milisegundos en serializar\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E506 milisegundos en deserializar\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect2\"\u003E\n\u003Ch3 id=\"_utilizando_el_interfaz_externalizable_mal\"\u003EUtilizando el interfaz Externalizable (mal)\u003C\u002Fh3\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EEn este caso somos nosotros los encargados de \"decir\" a \u003Ca href=\"https:\u002F\u002Fwww.java.com\" target=\"_blank\" rel=\"noopener\"\u003EJava\u003C\u002Fa\u003E cómo debe serializar\u002Fdeserializar, pero debemos ser cuidadosos, de lo contrario podemos quedarnos con lo peor de los dos mundos, por ejemplo: Si simplemente serializamos\u002Fdeserializamos los atributos de la clase, y estos son atributos complejos (como colecciones), \u003Ca href=\"https:\u002F\u002Fwww.java.com\" target=\"_blank\" rel=\"noopener\"\u003EJava\u003C\u002Fa\u003E también tiene que adivinar bastantes cosas y también sacrificamos algo de rendimiento y además hemos tenido que escribir más código.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-java\" data-lang=\"java\"\u003E\u003Cspan class=\"hljs-meta\"\u003E@Override\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Epublic\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EreadExternal\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E(ObjectInput in)\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ethrows\u003C\u002Fspan\u003E IOException, ClassNotFoundException \u003C\u002Fspan\u003E{\n  setEmails((Set&lt;String&gt;) in.readObject());\n  setPhones((Set&lt;String&gt;) in.readObject());\n}\n\n\u003Cspan class=\"hljs-meta\"\u003E@Override\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Epublic\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EwriteExternal\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E(ObjectOutput out)\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ethrows\u003C\u002Fspan\u003E IOException \u003C\u002Fspan\u003E{\n  out.writeObject(emails);\n  out.writeObject(phones);\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"ulist\"\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003E737 milisegundos en serializar\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E367 milisegundos en deserializar\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect2\"\u003E\n\u003Ch3 id=\"_utilizando_el_interfaz_externalizable_correctamente\"\u003EUtilizando el interfaz Externalizable (correctamente)\u003C\u002Fh3\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003ESi serializamos\u002Fdeserializamos uno por uno los elementos de las colecciones, ahorramos aún más tiempo, porque \u003Ca href=\"https:\u002F\u002Fwww.java.com\" target=\"_blank\" rel=\"noopener\"\u003EJava\u003C\u002Fa\u003E está serializando tipos más simples (en este caso java.lang.String).\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"listingblock\"\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cpre class=\"highlight\"\u003E\u003Ccode class=\"language-java\" data-lang=\"java\"\u003E\u003Cspan class=\"hljs-meta\"\u003E@Override\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Epublic\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EreadExternal\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E(ObjectInput in)\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ethrows\u003C\u002Fspan\u003E IOException, ClassNotFoundException \u003C\u002Fspan\u003E{\n  emails.clear();\n  phones.clear();\n  \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E nEmails = in.readInt();\n  \u003Cspan class=\"hljs-keyword\"\u003Efor\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E i = \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E; i &lt; nEmails; i++) {\n    emails.add(in.readUTF());\n  }\n  \u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E nPhones = in.readInt();\n  \u003Cspan class=\"hljs-keyword\"\u003Efor\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-keyword\"\u003Eint\u003C\u002Fspan\u003E i = \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E; i &lt; nPhones; i++) {\n    phones.add(in.readUTF());\n  }\n}\n\n\u003Cspan class=\"hljs-meta\"\u003E@Override\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Epublic\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EwriteExternal\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E(ObjectOutput out)\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ethrows\u003C\u002Fspan\u003E IOException \u003C\u002Fspan\u003E{\n  out.writeInt(emails.size());\n  \u003Cspan class=\"hljs-keyword\"\u003Efor\u003C\u002Fspan\u003E (String e : emails) {\n    out.writeUTF(e);\n  }\n  out.writeInt(phones.size());\n  \u003Cspan class=\"hljs-keyword\"\u003Efor\u003C\u002Fspan\u003E (String p : phones) {\n    out.writeUTF(p);\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"ulist\"\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003E204 milisegundos en serializar\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E92 milisegundos en deserializar\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EHemos ganado rendimiento a costa de escribir un poco más de código.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect2\"\u003E\n\u003Ch3 id=\"_analizando_los_resultados\"\u003EAnalizando los resultados\u003C\u002Fh3\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EPor el hecho de utilizar un interfaz u otro, no ganamos rendimiento.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EGanamos rendimiento porque el interfaz \u003Ca href=\"#_externalizable\"\u003EExternalizable\u003C\u002Fa\u003E nos \"obliga\" a implementar parte de la serialización y quitamos esta carga a \u003Ca href=\"https:\u002F\u002Fwww.java.com\" target=\"_blank\" rel=\"noopener\"\u003EJava\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EAunque como hemos visto en \u003Ca href=\"#_utilizando_el_interfaz_externalizable_mal\"\u003EUtilizando el interfaz Externalizable (mal)\u003C\u002Fa\u003E, si no tenemos cuidado, conseguiremos una mejora poco significativa a costa de complicar nuestro código fuente.\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EA continuación os dejo los enlaces a:\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"ulist\"\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Ca href=\"http:\u002F\u002Fcarlosvin.github.io\u002Fserializations-performance-java\u002Fclasses\u002Fcom.github.carlosvin.contacts.SerializationTest.html\"\u003EResultados de los tests\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fcarlosvin\u002Fserializations-performance-java\u002F\"\u003ECódigo en github\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E",slug:aj}]}}("","html","Appendix",".","2020","Performance","auto","drop-line","skip","Caution","Important","Note","Tip","Warning","Example","Figure","Table","Table of Contents","Section","Part","Chapter","Untitled","Version","Last updated",".adoc","2.0.10","secure",20,64,"html5",4096,"article",".html",".\u002Fimages\u002Ficons","2020-04-23","2020-04-19","10:46:31 +0200","2020-04-19 10:46:31 +0200",0,"21:17:06 +0200","2020-04-23 21:17:06 +0200","C++ Struct memory alignment","2012\u002F11\u002F26 12:00:00","C++","Compilers","Memory","en","Understanding pragma pack preprocessor directive and how it affects to memory alignment","cpp-pragma-pack","Alineación de una Estructura C++ en Memoria","Comprendiendo cómo funciona la directiva C++ pragma pack y cómo afecta a la alineación de la memoria","es","21:17:08 +0200","2020-04-23 21:17:08 +0200","Java serialization ways: Performance Comparison","2014\u002F05\u002F13 17:00:00","Java serialization ways, performance comparison","Java","https:\u002F\u002Fwww.java.com[Java,window=_blank]","https:\u002F\u002Fwww.json.org[JSON,window=_blank]","https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FXML[XML,window=_blank]","https:\u002F\u002Fdocs.oracle.com\u002Fjavase\u002F7\u002Fdocs\u002Fapi\u002Fjava\u002Fio\u002FSerializable.html[Serializable,window=_blank]","https:\u002F\u002Fdocs.oracle.com\u002Fjavase\u002F7\u002Fdocs\u002Fapi\u002Fjava\u002Fio\u002FExternalizable.html[Externalizable,window=_blank]","serialization-java-serializable-externalizable","Distintas formas de serialización en Java: Comparación de rendimiento","Comparación de rendimientos entre distintas formas de serialización en Java"))]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');var s=document.createElement("script");try{new Function("if(0)import('')")();s.src="/client/client.67f08357.js";s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@1.0.1.js";s.setAttribute("data-main","/client/client.67f08357.js")}document.head.appendChild(s)</script> <script async defer> (function (i, s, o, g, r, a, m) {
		i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
			(i[r].q = i[r].q || []).push(arguments)
		}, i[r].l = 1 * new Date(); a = s.createElement(o),
			m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
		})(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

		ga('create', 'UA-1328360-10', 'auto');
		ga('send', 'pageview'); </script> 