<!doctype html>
<html lang="es">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../../../../favicon.png" />
		<script
			async
			src="https://cdn.jsdelivr.net/npm/@statsig/js-client@1/build/statsig-js-client+session-replay+web-analytics.min.js?apikey=client-HFdLXhoqeAqLJGsEO0FuGCieE2nSFNxpPp2ziw3ZPYK"
		></script>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="/app.css" />
		
		<link href="../../../../_app/immutable/assets/2.BkyfcBaI.css" rel="stylesheet">
		<link href="../../../../_app/immutable/assets/IconLink.2qtseSjK.css" rel="stylesheet">
		<link href="../../../../_app/immutable/assets/Social.CTdkLZ_f.css" rel="stylesheet">
		<link href="../../../../_app/immutable/assets/8.CqjetrkP.css" rel="stylesheet">
		<link href="../../../../_app/immutable/assets/Details.C_CQQSd4.css" rel="stylesheet">
		<link rel="modulepreload" href="../../../../_app/immutable/entry/start.Dg2WxSzj.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/entry.BXLEF9h2.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/runtime.3FY_vtsg.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/index-client.B1gllz1k.js">
		<link rel="modulepreload" href="../../../../_app/immutable/entry/app.DiecyXnG.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/render.CY392Wed.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/svelte-head.CPyUmzYt.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/disclose-version.B5WKJUOZ.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/3.CAhkvHRE.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/props.DBxtFyAD.js">
		<link rel="modulepreload" href="../../../../_app/immutable/nodes/0.hWIgE5sI.js">
		<link rel="modulepreload" href="../../../../_app/immutable/nodes/2.Xa-J0HUn.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/misc.8zLmL9bg.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/lifecycle.4u1WjEOg.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/IconLink.k-vueeZX.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/Social.D6bLOiwf.js">
		<link rel="modulepreload" href="../../../../_app/immutable/nodes/8.DMK56GIg.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/url.QYYjpySO.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/Details.C57OQ6iz.js"><!--[--><meta property="og:title" content="Contenedores Docker multi-dominio"> <meta name="date.created" content="2016-11-23T20:00:00.000Z"> <meta name="date.updated" content="2016-11-23T20:00:00.000Z"> <meta name="description" content="Cómo crear varios contenedores Docker con diferentes dominios en la misma máquina."> <meta property="og:description" content="Cómo crear varios contenedores Docker con diferentes dominios en la misma máquina."> <meta property="og:type" content="article"> <meta property="og:url" content="http://sveltekit-prerender/langs/es/posts/reverse-proxy-multidomain-docker/"> <meta property="og:locale" content="es"> <meta property="og:locale:alternate" content="en"> <meta property="og:image"> <meta property="og:article:tag" content="Docker,Microservices"> <!--[--><!--[--><link rel="alternate" hreflang="en" href="/langs/en/posts/reverse-proxy-multidomain-docker"><!--]--><!--]--> <!----><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"Webpage","@id":"https://google.com/article"},"headline":"Contenedores Docker multi-dominio","alternativeHeadline":"Cómo crear varios contenedores Docker con diferentes dominios en la misma máquina.","description":"Cómo crear varios contenedores Docker con diferentes dominios en la misma máquina.","datePublished":"2016-11-23T20:00:00.000Z","dateModified":"2016-11-23T20:00:00.000Z","keywords":["Docker","Microservices"],"author":{"@type":"Person","name":"Carlos Martin Sanchez"},"publisher":{"@type":"Person","name":"Carlos Martin Sanchez"}}</script><!----><!--]--><title>Contenedores Docker multi-dominio</title>
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!----><!--[--><!----><nav class="svelte-pyuk6k"><ul class="svelte-pyuk6k"><li class="svelte-2j41u7"><a aria-current="page" href="/langs/es/posts" rel="prefetch" class="svelte-2j41u7"><!----><img class="logo svelte-pyuk6k" src="/favicon.25px.png" alt="Carlos dice bla bla logo"><!----></a></li><!----></ul> <ul class="closed svelte-pyuk6k"><li class="svelte-2j41u7"><a aria-current="page" href="/langs/es/posts" rel="prefetch" class="svelte-2j41u7"><!----><span class="siteName">Carlos dice bla bla</span><!----></a></li><!----> <li class="svelte-2j41u7"><a href="/langs/es/categories" rel="prefetch" class="svelte-2j41u7"><!----><!---->Categorías<!----></a></li><!----> <li class="svelte-2j41u7"><a href="/langs/es/about" rel="prefetch" class="svelte-2j41u7"><!----><!---->Sobre mi<!----></a></li><!----></ul> <!--[--><!----><div class="h svelte-geb0ta"><!----><a href="/langs/es/feed.xml" target="_blank" class="icon rss svelte-blgowr" title="Suscríbete al feed Carlos dice bla bla" rel="noopener" aria-label="Suscríbete al feed Carlos dice bla bla"><!----><!----></a><!----> <a href="https://github.com/carlosvin" target="_blank" class="icon github svelte-blgowr" title="Find me at github" rel="noopener" aria-label="Find me at github"><!----><!----></a><!----> <a href="https://stackoverflow.com/users/1421059/carlosvin" target="_blank" class="icon stackoverflow svelte-blgowr" title="Find me at stackoverflow" rel="noopener" aria-label="Find me at stackoverflow"><!----><!----></a><!----></div><!----><!--]--> <button type="button" class="svelte-pyuk6k">≡</button></nav><!----> <main class="svelte-qhq9sm"><!----><!----><header class="svelte-1ikjkmw"><h1 class="svelte-1ikjkmw">Contenedores Docker multi-dominio <span class="share svelte-1ikjkmw"><!--[!--><a href="https://twitter.com/intent/tweet?url=/langs/es/posts/reverse-proxy-multidomain-docker&amp;text=Contenedores Docker multi-dominio:&amp;nbsp;Cómo crear varios contenedores Docker con diferentes dominios en la misma máquina.&amp;hashtags=Docker,Microservices" target="_blank" class="icon twitter svelte-blgowr" title="Share &quot;Contenedores Docker multi-dominio&quot;" rel="noopener" aria-label="Share &quot;Contenedores Docker multi-dominio&quot;"><!----><!----></a><!--]--><!----></span></h1> <p class="summary svelte-1ikjkmw">Cómo crear varios contenedores Docker con diferentes dominios en la misma máquina.</p> <div class="subtitle svelte-9uod0d"><span class="date">11/23/2016</span> <span class="langs"><!--[--><ul class="otherLangs svelte-1numgf3"><!--[--><!--[--><li class="svelte-1numgf3"><a rel="alternate" hreflang="en" href="/langs/en/posts/reverse-proxy-multidomain-docker" title="Check the post in other language: en">en</a></li><!--]--><!--]--></ul><!--]--><!----></span> <!--[--><span class="tags svelte-wqh6y7"><!--[--><a href="/langs/es/categories/docker" title="Docker" class="svelte-1g7d2s3">Docker</a><a href="/langs/es/categories/microservices" title="Microservices" class="svelte-1g7d2s3">Microservices</a><!--]--></span><!--]--><!----></div><!----></header> <div class="postContent"><!----><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_caso_de_uso">Caso de Uso</a></li>
<li><a href="#_cómo_configurar_un_proxy_inverso_multi_dominio">Cómo configurar un Proxy Inverso Multi-Dominio</a>
<ul class="sectlevel2">
<li><a href="#_estructura_del_proyecto_de_ejemplo">Estructura del proyecto de ejemplo</a></li>
<li><a href="#_configuración_de_la_arquitectura_docker_compose">Configuración de la arquitectura (docker-compose)</a></li>
<li><a href="#_configuración_de_la_imágen_de_la_aplicación">Configuración de la imágen de la aplicación</a></li>
<li><a href="#_añadiendo_los_nombres_de_dominio_a_tu_configuración">Añadiendo los nombres de dominio a tu configuración</a></li>
<li><a href="#_todo_listo">¡Todo listo!</a></li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_caso_de_uso">Caso de Uso</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tenemos varias aplicaciones servidoras a la vez en un mismo entorno de desarrollo, cada una encapsulada en un contenedor, llamémosles de ahora en adelante <strong>"Contenedor A"</strong> y <strong>"Contenedor B"</strong>.</p>
</div>
<div class="paragraph">
<p>Utilizando docker estas aplicaciones tienen la misma dirección IP en nuestra máquina, una forma de distinguirlas es cambiando el puerto que exponen.</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="/posts/reverse-proxy-multidomain-docker/ip.png" alt="ip">
</div>
</div>
<div class="paragraph">
<p>Aplicaciones exponiendo la misma dirección IP utilizando diferentes puertos para diferenciar las aplicaciones.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Si queremos llamar a la <strong>"aplicación A"</strong> haremos algo así: <code>GET <a href="http://10.20.30.40:8080/colors/red" class="bare">http://10.20.30.40:8080/colors/red</a></code>.</p>
</li>
<li>
<p>Si queremos llamar a la <strong>"aplicación B"</strong> haremos algo así: <code>GET <a href="http://10.20.30.40:8081/fruits/tomato" class="bare">http://10.20.30.40:8081/fruits/tomato</a></code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pero esto es un poco confuso, ¿8080 sigfica que accedemos a las "aplicación A" y 8081 significa "aplicación B"?</p>
</div>
<div class="paragraph">
<p>Sería mucho más sencillo de recordar algo así:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Si queremos llamar a la "aplicación A" haremos algo así: <code>GET <a href="http://a.domain.com/colors/red" class="bare">http://a.domain.com/colors/red</a></code>.</p>
</li>
<li>
<p>Si queremos llamar a la "aplicación B" haremos algo así: <code>GET <a href="http://b.domain.com/fruits/tomato" class="bare">http://b.domain.com/fruits/tomato</a></code>.</p>
</li>
</ul>
</div>
<div class="imageblock center">
<div class="content">
<img src="/posts/reverse-proxy-multidomain-docker/domain.png" alt="domain">
</div>
</div>
<div class="paragraph">
<p>Diferenciando aplicaciones por nombre de dominio</p>
</div>
<div class="paragraph">
<p>Obtener este valor semántico extra es más sencillo de lo que parece.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cómo_configurar_un_proxy_inverso_multi_dominio">Cómo configurar un Proxy Inverso Multi-Dominio</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dije que era fácil porque no vamos a tener que hacer casi nada, ya que otro contenedor hará casi todo el trabajo por nosotros. Vamos a utilizar <a href="https://github.com/jwilder/nginx-proxy" target="_blank" rel="noopener">nginx-proxy</a>, que generará automáticamente las configuraciones necesarias para <a href="https://www.nginx.com" target="_blank" rel="noopener">NGINX</a>.</p>
</div>
<div class="paragraph">
<p>Así que al final no tendremos 2 contenedores, sino también tendremos un tercero que hará las veces de proxy.</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="/posts/reverse-proxy-multidomain-docker/proxy.png" alt="domain">
</div>
</div>
<div class="paragraph">
<p>Los 2 contenedores y el proxy.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Puedes descargar el ejemplo completo desde: <a href="https://github.com/carlosvin/docker-reverse-proxy-multi-domain" class="bare">https://github.com/carlosvin/docker-reverse-proxy-multi-domain</a>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_estructura_del_proyecto_de_ejemplo">Estructura del proyecto de ejemplo</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">docker-compose.yaml</dt>
<dd>
<p>Archivo con la configuración descrita en la imágen previa.</p>
</dd>
<dt class="hdlist1">a</dt>
<dd>
<p>Directorio para la aplicación A.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Dockerfile</dt>
<dd>
<p>Archivo con la configuración del contenedor A.</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1">b</dt>
<dd>
<p>Directorio para la aplicación B.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Dockerfile</dt>
<dd>
<p>Archivo con la configuración del contenedor B.</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><a href="https://github.com/carlosvin/docker-reverse-proxy-multi-domain" target="_blank" rel="noopener">Ver proyecto</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuración_de_la_arquitectura_docker_compose">Configuración de la arquitectura (docker-compose)</h3>
<div class="paragraph">
<p>La parte más importante es la configuración de las relaciones entre los contenedores.</p>
</div>
<div class="listingblock">
<div class="title">docker-reverse-proxy-multi-domain/docker-compose.yaml</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"><span class="hljs-attr">a:</span>
  <span class="hljs-attr">build:</span> <span class="hljs-string">a</span> <b class="conum">(4)</b>
  <span class="hljs-attr">environment:</span>
    <span class="hljs-attr">VIRTUAL_HOST:</span> <span class="hljs-string">a.domain.com</span> <b class="conum">(1)</b>
  <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>

<span class="hljs-attr">b:</span>
  <span class="hljs-attr">build:</span> <span class="hljs-string">b</span> <b class="conum">(5)</b>
  <span class="hljs-attr">environment:</span>
    <span class="hljs-attr">VIRTUAL_HOST:</span>  <span class="hljs-string">b.domain.com</span> <b class="conum">(2)</b>
  <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>

<span class="hljs-attr">nginx-proxy:</span> <b class="conum">(3)</b>
  <span class="hljs-attr">image:</span> <span class="hljs-string">jwilder/nginx-proxy</span>
  <span class="hljs-attr">ports:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;80:80&quot;</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;443:443&quot;</span>
  <span class="hljs-attr">volumes:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">/var/run/docker.sock:/tmp/docker.sock:ro</span>

  <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
  <span class="hljs-attr">privileged:</span> <span class="hljs-literal">true</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Configuramos el nombre de dominio que queremos utilizar para la aplicación a.</p>
</li>
<li>
<p>Lo mismo para la aplicación b.</p>
</li>
<li>
<p>A partir de aquí configuramos el proxy (esta es la parte de copiar y pegar).</p>
</li>
<li>
<p>Indicamos a docker-compose que tiene que construir las imágenes dentro del directorio indicado.</p>
</li>
<li>
<p>Por ejemplo, aquí, estamos indicando que docker-compose tiene que construir la imágen docker utilizando ./b/Dockerfile.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_configuración_de_la_imágen_de_la_aplicación">Configuración de la imágen de la aplicación</h3>
<div class="paragraph">
<p>A continuación vamos a comentar la configuración de la imágen del contenedor para la aplicación A.</p>
</div>
<div class="listingblock">
<div class="title">a/Dockerfile</div>
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker"><span class="hljs-keyword">FROM</span> httpd:<span class="hljs-number">2.4</span> <b class="conum">(1)</b>
<span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;A&lt;/h1&gt;App A works!&lt;/body&gt;&lt;/html&gt;&quot;</span> &gt; /usr/local/apache2/htdocs/index.html </span><b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Importamos una imágen con un servidor apache.</p>
</li>
<li>
<p>Servimos un archivo que muestra "Host A" como página por defecto.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>La configuración para la aplicación B, es prácticamente la misma:</p>
</div>
<div class="listingblock">
<div class="title">b/Dockerfile</div>
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker"><span class="hljs-keyword">FROM</span> httpd:<span class="hljs-number">2.4</span>
<span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;B&lt;/h1&gt;App B works!&lt;/body&gt;&lt;/html&gt;&quot;</span> &gt; /usr/local/apache2/htdocs/index.html</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_añadiendo_los_nombres_de_dominio_a_tu_configuración">Añadiendo los nombres de dominio a tu configuración</h3>
<div class="paragraph">
<p>En Linux simplemente tenemos mapear la dirección local a los nombres de dominio que hayas elegido, en nuestro ejemplo es <code>a.domain.com</code> y <code>b.domain.com</code>.</p>
</div>
<div class="listingblock">
<div class="title">/etc/hosts</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">127.0.0.1     localhost.localdomain localhost
::1             localhost6.localdomain6 localhost6
127.0.0.1   a.domain.com <b class="conum">(1)</b>
127.0.0.1   b.domain.com</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Simplemente he añadido las líneas 4 y 5.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_todo_listo">¡Todo listo!</h3>
<div class="paragraph">
<p>Ya solo nos queda probar el ejemplo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker-compose build
docker-compose up</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ya están las tres contenedores arrancados.</p>
</div>
<div class="paragraph">
<p>Ahora podemos abrir nuestro navegador y escribir a.domain.com y nos mostrará el texto <em>App A works!</em>. Si escribimos b.domain.com entonces veremos <em>App B works!</em>.</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="/posts/reverse-proxy-multidomain-docker/a.screenshot.png" alt="App A works!">
</div>
<div class="title">Figure 1. a.domain.com</div>
</div>
<div class="imageblock center">
<div class="content">
<img src="/posts/reverse-proxy-multidomain-docker/b.screenshot.png" alt="App B works!">
</div>
<div class="title">Figure 2. b.domain.com</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
En la mayoría de distribuciones Linux necesitarás privilegios para ejecutar los comandos docker (<code>sudo</code>).
</td>
</tr>
</table>
</div>
</div>
</div>
</div><!----> <div class="comments"><script src="https://utteranc.es/client.js" repo="carlosvin/carlosvin.github.io" issue-term="title" label="comment" theme="github-light" crossorigin="anonymous" async>
	</script></div><!----></div><!----><!----><!----></main> <footer class="svelte-qhq9sm"><span>Carlos dice bla bla</span> <code>1.0.1</code></footer><!----><!--]--><!----><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_1qhkr5p = {
						base: new URL("../../../..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../../../../_app/immutable/entry/start.Dg2WxSzj.js"),
						import("../../../../_app/immutable/entry/app.DiecyXnG.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 8],
							data: [null,{"type":"data","data":{path:"/langs/es/posts/reverse-proxy-multidomain-docker/",lang:"es",translations:{lang:"es",author:"Carlos Martin Sanchez",siteName:"Carlos dice bla bla",siteDescription:"Qué está pasando por mi cabeza y alrededores",categories:"categorías",Categories:"Categorías",RecentPosts:"Últimas entradas",NoPosts:"No hay entradas",SubscribeTo:"Suscríbete al feed",AboutMe:"Sobre mi",AllPosts:"Todas las entradas"},version:"1.0.1"},"uses":{"params":["lang"],"url":1},"slash":"always"},{"type":"data","data":{html:"\u003Cdiv id=\"toc\" class=\"toc\">\n\u003Cdiv id=\"toctitle\">Table of Contents\u003C/div>\n\u003Cul class=\"sectlevel1\">\n\u003Cli>\u003Ca href=\"#_caso_de_uso\">Caso de Uso\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#_cómo_configurar_un_proxy_inverso_multi_dominio\">Cómo configurar un Proxy Inverso Multi-Dominio\u003C/a>\n\u003Cul class=\"sectlevel2\">\n\u003Cli>\u003Ca href=\"#_estructura_del_proyecto_de_ejemplo\">Estructura del proyecto de ejemplo\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#_configuración_de_la_arquitectura_docker_compose\">Configuración de la arquitectura (docker-compose)\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#_configuración_de_la_imágen_de_la_aplicación\">Configuración de la imágen de la aplicación\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#_añadiendo_los_nombres_de_dominio_a_tu_configuración\">Añadiendo los nombres de dominio a tu configuración\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#_todo_listo\">¡Todo listo!\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003C/ul>\n\u003C/div>\n\u003Cdiv class=\"sect1\">\n\u003Ch2 id=\"_caso_de_uso\">Caso de Uso\u003C/h2>\n\u003Cdiv class=\"sectionbody\">\n\u003Cdiv class=\"paragraph\">\n\u003Cp>Tenemos varias aplicaciones servidoras a la vez en un mismo entorno de desarrollo, cada una encapsulada en un contenedor, llamémosles de ahora en adelante \u003Cstrong>\"Contenedor A\"\u003C/strong> y \u003Cstrong>\"Contenedor B\"\u003C/strong>.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>Utilizando docker estas aplicaciones tienen la misma dirección IP en nuestra máquina, una forma de distinguirlas es cambiando el puerto que exponen.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"imageblock center\">\n\u003Cdiv class=\"content\">\n\u003Cimg src=\"/posts/reverse-proxy-multidomain-docker/ip.png\" alt=\"ip\">\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>Aplicaciones exponiendo la misma dirección IP utilizando diferentes puertos para diferenciar las aplicaciones.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"ulist\">\n\u003Cul>\n\u003Cli>\n\u003Cp>Si queremos llamar a la \u003Cstrong>\"aplicación A\"\u003C/strong> haremos algo así: \u003Ccode>GET \u003Ca href=\"http://10.20.30.40:8080/colors/red\" class=\"bare\">http://10.20.30.40:8080/colors/red\u003C/a>\u003C/code>.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>Si queremos llamar a la \u003Cstrong>\"aplicación B\"\u003C/strong> haremos algo así: \u003Ccode>GET \u003Ca href=\"http://10.20.30.40:8081/fruits/tomato\" class=\"bare\">http://10.20.30.40:8081/fruits/tomato\u003C/a>\u003C/code>.\u003C/p>\n\u003C/li>\n\u003C/ul>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>Pero esto es un poco confuso, ¿8080 sigfica que accedemos a las \"aplicación A\" y 8081 significa \"aplicación B\"?\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>Sería mucho más sencillo de recordar algo así:\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"ulist\">\n\u003Cul>\n\u003Cli>\n\u003Cp>Si queremos llamar a la \"aplicación A\" haremos algo así: \u003Ccode>GET \u003Ca href=\"http://a.domain.com/colors/red\" class=\"bare\">http://a.domain.com/colors/red\u003C/a>\u003C/code>.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>Si queremos llamar a la \"aplicación B\" haremos algo así: \u003Ccode>GET \u003Ca href=\"http://b.domain.com/fruits/tomato\" class=\"bare\">http://b.domain.com/fruits/tomato\u003C/a>\u003C/code>.\u003C/p>\n\u003C/li>\n\u003C/ul>\n\u003C/div>\n\u003Cdiv class=\"imageblock center\">\n\u003Cdiv class=\"content\">\n\u003Cimg src=\"/posts/reverse-proxy-multidomain-docker/domain.png\" alt=\"domain\">\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>Diferenciando aplicaciones por nombre de dominio\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>Obtener este valor semántico extra es más sencillo de lo que parece.\u003C/p>\n\u003C/div>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"sect1\">\n\u003Ch2 id=\"_cómo_configurar_un_proxy_inverso_multi_dominio\">Cómo configurar un Proxy Inverso Multi-Dominio\u003C/h2>\n\u003Cdiv class=\"sectionbody\">\n\u003Cdiv class=\"paragraph\">\n\u003Cp>Dije que era fácil porque no vamos a tener que hacer casi nada, ya que otro contenedor hará casi todo el trabajo por nosotros. Vamos a utilizar \u003Ca href=\"https://github.com/jwilder/nginx-proxy\" target=\"_blank\" rel=\"noopener\">nginx-proxy\u003C/a>, que generará automáticamente las configuraciones necesarias para \u003Ca href=\"https://www.nginx.com\" target=\"_blank\" rel=\"noopener\">NGINX\u003C/a>.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>Así que al final no tendremos 2 contenedores, sino también tendremos un tercero que hará las veces de proxy.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"imageblock center\">\n\u003Cdiv class=\"content\">\n\u003Cimg src=\"/posts/reverse-proxy-multidomain-docker/proxy.png\" alt=\"domain\">\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>Los 2 contenedores y el proxy.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"admonitionblock note\">\n\u003Ctable>\n\u003Ctr>\n\u003Ctd class=\"icon\">\n\u003Cdiv class=\"title\">Note\u003C/div>\n\u003C/td>\n\u003Ctd class=\"content\">\nPuedes descargar el ejemplo completo desde: \u003Ca href=\"https://github.com/carlosvin/docker-reverse-proxy-multi-domain\" class=\"bare\">https://github.com/carlosvin/docker-reverse-proxy-multi-domain\u003C/a>.\n\u003C/td>\n\u003C/tr>\n\u003C/table>\n\u003C/div>\n\u003Cdiv class=\"sect2\">\n\u003Ch3 id=\"_estructura_del_proyecto_de_ejemplo\">Estructura del proyecto de ejemplo\u003C/h3>\n\u003Cdiv class=\"dlist\">\n\u003Cdl>\n\u003Cdt class=\"hdlist1\">docker-compose.yaml\u003C/dt>\n\u003Cdd>\n\u003Cp>Archivo con la configuración descrita en la imágen previa.\u003C/p>\n\u003C/dd>\n\u003Cdt class=\"hdlist1\">a\u003C/dt>\n\u003Cdd>\n\u003Cp>Directorio para la aplicación A.\u003C/p>\n\u003Cdiv class=\"dlist\">\n\u003Cdl>\n\u003Cdt class=\"hdlist1\">Dockerfile\u003C/dt>\n\u003Cdd>\n\u003Cp>Archivo con la configuración del contenedor A.\u003C/p>\n\u003C/dd>\n\u003C/dl>\n\u003C/div>\n\u003C/dd>\n\u003Cdt class=\"hdlist1\">b\u003C/dt>\n\u003Cdd>\n\u003Cp>Directorio para la aplicación B.\u003C/p>\n\u003Cdiv class=\"dlist\">\n\u003Cdl>\n\u003Cdt class=\"hdlist1\">Dockerfile\u003C/dt>\n\u003Cdd>\n\u003Cp>Archivo con la configuración del contenedor B.\u003C/p>\n\u003C/dd>\n\u003C/dl>\n\u003C/div>\n\u003C/dd>\n\u003C/dl>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>\u003Ca href=\"https://github.com/carlosvin/docker-reverse-proxy-multi-domain\" target=\"_blank\" rel=\"noopener\">Ver proyecto\u003C/a>.\u003C/p>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"sect2\">\n\u003Ch3 id=\"_configuración_de_la_arquitectura_docker_compose\">Configuración de la arquitectura (docker-compose)\u003C/h3>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>La parte más importante es la configuración de las relaciones entre los contenedores.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"title\">docker-reverse-proxy-multi-domain/docker-compose.yaml\u003C/div>\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-yaml\" data-lang=\"yaml\">\u003Cspan class=\"hljs-attr\">a:\u003C/span>\n  \u003Cspan class=\"hljs-attr\">build:\u003C/span> \u003Cspan class=\"hljs-string\">a\u003C/span> \u003Cb class=\"conum\">(4)\u003C/b>\n  \u003Cspan class=\"hljs-attr\">environment:\u003C/span>\n    \u003Cspan class=\"hljs-attr\">VIRTUAL_HOST:\u003C/span> \u003Cspan class=\"hljs-string\">a.domain.com\u003C/span> \u003Cb class=\"conum\">(1)\u003C/b>\n  \u003Cspan class=\"hljs-attr\">restart:\u003C/span> \u003Cspan class=\"hljs-string\">always\u003C/span>\n\n\u003Cspan class=\"hljs-attr\">b:\u003C/span>\n  \u003Cspan class=\"hljs-attr\">build:\u003C/span> \u003Cspan class=\"hljs-string\">b\u003C/span> \u003Cb class=\"conum\">(5)\u003C/b>\n  \u003Cspan class=\"hljs-attr\">environment:\u003C/span>\n    \u003Cspan class=\"hljs-attr\">VIRTUAL_HOST:\u003C/span>  \u003Cspan class=\"hljs-string\">b.domain.com\u003C/span> \u003Cb class=\"conum\">(2)\u003C/b>\n  \u003Cspan class=\"hljs-attr\">restart:\u003C/span> \u003Cspan class=\"hljs-string\">always\u003C/span>\n\n\u003Cspan class=\"hljs-attr\">nginx-proxy:\u003C/span> \u003Cb class=\"conum\">(3)\u003C/b>\n  \u003Cspan class=\"hljs-attr\">image:\u003C/span> \u003Cspan class=\"hljs-string\">jwilder/nginx-proxy\u003C/span>\n  \u003Cspan class=\"hljs-attr\">ports:\u003C/span>\n    \u003Cspan class=\"hljs-bullet\">-\u003C/span> \u003Cspan class=\"hljs-string\">&quot;80:80&quot;\u003C/span>\n    \u003Cspan class=\"hljs-bullet\">-\u003C/span> \u003Cspan class=\"hljs-string\">&quot;443:443&quot;\u003C/span>\n  \u003Cspan class=\"hljs-attr\">volumes:\u003C/span>\n    \u003Cspan class=\"hljs-bullet\">-\u003C/span> \u003Cspan class=\"hljs-string\">/var/run/docker.sock:/tmp/docker.sock:ro\u003C/span>\n\n  \u003Cspan class=\"hljs-attr\">restart:\u003C/span> \u003Cspan class=\"hljs-string\">always\u003C/span>\n  \u003Cspan class=\"hljs-attr\">privileged:\u003C/span> \u003Cspan class=\"hljs-literal\">true\u003C/span>\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"colist arabic\">\n\u003Col>\n\u003Cli>\n\u003Cp>Configuramos el nombre de dominio que queremos utilizar para la aplicación a.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>Lo mismo para la aplicación b.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>A partir de aquí configuramos el proxy (esta es la parte de copiar y pegar).\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>Indicamos a docker-compose que tiene que construir las imágenes dentro del directorio indicado.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>Por ejemplo, aquí, estamos indicando que docker-compose tiene que construir la imágen docker utilizando ./b/Dockerfile.\u003C/p>\n\u003C/li>\n\u003C/ol>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"sect2\">\n\u003Ch3 id=\"_configuración_de_la_imágen_de_la_aplicación\">Configuración de la imágen de la aplicación\u003C/h3>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>A continuación vamos a comentar la configuración de la imágen del contenedor para la aplicación A.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"title\">a/Dockerfile\u003C/div>\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-docker\" data-lang=\"docker\">\u003Cspan class=\"hljs-keyword\">FROM\u003C/span> httpd:\u003Cspan class=\"hljs-number\">2.4\u003C/span> \u003Cb class=\"conum\">(1)\u003C/b>\n\u003Cspan class=\"hljs-keyword\">RUN\u003C/span>\u003Cspan class=\"language-bash\"> \u003Cspan class=\"hljs-built_in\">echo\u003C/span> \u003Cspan class=\"hljs-string\">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;A&lt;/h1&gt;App A works!&lt;/body&gt;&lt;/html&gt;&quot;\u003C/span> &gt; /usr/local/apache2/htdocs/index.html \u003C/span>\u003Cb class=\"conum\">(2)\u003C/b>\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"colist arabic\">\n\u003Col>\n\u003Cli>\n\u003Cp>Importamos una imágen con un servidor apache.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>Servimos un archivo que muestra \"Host A\" como página por defecto.\u003C/p>\n\u003C/li>\n\u003C/ol>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>La configuración para la aplicación B, es prácticamente la misma:\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"title\">b/Dockerfile\u003C/div>\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-docker\" data-lang=\"docker\">\u003Cspan class=\"hljs-keyword\">FROM\u003C/span> httpd:\u003Cspan class=\"hljs-number\">2.4\u003C/span>\n\u003Cspan class=\"hljs-keyword\">RUN\u003C/span>\u003Cspan class=\"language-bash\"> \u003Cspan class=\"hljs-built_in\">echo\u003C/span> \u003Cspan class=\"hljs-string\">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;B&lt;/h1&gt;App B works!&lt;/body&gt;&lt;/html&gt;&quot;\u003C/span> &gt; /usr/local/apache2/htdocs/index.html\u003C/span>\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"sect2\">\n\u003Ch3 id=\"_añadiendo_los_nombres_de_dominio_a_tu_configuración\">Añadiendo los nombres de dominio a tu configuración\u003C/h3>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>En Linux simplemente tenemos mapear la dirección local a los nombres de dominio que hayas elegido, en nuestro ejemplo es \u003Ccode>a.domain.com\u003C/code> y \u003Ccode>b.domain.com\u003C/code>.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"title\">/etc/hosts\u003C/div>\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-bash\" data-lang=\"bash\">127.0.0.1     localhost.localdomain localhost\n::1             localhost6.localdomain6 localhost6\n127.0.0.1   a.domain.com \u003Cb class=\"conum\">(1)\u003C/b>\n127.0.0.1   b.domain.com\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"colist arabic\">\n\u003Col>\n\u003Cli>\n\u003Cp>Simplemente he añadido las líneas 4 y 5.\u003C/p>\n\u003C/li>\n\u003C/ol>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"sect2\">\n\u003Ch3 id=\"_todo_listo\">¡Todo listo!\u003C/h3>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>Ya solo nos queda probar el ejemplo.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-bash\" data-lang=\"bash\">docker-compose build\ndocker-compose up\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>Ya están las tres contenedores arrancados.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>Ahora podemos abrir nuestro navegador y escribir a.domain.com y nos mostrará el texto \u003Cem>App A works!\u003C/em>. Si escribimos b.domain.com entonces veremos \u003Cem>App B works!\u003C/em>.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"imageblock center\">\n\u003Cdiv class=\"content\">\n\u003Cimg src=\"/posts/reverse-proxy-multidomain-docker/a.screenshot.png\" alt=\"App A works!\">\n\u003C/div>\n\u003Cdiv class=\"title\">Figure 1. a.domain.com\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"imageblock center\">\n\u003Cdiv class=\"content\">\n\u003Cimg src=\"/posts/reverse-proxy-multidomain-docker/b.screenshot.png\" alt=\"App B works!\">\n\u003C/div>\n\u003Cdiv class=\"title\">Figure 2. b.domain.com\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"admonitionblock note\">\n\u003Ctable>\n\u003Ctr>\n\u003Ctd class=\"icon\">\n\u003Cdiv class=\"title\">Note\u003C/div>\n\u003C/td>\n\u003Ctd class=\"content\">\nEn la mayoría de distribuciones Linux necesitarás privilegios para ejecutar los comandos docker (\u003Ccode>sudo\u003C/code>).\n\u003C/td>\n\u003C/tr>\n\u003C/table>\n\u003C/div>\n\u003C/div>\n\u003C/div>\n\u003C/div>",props:{title:"Contenedores Docker multi-dominio",lang:"es",summary:"Cómo crear varios contenedores Docker con diferentes dominios en la misma máquina.",slug:"reverse-proxy-multidomain-docker",keywords:["Docker","Microservices"],filepath:"/static/posts/reverse-proxy-multidomain-docker/reverse-proxy-multidomain-docker.es.adoc",dirpath:"/static/posts/reverse-proxy-multidomain-docker",created:1479931200000,modified:1479931200000,otherLangs:["en"],author:"Carlos Martin Sanchez",previewimage:void 0,path:"/langs/es/posts/reverse-proxy-multidomain-docker"},jsonLd:"\u003Cscript type=\"application/ld+json\">{\"@context\":\"https://schema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"Webpage\",\"@id\":\"https://google.com/article\"},\"headline\":\"Contenedores Docker multi-dominio\",\"alternativeHeadline\":\"Cómo crear varios contenedores Docker con diferentes dominios en la misma máquina.\",\"description\":\"Cómo crear varios contenedores Docker con diferentes dominios en la misma máquina.\",\"datePublished\":\"2016-11-23T20:00:00.000Z\",\"dateModified\":\"2016-11-23T20:00:00.000Z\",\"keywords\":[\"Docker\",\"Microservices\"],\"author\":{\"@type\":\"Person\",\"name\":\"Carlos Martin Sanchez\"},\"publisher\":{\"@type\":\"Person\",\"name\":\"Carlos Martin Sanchez\"}}\u003C/script>"},"uses":{"params":["slug","lang"]}}],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
