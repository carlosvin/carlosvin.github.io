<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../../../../favicon.png" />
		<script
			async
			src="https://cdn.jsdelivr.net/npm/@statsig/js-client@1/build/statsig-js-client+session-replay+web-analytics.min.js?apikey=client-HFdLXhoqeAqLJGsEO0FuGCieE2nSFNxpPp2ziw3ZPYK"
		></script>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="/app.css" />
		
		<link href="../../../../_app/immutable/assets/2.BkyfcBaI.css" rel="stylesheet">
		<link href="../../../../_app/immutable/assets/IconLink.2qtseSjK.css" rel="stylesheet">
		<link href="../../../../_app/immutable/assets/Social.CTdkLZ_f.css" rel="stylesheet">
		<link href="../../../../_app/immutable/assets/8.CqjetrkP.css" rel="stylesheet">
		<link href="../../../../_app/immutable/assets/Details.C_CQQSd4.css" rel="stylesheet">
		<link rel="modulepreload" href="../../../../_app/immutable/entry/start.Dg2WxSzj.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/entry.BXLEF9h2.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/runtime.3FY_vtsg.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/index-client.B1gllz1k.js">
		<link rel="modulepreload" href="../../../../_app/immutable/entry/app.DiecyXnG.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/render.CY392Wed.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/svelte-head.CPyUmzYt.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/disclose-version.B5WKJUOZ.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/3.CAhkvHRE.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/props.DBxtFyAD.js">
		<link rel="modulepreload" href="../../../../_app/immutable/nodes/0.hWIgE5sI.js">
		<link rel="modulepreload" href="../../../../_app/immutable/nodes/2.Xa-J0HUn.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/misc.8zLmL9bg.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/lifecycle.4u1WjEOg.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/IconLink.k-vueeZX.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/Social.D6bLOiwf.js">
		<link rel="modulepreload" href="../../../../_app/immutable/nodes/8.DMK56GIg.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/url.QYYjpySO.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/Details.C57OQ6iz.js"><!--[--><meta property="og:title" content="Multi-Domain Docker Containers"> <meta name="date.created" content="2016-11-24T20:00:00.000Z"> <meta name="date.updated" content="2016-11-24T20:00:00.000Z"> <meta name="description" content="How to create different Docker containers with different domain names in the same host"> <meta property="og:description" content="How to create different Docker containers with different domain names in the same host"> <meta property="og:type" content="article"> <meta property="og:url" content="http://sveltekit-prerender/langs/en/posts/reverse-proxy-multidomain-docker/"> <meta property="og:locale" content="en"> <meta property="og:locale:alternate" content="es"> <meta property="og:image"> <meta property="og:article:tag" content="Docker,Microservices"> <!--[--><!--[--><link rel="alternate" hreflang="es" href="/langs/es/posts/reverse-proxy-multidomain-docker"><!--]--><!--]--> <!----><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"Webpage","@id":"https://google.com/article"},"headline":"Multi-Domain Docker Containers","alternativeHeadline":"How to create different Docker containers with different domain names in the same host","description":"How to create different Docker containers with different domain names in the same host","datePublished":"2016-11-24T20:00:00.000Z","dateModified":"2016-11-24T20:00:00.000Z","keywords":["Docker","Microservices"],"author":{"@type":"Person","name":"Carlos Martin Sanchez"},"publisher":{"@type":"Person","name":"Carlos Martin Sanchez"}}</script><!----><!--]--><title>Multi-Domain Docker Containers</title>
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!----><!--[--><!----><nav class="svelte-pyuk6k"><ul class="svelte-pyuk6k"><li class="svelte-2j41u7"><a aria-current="page" href="/langs/en/posts" rel="prefetch" class="svelte-2j41u7"><!----><img class="logo svelte-pyuk6k" src="/favicon.25px.png" alt="Carlos Say's Bla Bla logo"><!----></a></li><!----></ul> <ul class="closed svelte-pyuk6k"><li class="svelte-2j41u7"><a aria-current="page" href="/langs/en/posts" rel="prefetch" class="svelte-2j41u7"><!----><span class="siteName">Carlos Say's Bla Bla</span><!----></a></li><!----> <li class="svelte-2j41u7"><a href="/langs/en/categories" rel="prefetch" class="svelte-2j41u7"><!----><!---->Categories<!----></a></li><!----> <li class="svelte-2j41u7"><a href="/langs/en/about" rel="prefetch" class="svelte-2j41u7"><!----><!---->About me<!----></a></li><!----></ul> <!--[--><!----><div class="h svelte-geb0ta"><!----><a href="/langs/en/feed.xml" target="_blank" class="icon rss svelte-blgowr" title="Subscribe to the feed Carlos Say's Bla Bla" rel="noopener" aria-label="Subscribe to the feed Carlos Say's Bla Bla"><!----><!----></a><!----> <a href="https://github.com/carlosvin" target="_blank" class="icon github svelte-blgowr" title="Find me at github" rel="noopener" aria-label="Find me at github"><!----><!----></a><!----> <a href="https://stackoverflow.com/users/1421059/carlosvin" target="_blank" class="icon stackoverflow svelte-blgowr" title="Find me at stackoverflow" rel="noopener" aria-label="Find me at stackoverflow"><!----><!----></a><!----></div><!----><!--]--> <button type="button" class="svelte-pyuk6k">â‰¡</button></nav><!----> <main class="svelte-qhq9sm"><!----><!----><header class="svelte-1ikjkmw"><h1 class="svelte-1ikjkmw">Multi-Domain Docker Containers <span class="share svelte-1ikjkmw"><!--[!--><a href="https://twitter.com/intent/tweet?url=/langs/en/posts/reverse-proxy-multidomain-docker&amp;text=Multi-Domain Docker Containers:&amp;nbsp;How to create different Docker containers with different domain names in the same host&amp;hashtags=Docker,Microservices" target="_blank" class="icon twitter svelte-blgowr" title="Share &quot;Multi-Domain Docker Containers&quot;" rel="noopener" aria-label="Share &quot;Multi-Domain Docker Containers&quot;"><!----><!----></a><!--]--><!----></span></h1> <p class="summary svelte-1ikjkmw">How to create different Docker containers with different domain names in the same host</p> <div class="subtitle svelte-9uod0d"><span class="date">11/24/2016</span> <span class="langs"><!--[--><ul class="otherLangs svelte-1numgf3"><!--[--><!--[--><li class="svelte-1numgf3"><a rel="alternate" hreflang="es" href="/langs/es/posts/reverse-proxy-multidomain-docker" title="Check the post in other language: es">es</a></li><!--]--><!--]--></ul><!--]--><!----></span> <!--[--><span class="tags svelte-wqh6y7"><!--[--><a href="/langs/en/categories/docker" title="Docker" class="svelte-1g7d2s3">Docker</a><a href="/langs/en/categories/microservices" title="Microservices" class="svelte-1g7d2s3">Microservices</a><!--]--></span><!--]--><!----></div><!----></header> <div class="postContent"><!----><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_use_case">Use case</a></li>
<li><a href="#_how_to_configure_multi_domain_reverse_proxy">How to Configure Multi-Domain Reverse Proxy</a>
<ul class="sectlevel2">
<li><a href="#_example_project_structure">Example Project Structure</a></li>
<li><a href="#_architecture_configuration_docker_compose">Architecture Configuration (docker-compose)</a></li>
<li><a href="#_application_image_configuration">Application Image Configuration</a></li>
<li><a href="#_adding_domain_names_to_your_development_environment_configuration">Adding domain names to your development environment configuration</a></li>
<li><a href="#_everything_ready">Everything ready!</a></li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_use_case">Use case</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have several server applications in the same development environment, each application is bundled in a Docker container, e.g: <strong>"Container A"</strong> and <strong>"Container B"</strong>.</p>
</div>
<div class="paragraph">
<p>With Docker those applications have the same IP address. One way to differentiate and access to an specific application is exposing different ports.</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="/posts/reverse-proxy-multidomain-docker/ip.png" alt="ip">
</div>
</div>
<div class="paragraph">
<p>Containers exposing the same IP address and different ports.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If we want to call to <strong>"Application A"</strong> we will do: <code>GET <a href="http://10.20.30.40:8080/colors/red" class="bare">http://10.20.30.40:8080/colors/red</a></code>.</p>
</li>
<li>
<p>If we want to call to <strong>"Application B"</strong> we will do: <code>GET <a href="http://10.20.30.40:8081/fruits/tomato" class="bare">http://10.20.30.40:8081/fruits/tomato</a></code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>But that solution is a little bit confusing, does 8080 mean we are accessing to "application A"?</p>
</div>
<div class="paragraph">
<p>It would be <strong>simpler and easier</strong> to remind something like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Calling <strong>"Application A"</strong>: <code>GET <a href="http://a.domain.com/colors/red" class="bare">http://a.domain.com/colors/red</a></code>.</p>
</li>
<li>
<p>Calling <strong>"Application B"</strong>: <code>GET <a href="http://b.domain.com/fruits/tomato" class="bare">http://b.domain.com/fruits/tomato</a></code>.</p>
</li>
</ul>
</div>
<div class="imageblock center">
<div class="content">
<img src="/posts/reverse-proxy-multidomain-docker/domain.png" alt="domain">
</div>
</div>
<div class="paragraph">
<p>Accessing applications by domain name.</p>
</div>
<div class="paragraph">
<p>Get that extra semantic value is much simpler than I thought at the beginning and you will see below.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_configure_multi_domain_reverse_proxy">How to Configure Multi-Domain Reverse Proxy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I said it is easy, because we almost have to do nothing, another container will do it for us, especifically we are going to use <a href="https://github.com/jwilder/nginx-proxy" target="_blank" rel="noopener">nginx-proxy</a>, it will automatically generate the required <a href="https://www.nginx.com" target="_blank" rel="noopener">NGINX</a> configurations.</p>
</div>
<div class="paragraph">
<p>So, we will have 2 applications + 1 proxy, that is 3 containers.</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="/posts/reverse-proxy-multidomain-docker/proxy.png" alt="domain">
</div>
</div>
<div class="paragraph">
<p>3 containers, 2 applications and 1 proxy</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can download the full example at <a href="https://github.com/carlosvin/docker-reverse-proxy-multi-domain" class="bare">https://github.com/carlosvin/docker-reverse-proxy-multi-domain</a>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_example_project_structure">Example Project Structure</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">docker-compose.yaml</dt>
<dd>
<p>Main configuration file describing architecture in previous picture.</p>
</dd>
<dt class="hdlist1">a</dt>
<dd>
<p>Application A directory.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Dockerfile</dt>
<dd>
<p>Container A configuration file.</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1">b</dt>
<dd>
<p>Application B directory.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Dockerfile</dt>
<dd>
<p>Container B configuration file.</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><a href="https://github.com/carlosvin/docker-reverse-proxy-multi-domain" target="_blank" rel="noopener">View Project</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_architecture_configuration_docker_compose">Architecture Configuration (docker-compose)</h3>
<div class="paragraph">
<p>The relationships between containers is the most interesting part in this example.</p>
</div>
<div class="listingblock">
<div class="title">docker-reverse-proxy-multi-domain/docker-compose.yaml</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"><span class="hljs-attr">a:</span>
  <span class="hljs-attr">build:</span> <span class="hljs-string">a</span> <b class="conum">(4)</b>
  <span class="hljs-attr">environment:</span>
    <span class="hljs-attr">VIRTUAL_HOST:</span> <span class="hljs-string">a.domain.com</span> <b class="conum">(1)</b>
  <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>

<span class="hljs-attr">b:</span>
  <span class="hljs-attr">build:</span> <span class="hljs-string">b</span> <b class="conum">(5)</b>
  <span class="hljs-attr">environment:</span>
    <span class="hljs-attr">VIRTUAL_HOST:</span>  <span class="hljs-string">b.domain.com</span> <b class="conum">(2)</b>
  <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>

<span class="hljs-attr">nginx-proxy:</span> <b class="conum">(3)</b>
  <span class="hljs-attr">image:</span> <span class="hljs-string">jwilder/nginx-proxy</span>
  <span class="hljs-attr">ports:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;80:80&quot;</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;443:443&quot;</span>
  <span class="hljs-attr">volumes:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">/var/run/docker.sock:/tmp/docker.sock:ro</span>

  <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
  <span class="hljs-attr">privileged:</span> <span class="hljs-literal">true</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Configure the domain name for app a.</p>
</li>
<li>
<p>Configure the domain name for app b.</p>
</li>
<li>
<p>From this line there is proxy configuration (copy/paste part).</p>
</li>
<li>
<p>We tell docker-compose has to build Docker images within specified directory.</p>
</li>
<li>
<p>For example, we are saying that docker-compose has to build a Docker image using ../b/Dockerfile file.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_application_image_configuration">Application Image Configuration</h3>
<div class="listingblock">
<div class="title">a/Dockerfile</div>
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker"><span class="hljs-keyword">FROM</span> httpd:<span class="hljs-number">2.4</span> <b class="conum">(1)</b>
<span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;A&lt;/h1&gt;App A works!&lt;/body&gt;&lt;/html&gt;&quot;</span> &gt; /usr/local/apache2/htdocs/index.html </span><b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>We import an image with an apache server.</p>
</li>
<li>
<p>It serves a file that prints "Host A" as default page.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The configuration for application B is pretty much the same:</p>
</div>
<div class="listingblock">
<div class="title">b/Dockerfile</div>
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker"><span class="hljs-keyword">FROM</span> httpd:<span class="hljs-number">2.4</span>
<span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;B&lt;/h1&gt;App B works!&lt;/body&gt;&lt;/html&gt;&quot;</span> &gt; /usr/local/apache2/htdocs/index.html</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adding_domain_names_to_your_development_environment_configuration">Adding domain names to your development environment configuration</h3>
<div class="paragraph">
<p>In Linux we just have to map the local address to domain names you have chosen, in the example <code>a.domain.com</code> and <code>b.domain.com</code>.</p>
</div>
<div class="listingblock">
<div class="title">/etc/hosts</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">127.0.0.1    localhost.localdomain localhost
::1          localhost6.localdomain6 localhost6
127.0.0.1    a.domain.com <b class="conum">(1)</b>
127.0.0.1    b.domain.com</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>We just added last 2 lines.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_everything_ready">Everything ready!</h3>
<div class="paragraph">
<p>Now we just have to test the example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker-compose build
docker-compose up</code></pre>
</div>
</div>
<div class="paragraph">
<p>The 3 containers are running now.</p>
</div>
<div class="paragraph">
<p>So we can open our favorite web browser and go to <code>a.domain.com</code>. It will show <strong>App A works!</strong>. If we go to <code>b.domain.com</code> then we will see <strong>App B works!</strong>.</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="/posts/reverse-proxy-multidomain-docker/a.screenshot.png" alt="App A works!">
</div>
<div class="title">Figure 1. a.domain.com</div>
</div>
<div class="imageblock center">
<div class="content">
<img src="/posts/reverse-proxy-multidomain-docker/b.screenshot.png" alt="App B works!">
</div>
<div class="title">Figure 2. b.domain.com</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In most of the Linux distros you will need privileges to run Docker commands (<code>sudo</code>).
</td>
</tr>
</table>
</div>
</div>
</div>
</div><!----> <div class="comments"><script src="https://utteranc.es/client.js" repo="carlosvin/carlosvin.github.io" issue-term="title" label="comment" theme="github-light" crossorigin="anonymous" async>
	</script></div><!----></div><!----><!----><!----></main> <footer class="svelte-qhq9sm"><span>Carlos Say's Bla Bla</span> <code>1.0.1</code></footer><!----><!--]--><!----><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_1qhkr5p = {
						base: new URL("../../../..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../../../../_app/immutable/entry/start.Dg2WxSzj.js"),
						import("../../../../_app/immutable/entry/app.DiecyXnG.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 8],
							data: [null,{"type":"data","data":{path:"/langs/en/posts/reverse-proxy-multidomain-docker/",lang:"en",translations:{lang:"en",author:"Carlos Martin Sanchez",siteName:"Carlos Say's Bla Bla",siteDescription:"What is going on in my mind and its surroundings",categories:"categories",Categories:"Categories",RecentPosts:"Recent posts",NoPosts:"There are no posts",SubscribeTo:"Subscribe to the feed",AboutMe:"About me",AllPosts:"All posts"},version:"1.0.1"},"uses":{"params":["lang"],"url":1},"slash":"always"},{"type":"data","data":{html:"\u003Cdiv id=\"toc\" class=\"toc\">\n\u003Cdiv id=\"toctitle\">Table of Contents\u003C/div>\n\u003Cul class=\"sectlevel1\">\n\u003Cli>\u003Ca href=\"#_use_case\">Use case\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#_how_to_configure_multi_domain_reverse_proxy\">How to Configure Multi-Domain Reverse Proxy\u003C/a>\n\u003Cul class=\"sectlevel2\">\n\u003Cli>\u003Ca href=\"#_example_project_structure\">Example Project Structure\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#_architecture_configuration_docker_compose\">Architecture Configuration (docker-compose)\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#_application_image_configuration\">Application Image Configuration\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#_adding_domain_names_to_your_development_environment_configuration\">Adding domain names to your development environment configuration\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#_everything_ready\">Everything ready!\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003C/ul>\n\u003C/div>\n\u003Cdiv class=\"sect1\">\n\u003Ch2 id=\"_use_case\">Use case\u003C/h2>\n\u003Cdiv class=\"sectionbody\">\n\u003Cdiv class=\"paragraph\">\n\u003Cp>We have several server applications in the same development environment, each application is bundled in a Docker container, e.g: \u003Cstrong>\"Container A\"\u003C/strong> and \u003Cstrong>\"Container B\"\u003C/strong>.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>With Docker those applications have the same IP address. One way to differentiate and access to an specific application is exposing different ports.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"imageblock center\">\n\u003Cdiv class=\"content\">\n\u003Cimg src=\"/posts/reverse-proxy-multidomain-docker/ip.png\" alt=\"ip\">\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>Containers exposing the same IP address and different ports.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"ulist\">\n\u003Cul>\n\u003Cli>\n\u003Cp>If we want to call to \u003Cstrong>\"Application A\"\u003C/strong> we will do: \u003Ccode>GET \u003Ca href=\"http://10.20.30.40:8080/colors/red\" class=\"bare\">http://10.20.30.40:8080/colors/red\u003C/a>\u003C/code>.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>If we want to call to \u003Cstrong>\"Application B\"\u003C/strong> we will do: \u003Ccode>GET \u003Ca href=\"http://10.20.30.40:8081/fruits/tomato\" class=\"bare\">http://10.20.30.40:8081/fruits/tomato\u003C/a>\u003C/code>.\u003C/p>\n\u003C/li>\n\u003C/ul>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>But that solution is a little bit confusing, does 8080 mean we are accessing to \"application A\"?\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>It would be \u003Cstrong>simpler and easier\u003C/strong> to remind something like:\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"ulist\">\n\u003Cul>\n\u003Cli>\n\u003Cp>Calling \u003Cstrong>\"Application A\"\u003C/strong>: \u003Ccode>GET \u003Ca href=\"http://a.domain.com/colors/red\" class=\"bare\">http://a.domain.com/colors/red\u003C/a>\u003C/code>.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>Calling \u003Cstrong>\"Application B\"\u003C/strong>: \u003Ccode>GET \u003Ca href=\"http://b.domain.com/fruits/tomato\" class=\"bare\">http://b.domain.com/fruits/tomato\u003C/a>\u003C/code>.\u003C/p>\n\u003C/li>\n\u003C/ul>\n\u003C/div>\n\u003Cdiv class=\"imageblock center\">\n\u003Cdiv class=\"content\">\n\u003Cimg src=\"/posts/reverse-proxy-multidomain-docker/domain.png\" alt=\"domain\">\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>Accessing applications by domain name.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>Get that extra semantic value is much simpler than I thought at the beginning and you will see below.\u003C/p>\n\u003C/div>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"sect1\">\n\u003Ch2 id=\"_how_to_configure_multi_domain_reverse_proxy\">How to Configure Multi-Domain Reverse Proxy\u003C/h2>\n\u003Cdiv class=\"sectionbody\">\n\u003Cdiv class=\"paragraph\">\n\u003Cp>I said it is easy, because we almost have to do nothing, another container will do it for us, especifically we are going to use \u003Ca href=\"https://github.com/jwilder/nginx-proxy\" target=\"_blank\" rel=\"noopener\">nginx-proxy\u003C/a>, it will automatically generate the required \u003Ca href=\"https://www.nginx.com\" target=\"_blank\" rel=\"noopener\">NGINX\u003C/a> configurations.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>So, we will have 2 applications + 1 proxy, that is 3 containers.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"imageblock center\">\n\u003Cdiv class=\"content\">\n\u003Cimg src=\"/posts/reverse-proxy-multidomain-docker/proxy.png\" alt=\"domain\">\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>3 containers, 2 applications and 1 proxy\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"admonitionblock note\">\n\u003Ctable>\n\u003Ctr>\n\u003Ctd class=\"icon\">\n\u003Cdiv class=\"title\">Note\u003C/div>\n\u003C/td>\n\u003Ctd class=\"content\">\nYou can download the full example at \u003Ca href=\"https://github.com/carlosvin/docker-reverse-proxy-multi-domain\" class=\"bare\">https://github.com/carlosvin/docker-reverse-proxy-multi-domain\u003C/a>.\n\u003C/td>\n\u003C/tr>\n\u003C/table>\n\u003C/div>\n\u003Cdiv class=\"sect2\">\n\u003Ch3 id=\"_example_project_structure\">Example Project Structure\u003C/h3>\n\u003Cdiv class=\"dlist\">\n\u003Cdl>\n\u003Cdt class=\"hdlist1\">docker-compose.yaml\u003C/dt>\n\u003Cdd>\n\u003Cp>Main configuration file describing architecture in previous picture.\u003C/p>\n\u003C/dd>\n\u003Cdt class=\"hdlist1\">a\u003C/dt>\n\u003Cdd>\n\u003Cp>Application A directory.\u003C/p>\n\u003Cdiv class=\"dlist\">\n\u003Cdl>\n\u003Cdt class=\"hdlist1\">Dockerfile\u003C/dt>\n\u003Cdd>\n\u003Cp>Container A configuration file.\u003C/p>\n\u003C/dd>\n\u003C/dl>\n\u003C/div>\n\u003C/dd>\n\u003Cdt class=\"hdlist1\">b\u003C/dt>\n\u003Cdd>\n\u003Cp>Application B directory.\u003C/p>\n\u003Cdiv class=\"dlist\">\n\u003Cdl>\n\u003Cdt class=\"hdlist1\">Dockerfile\u003C/dt>\n\u003Cdd>\n\u003Cp>Container B configuration file.\u003C/p>\n\u003C/dd>\n\u003C/dl>\n\u003C/div>\n\u003C/dd>\n\u003C/dl>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>\u003Ca href=\"https://github.com/carlosvin/docker-reverse-proxy-multi-domain\" target=\"_blank\" rel=\"noopener\">View Project\u003C/a>.\u003C/p>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"sect2\">\n\u003Ch3 id=\"_architecture_configuration_docker_compose\">Architecture Configuration (docker-compose)\u003C/h3>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>The relationships between containers is the most interesting part in this example.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"title\">docker-reverse-proxy-multi-domain/docker-compose.yaml\u003C/div>\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-yaml\" data-lang=\"yaml\">\u003Cspan class=\"hljs-attr\">a:\u003C/span>\n  \u003Cspan class=\"hljs-attr\">build:\u003C/span> \u003Cspan class=\"hljs-string\">a\u003C/span> \u003Cb class=\"conum\">(4)\u003C/b>\n  \u003Cspan class=\"hljs-attr\">environment:\u003C/span>\n    \u003Cspan class=\"hljs-attr\">VIRTUAL_HOST:\u003C/span> \u003Cspan class=\"hljs-string\">a.domain.com\u003C/span> \u003Cb class=\"conum\">(1)\u003C/b>\n  \u003Cspan class=\"hljs-attr\">restart:\u003C/span> \u003Cspan class=\"hljs-string\">always\u003C/span>\n\n\u003Cspan class=\"hljs-attr\">b:\u003C/span>\n  \u003Cspan class=\"hljs-attr\">build:\u003C/span> \u003Cspan class=\"hljs-string\">b\u003C/span> \u003Cb class=\"conum\">(5)\u003C/b>\n  \u003Cspan class=\"hljs-attr\">environment:\u003C/span>\n    \u003Cspan class=\"hljs-attr\">VIRTUAL_HOST:\u003C/span>  \u003Cspan class=\"hljs-string\">b.domain.com\u003C/span> \u003Cb class=\"conum\">(2)\u003C/b>\n  \u003Cspan class=\"hljs-attr\">restart:\u003C/span> \u003Cspan class=\"hljs-string\">always\u003C/span>\n\n\u003Cspan class=\"hljs-attr\">nginx-proxy:\u003C/span> \u003Cb class=\"conum\">(3)\u003C/b>\n  \u003Cspan class=\"hljs-attr\">image:\u003C/span> \u003Cspan class=\"hljs-string\">jwilder/nginx-proxy\u003C/span>\n  \u003Cspan class=\"hljs-attr\">ports:\u003C/span>\n    \u003Cspan class=\"hljs-bullet\">-\u003C/span> \u003Cspan class=\"hljs-string\">&quot;80:80&quot;\u003C/span>\n    \u003Cspan class=\"hljs-bullet\">-\u003C/span> \u003Cspan class=\"hljs-string\">&quot;443:443&quot;\u003C/span>\n  \u003Cspan class=\"hljs-attr\">volumes:\u003C/span>\n    \u003Cspan class=\"hljs-bullet\">-\u003C/span> \u003Cspan class=\"hljs-string\">/var/run/docker.sock:/tmp/docker.sock:ro\u003C/span>\n\n  \u003Cspan class=\"hljs-attr\">restart:\u003C/span> \u003Cspan class=\"hljs-string\">always\u003C/span>\n  \u003Cspan class=\"hljs-attr\">privileged:\u003C/span> \u003Cspan class=\"hljs-literal\">true\u003C/span>\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"colist arabic\">\n\u003Col>\n\u003Cli>\n\u003Cp>Configure the domain name for app a.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>Configure the domain name for app b.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>From this line there is proxy configuration (copy/paste part).\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>We tell docker-compose has to build Docker images within specified directory.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>For example, we are saying that docker-compose has to build a Docker image using ../b/Dockerfile file.\u003C/p>\n\u003C/li>\n\u003C/ol>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"sect2\">\n\u003Ch3 id=\"_application_image_configuration\">Application Image Configuration\u003C/h3>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"title\">a/Dockerfile\u003C/div>\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-docker\" data-lang=\"docker\">\u003Cspan class=\"hljs-keyword\">FROM\u003C/span> httpd:\u003Cspan class=\"hljs-number\">2.4\u003C/span> \u003Cb class=\"conum\">(1)\u003C/b>\n\u003Cspan class=\"hljs-keyword\">RUN\u003C/span>\u003Cspan class=\"language-bash\"> \u003Cspan class=\"hljs-built_in\">echo\u003C/span> \u003Cspan class=\"hljs-string\">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;A&lt;/h1&gt;App A works!&lt;/body&gt;&lt;/html&gt;&quot;\u003C/span> &gt; /usr/local/apache2/htdocs/index.html \u003C/span>\u003Cb class=\"conum\">(2)\u003C/b>\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"colist arabic\">\n\u003Col>\n\u003Cli>\n\u003Cp>We import an image with an apache server.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>It serves a file that prints \"Host A\" as default page.\u003C/p>\n\u003C/li>\n\u003C/ol>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>The configuration for application B is pretty much the same:\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"title\">b/Dockerfile\u003C/div>\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-docker\" data-lang=\"docker\">\u003Cspan class=\"hljs-keyword\">FROM\u003C/span> httpd:\u003Cspan class=\"hljs-number\">2.4\u003C/span>\n\u003Cspan class=\"hljs-keyword\">RUN\u003C/span>\u003Cspan class=\"language-bash\"> \u003Cspan class=\"hljs-built_in\">echo\u003C/span> \u003Cspan class=\"hljs-string\">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;B&lt;/h1&gt;App B works!&lt;/body&gt;&lt;/html&gt;&quot;\u003C/span> &gt; /usr/local/apache2/htdocs/index.html\u003C/span>\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"sect2\">\n\u003Ch3 id=\"_adding_domain_names_to_your_development_environment_configuration\">Adding domain names to your development environment configuration\u003C/h3>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>In Linux we just have to map the local address to domain names you have chosen, in the example \u003Ccode>a.domain.com\u003C/code> and \u003Ccode>b.domain.com\u003C/code>.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"title\">/etc/hosts\u003C/div>\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-bash\" data-lang=\"bash\">127.0.0.1    localhost.localdomain localhost\n::1          localhost6.localdomain6 localhost6\n127.0.0.1    a.domain.com \u003Cb class=\"conum\">(1)\u003C/b>\n127.0.0.1    b.domain.com\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"colist arabic\">\n\u003Col>\n\u003Cli>\n\u003Cp>We just added last 2 lines.\u003C/p>\n\u003C/li>\n\u003C/ol>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"sect2\">\n\u003Ch3 id=\"_everything_ready\">Everything ready!\u003C/h3>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>Now we just have to test the example:\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-bash\" data-lang=\"bash\">docker-compose build\ndocker-compose up\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>The 3 containers are running now.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>So we can open our favorite web browser and go to \u003Ccode>a.domain.com\u003C/code>. It will show \u003Cstrong>App A works!\u003C/strong>. If we go to \u003Ccode>b.domain.com\u003C/code> then we will see \u003Cstrong>App B works!\u003C/strong>.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"imageblock center\">\n\u003Cdiv class=\"content\">\n\u003Cimg src=\"/posts/reverse-proxy-multidomain-docker/a.screenshot.png\" alt=\"App A works!\">\n\u003C/div>\n\u003Cdiv class=\"title\">Figure 1. a.domain.com\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"imageblock center\">\n\u003Cdiv class=\"content\">\n\u003Cimg src=\"/posts/reverse-proxy-multidomain-docker/b.screenshot.png\" alt=\"App B works!\">\n\u003C/div>\n\u003Cdiv class=\"title\">Figure 2. b.domain.com\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"admonitionblock note\">\n\u003Ctable>\n\u003Ctr>\n\u003Ctd class=\"icon\">\n\u003Cdiv class=\"title\">Note\u003C/div>\n\u003C/td>\n\u003Ctd class=\"content\">\nIn most of the Linux distros you will need privileges to run Docker commands (\u003Ccode>sudo\u003C/code>).\n\u003C/td>\n\u003C/tr>\n\u003C/table>\n\u003C/div>\n\u003C/div>\n\u003C/div>\n\u003C/div>",props:{title:"Multi-Domain Docker Containers",lang:"en",summary:"How to create different Docker containers with different domain names in the same host",slug:"reverse-proxy-multidomain-docker",keywords:["Docker","Microservices"],filepath:"/static/posts/reverse-proxy-multidomain-docker/reverse-proxy-multidomain-docker.en.adoc",dirpath:"/static/posts/reverse-proxy-multidomain-docker",created:1480017600000,modified:1480017600000,otherLangs:["es"],author:"Carlos Martin Sanchez",previewimage:void 0,path:"/langs/en/posts/reverse-proxy-multidomain-docker"},jsonLd:"\u003Cscript type=\"application/ld+json\">{\"@context\":\"https://schema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"Webpage\",\"@id\":\"https://google.com/article\"},\"headline\":\"Multi-Domain Docker Containers\",\"alternativeHeadline\":\"How to create different Docker containers with different domain names in the same host\",\"description\":\"How to create different Docker containers with different domain names in the same host\",\"datePublished\":\"2016-11-24T20:00:00.000Z\",\"dateModified\":\"2016-11-24T20:00:00.000Z\",\"keywords\":[\"Docker\",\"Microservices\"],\"author\":{\"@type\":\"Person\",\"name\":\"Carlos Martin Sanchez\"},\"publisher\":{\"@type\":\"Person\",\"name\":\"Carlos Martin Sanchez\"}}\u003C/script>"},"uses":{"params":["slug","lang"]}}],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
