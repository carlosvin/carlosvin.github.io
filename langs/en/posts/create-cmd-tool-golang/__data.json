{"type":"data","nodes":[null,{"type":"data","data":[{"path":1,"lang":2,"translations":3,"version":14},"/langs/en/posts/create-cmd-tool-golang/","en",{"lang":2,"author":4,"siteName":5,"siteDescription":6,"categories":7,"Categories":8,"RecentPosts":9,"NoPosts":10,"SubscribeTo":11,"AboutMe":12,"AllPosts":13},"Carlos Martin Sanchez","Carlos Say's Bla Bla","What is going on in my mind and its surroundings","categories","Categories","Recent posts","There are no posts","Subscribe to the feed","About me","All posts","1.0.1"],"uses":{"params":["lang"],"url":1},"slash":"always"},{"type":"data","data":[{"html":1,"props":2,"jsonLd":19},"\u003Cdiv id=\"toc\" class=\"toc\">\n\u003Cdiv id=\"toctitle\">Table of Contents\u003C/div>\n\u003Cul class=\"sectlevel1\">\n\u003Cli>\u003Ca href=\"#_flags\">Flags\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#_viper\">Viper\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#_meta_viper\">Meta-Viper\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/div>\n\u003Cdiv id=\"preamble\">\n\u003Cdiv class=\"sectionbody\">\n\u003Cdiv class=\"paragraph\">\n\u003Cp>\u003Ca href=\"https://golang.org/\" target=\"_blank\" rel=\"noopener\">Golang\u003C/a> is the one of the most useful technologies I&#8217;ve recently learned. \u003Ca href=\"https://golang.org/\" target=\"_blank\" rel=\"noopener\">Golang\u003C/a> has a pretty nice support for networking, command line or logging out of the box, you don&#8217;t need any dependency. But there are libraries making developers' life even easier.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>I&#8217;ve already talked about \u003Ca href=\"/langs/en/posts/rest-service-go-vs-java/\" target=\"blank_\">creating REST service in go\u003C/a>, today I&#8217;d like to focus on creating a command line tool.\u003C/p>\n\u003C/div>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"sect1\">\n\u003Ch2 id=\"_flags\">Flags\u003C/h2>\n\u003Cdiv class=\"sectionbody\">\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"title\">Command line tool to read number of lines as an input integer parameter \u003Ca href=\"https://golang.org/\" target=\"_blank\" rel=\"noopener\">Golang\u003C/a>\u003C/div>\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-go\" data-lang=\"go\">\u003Cspan class=\"hljs-keyword\">package\u003C/span> main\n\n\u003Cspan class=\"hljs-keyword\">import\u003C/span> (\n\t\u003Cspan class=\"hljs-string\">&quot;flag&quot;\u003C/span>\n\t\u003Cspan class=\"hljs-string\">&quot;fmt&quot;\u003C/span>\n)\n\n\u003Cspan class=\"hljs-function\">\u003Cspan class=\"hljs-keyword\">func\u003C/span> \u003Cspan class=\"hljs-title\">main\u003C/span>\u003Cspan class=\"hljs-params\">()\u003C/span>\u003C/span> {\n\t\u003Cspan class=\"hljs-keyword\">var\u003C/span> nFlag = flag.Int(\u003Cspan class=\"hljs-string\">&quot;lines&quot;\u003C/span>, \u003Cspan class=\"hljs-number\">1234\u003C/span>, \u003Cspan class=\"hljs-string\">&quot;number of lines&quot;\u003C/span>)\n\tflag.Parse()\n\tfmt.Printf(\u003Cspan class=\"hljs-string\">&quot;Lines %d\\n&quot;\u003C/span>, *nFlag)\n}\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>With previous simple code we have already some useful capabilities\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"title\">Print help menu\u003C/div>\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-bash\" data-lang=\"bash\">$ cmd --\u003Cspan class=\"hljs-built_in\">help\u003C/span>\n\n&gt; Usage of cmd:\n    -lines int\n        number of lines (default 1234)\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"title\">Use default value\u003C/div>\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-bash\" data-lang=\"bash\">$ cmd\n\n&gt; Lines 1234\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"title\">Pass a value to the command tool\u003C/div>\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-bash\" data-lang=\"bash\">$ cmd --lines=2\n\n&gt; Lines 2\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"title\">Pass an invalid value\u003C/div>\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-bash\" data-lang=\"bash\">$ cmd --lines=asdf\n\n&gt; invalid value \u003Cspan class=\"hljs-string\">&quot;asdf&quot;\u003C/span> \u003Cspan class=\"hljs-keyword\">for\u003C/span> flag -lines: parse error\nUsage of cmd:\n    -lines int\n        number of lines (default 1234)\n\u003Cspan class=\"hljs-built_in\">exit\u003C/span> status 2\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>For a simple command line tool, in most of the cases, we will have enough with the default language support. But if we want to bring more features to the combo like reading configuration from environment variables or from files, then a library like the awesome \u003Ca href=\"https://github.com/spf13/viper\" target=\"_blank\" rel=\"noopener\">Viper\u003C/a> will come really handy.\u003C/p>\n\u003C/div>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"sect1\">\n\u003Ch2 id=\"_viper\">Viper\u003C/h2>\n\u003Cdiv class=\"sectionbody\">\n\u003Cdiv class=\"paragraph\">\n\u003Cp>\u003Ca href=\"https://github.com/spf13/viper\" target=\"_blank\" rel=\"noopener\">Viper\u003C/a> is very powerful and well documented library widely used from many projects, I will not get into the details or how to use it, because I&#8217;ve created an abstraction to simplify its usage, I named it \u003Ca href=\"https://github.com/carlosvin/meta-viper\" target=\"_blank\" rel=\"noopener\">Meta-Viper\u003C/a>.\u003C/p>\n\u003C/div>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"sect1\">\n\u003Ch2 id=\"_meta_viper\">Meta-Viper\u003C/h2>\n\u003Cdiv class=\"sectionbody\">\n\u003Cdiv class=\"paragraph\">\n\u003Cp>\u003Ca href=\"https://github.com/carlosvin/meta-viper\" target=\"_blank\" rel=\"noopener\">Meta-Viper\u003C/a> abstracts you of the details of reading configuration from files, environment or flags. This extra simplicity comes with a tradeoff, we are missing some flexibility.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>Let&#8217;s see some features with an example.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"title\">Firstly we have to create a go modules project with the meta-viper dependency\u003C/div>\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-bash\" data-lang=\"bash\">go mod init example.com/meta-viper \u003Cb class=\"conum\">(1)\u003C/b>\n\ngo get github.com/carlosvin/meta-viper \u003Cb class=\"conum\">(2)\u003C/b>\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"colist arabic\">\n\u003Col>\n\u003Cli>\n\u003Cp>Create a go modules project\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>Install the meta-viper dependency\u003C/p>\n\u003C/li>\n\u003C/ol>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>Now let&#8217;s create a program that is configurable from files, command line params and environment variables.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"title\">main.go\u003C/div>\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-go\" data-lang=\"go\">\u003Cspan class=\"hljs-keyword\">package\u003C/span> main\n\n\u003Cspan class=\"hljs-keyword\">import\u003C/span> (\n\t\u003Cspan class=\"hljs-string\">&quot;log&quot;\u003C/span>\n\t\u003Cspan class=\"hljs-string\">&quot;os&quot;\u003C/span>\n\n\tconfig \u003Cspan class=\"hljs-string\">&quot;github.com/carlosvin/meta-viper&quot;\u003C/span>\n)\n\n\u003Cspan class=\"hljs-comment\">// Here is where you define the struct that will hold the configuration values\u003C/span>\n\u003Cspan class=\"hljs-comment\">// cfg_name is the parameter name\u003C/span>\n\u003Cspan class=\"hljs-comment\">// cfg_desc is the parameter description that will be shown in the command line help\u003C/span>\n\u003Cspan class=\"hljs-keyword\">type\u003C/span> appConfig \u003Cspan class=\"hljs-keyword\">struct\u003C/span> {\n\tHost      \u003Cspan class=\"hljs-type\">string\u003C/span> \u003Cspan class=\"hljs-string\">`cfg_name:&quot;host&quot; cfg_desc:&quot;Server host&quot;`\u003C/span>\n\tPort      \u003Cspan class=\"hljs-type\">int\u003C/span>    \u003Cspan class=\"hljs-string\">`cfg_name:&quot;port&quot; cfg_desc:&quot;Server port&quot;`\u003C/span>\n\tSearchAPI \u003Cspan class=\"hljs-type\">string\u003C/span> \u003Cspan class=\"hljs-string\">`cfg_name:&quot;apis.search&quot; cfg_desc:&quot;Search API endpoint&quot;`\u003C/span>\n}\n\n\u003Cspan class=\"hljs-function\">\u003Cspan class=\"hljs-keyword\">func\u003C/span> \u003Cspan class=\"hljs-title\">main\u003C/span>\u003Cspan class=\"hljs-params\">()\u003C/span>\u003C/span> {\n\t\u003Cspan class=\"hljs-comment\">// Instantiate the structure with default values\u003C/span>\n\tcfg := &amp;appConfig{\n\t\tHost:      \u003Cspan class=\"hljs-string\">&quot;localhost&quot;\u003C/span>,\n\t\tPort:      \u003Cspan class=\"hljs-number\">6000\u003C/span>,\n\t\tSearchAPI: \u003Cspan class=\"hljs-string\">&quot;google&quot;\u003C/span>,\n\t}\n\n\t\u003Cspan class=\"hljs-comment\">// Meta-Viper instance is loading the configuration from wherever is available: files, env, or input params\u003C/span>\n\t_, err := config.New(cfg, os.Args)\n\t\u003Cspan class=\"hljs-keyword\">if\u003C/span> err != \u003Cspan class=\"hljs-literal\">nil\u003C/span> {\n\t\t\u003Cspan class=\"hljs-built_in\">panic\u003C/span>(err)\n\t}\n\tlog.Printf(\u003Cspan class=\"hljs-string\">&quot;Loaded Configuration %v...&quot;\u003C/span>, cfg)\n}\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>Now let&#8217;s see some examples how this command line tool is able to load configuration.\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"title\">Print usage (help)\u003C/div>\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-bash\" data-lang=\"bash\">$ cmd --\u003Cspan class=\"hljs-built_in\">help\u003C/span>\n\nUsage of flagsConfig:\n    --apis.search string    Search API endpoint (default \u003Cspan class=\"hljs-string\">&quot;google&quot;\u003C/span>)\n    --config string         Configuration name\n    --config-dirs strings   Configuration directories search paths (default [.,config,configs,cfg])\n    --host string           Server host (default \u003Cspan class=\"hljs-string\">&quot;localhost&quot;\u003C/span>)\n    --port int              Server port (default 6000)\npflag: \u003Cspan class=\"hljs-built_in\">help\u003C/span> requested\n\u003Cspan class=\"hljs-built_in\">exit\u003C/span> status 2\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"title\">Run with default values\u003C/div>\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-bash\" data-lang=\"bash\">$ cmd\n\n2021/02/15 23:12:48 No configuration name has been specified, so no configuration file will be loaded. Using flags and environment variables.\n2021/02/15 23:12:48 Loaded Configuration &amp;{localhost 6000 google}...\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"title\">Read the port from environment variable and host from input param\u003C/div>\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-bash\" data-lang=\"bash\">$ PORT=9999 cmd --host=myhost\n\n2021/02/15 23:15:47 No configuration name has been specified, so no configuration file will be loaded. Using flags and environment variables.\n2021/02/15 23:15:47 Loaded Configuration &amp;{myhost 9999 google}...\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"paragraph\">\n\u003Cp>The last example will aggregate all the possible sources of configuration, it will extend the previous one adding configuration from a file. So let&#8217;s create a configuration file:\u003C/p>\n\u003C/div>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"title\">the-config.json\u003C/div>\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-json\" data-lang=\"json\">\u003Cspan class=\"hljs-punctuation\">{\u003C/span>\n\t\u003Cspan class=\"hljs-attr\">&quot;apis&quot;\u003C/span>\u003Cspan class=\"hljs-punctuation\">:\u003C/span> \u003Cspan class=\"hljs-punctuation\">{\u003C/span>\n\t\t\u003Cspan class=\"hljs-attr\">&quot;search&quot;\u003C/span>\u003Cspan class=\"hljs-punctuation\">:\u003C/span> \u003Cspan class=\"hljs-string\">&quot;duckduckgo&quot;\u003C/span>\n\t\u003Cspan class=\"hljs-punctuation\">}\u003C/span>\n\u003Cspan class=\"hljs-punctuation\">}\u003C/span>\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"listingblock\">\n\u003Cdiv class=\"title\">Read configuration from the-config.json file, from environment and from input params\u003C/div>\n\u003Cdiv class=\"content\">\n\u003Cpre class=\"highlight\">\u003Ccode class=\"language-bash\" data-lang=\"bash\">$ PORT=9999 cmd --host=myhost --config=the-config\n\n2021/02/15 23:22:17 Loaded Configuration &amp;{myhost 9999 duckduckgo}...\u003C/code>\u003C/pre>\n\u003C/div>\n\u003C/div>\n\u003Cdiv class=\"admonitionblock tip\">\n\u003Ctable>\n\u003Ctr>\n\u003Ctd class=\"icon\">\n\u003Cdiv class=\"title\">Tip\u003C/div>\n\u003C/td>\n\u003Ctd class=\"content\">\nHere you can find a \u003Ca href=\"https://github.com/carlosvin/meta-viper/tree/master/examples/multi-env\" target=\"_blank\" rel=\"noopener\">multi-environment example\u003C/a> a little bit more complete.\n\u003C/td>\n\u003C/tr>\n\u003C/table>\n\u003C/div>\n\u003C/div>\n\u003C/div>",{"title":3,"lang":4,"summary":5,"slug":6,"keywords":7,"filepath":11,"dirpath":12,"created":13,"modified":13,"otherLangs":14,"author":16,"previewimage":17,"path":18},"Easily creating a golang command line tool","en","Let's see how to easily and quickly create a command line tool in golang","create-cmd-tool-golang",[8,9,10],"Golang","cmd","tools","/static/posts/create-cmd-tool-golang/create-cmd-tool-golang.adoc","/static/posts/create-cmd-tool-golang",1613260800000,[15],"es","Carlos Martin Sanchez","https://golang.org/lib/godoc/images/go-logo-blue.svg","/langs/en/posts/create-cmd-tool-golang","\u003Cscript type=\"application/ld+json\">{\"@context\":\"https://schema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"Webpage\",\"@id\":\"https://google.com/article\"},\"headline\":\"Easily creating a golang command line tool\",\"alternativeHeadline\":\"Let's see how to easily and quickly create a command line tool in golang\",\"description\":\"Let's see how to easily and quickly create a command line tool in golang\",\"image\":\"https://golang.org/lib/godoc/images/go-logo-blue.svg\",\"datePublished\":\"2021-02-14T00:00:00.000Z\",\"dateModified\":\"2021-02-14T00:00:00.000Z\",\"keywords\":[\"Golang\",\"cmd\",\"tools\"],\"author\":{\"@type\":\"Person\",\"name\":\"Carlos Martin Sanchez\"},\"publisher\":{\"@type\":\"Person\",\"name\":\"Carlos Martin Sanchez\"}}\u003C/script>"],"uses":{"params":["slug","lang"]}}]}
