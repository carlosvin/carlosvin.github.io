{# JSON-LD structured data for blog posts #}
{# Set common variables #}
{% set page_title = title | default(value=config.title) %}
{% set page_description = description | default(value=config.description) %}
{% set canonical_url = page.permalink | default(value=current_url) | default(value=config.base_url) %}
{% set og_image = page.preview_image | default(value=config.extra.preview_image) %}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      "@id": "{{ config.base_url }}/#website",
      "url": "{{ config.base_url }}",
      "name": "{{ config.title }}",
      "description": "{{ config.description }}",
      "publisher": {
        "@id": "{{ config.base_url }}/#person"
      },
      "potentialAction": [
        {
          "@type": "SearchAction",
          "target": {
            "@type": "EntryPoint",
            "urlTemplate": "{{ config.base_url }}/search?q={search_term_string}"
          },
          "query-input": "required name=search_term_string"
        }
      ]
    },
    {
      "@type": "Person",
      "@id": "{{ config.base_url }}/#person",
      "name": "{{ config.author }}",
      "url": "{{ config.base_url }}",
      "sameAs": [
        {% if config.extra.social_links -%}
        {% for social in config.extra.social_links -%}
        "{{ social.url }}"{% if not loop.last %},{% endif %}
        {% endfor -%}
        {% endif %}
      ]
    },
    {% if page %}
    {
      "@type": "BlogPosting",
      "@id": "{{ canonical_url }}/#article",
      "isPartOf": {
        "@id": "{{ config.base_url }}/#website"
      },
      "author": {
        "@id": "{{ config.base_url }}/#person"
      },
      "headline": "{{ page_title }}",
      "description": "{{ page_description }}",
      "datePublished": "{{ page.date | date(format='%Y-%m-%dT%H:%M:%SZ') }}",
      {% if page.updated -%}
      "dateModified": "{{ page.updated | date(format='%Y-%m-%dT%H:%M:%SZ') }}",
      {% else -%}
      "dateModified": "{{ page.date | date(format='%Y-%m-%dT%H:%M:%SZ') }}",
      {% endif -%}
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "{{ canonical_url }}"
      },
      "url": "{{ canonical_url }}",
      "image": {% if og_image %}"{{ og_image }}"{% else %}null{% endif %},
      "publisher": {
        "@id": "{{ config.base_url }}/#person"
      },
      "articleSection": "{{ section.title | default(value='Blog') }}",
      {% if page.taxonomies.tags -%}
      "keywords": [
        {% for tag in page.taxonomies.tags -%}
        "{{ tag }}"{% if not loop.last %},{% endif %}
        {% endfor %}
      ],
      {% endif -%}
      "inLanguage": "{{ page.lang | default(value=config.default_language) | default(value='en') }}",
      "wordCount": {{ page.word_count | default(value=0) }},
      "copyrightYear": {{ page.date | date(format='%Y') }},
      "copyrightHolder": {
        "@id": "{{ config.base_url }}/#person"
      }
    },
    {
      "@type": "WebPage",
      "@id": "{{ canonical_url }}",
      "url": "{{ canonical_url }}",
      "name": "{{ page_title }}",
      "isPartOf": {
        "@id": "{{ config.base_url }}/#website"
      },
      "about": {
        "@id": "{{ canonical_url }}/#article"
      },
      "description": "{{ page_description }}",
      "breadcrumb": {
        "@id": "{{ canonical_url }}/#breadcrumb"
      },
      "inLanguage": "{{ page.lang | default(value=config.default_language) | default(value='en') }}",
      "potentialAction": [
        {
          "@type": "ReadAction",
          "target": ["{{ canonical_url }}"]
        }
      ]
    },
    {
      "@type": "BreadcrumbList",
      "@id": "{{ canonical_url }}/#breadcrumb",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "{{ config.base_url }}"
        },
        {% if section.title -%}
        {
          "@type": "ListItem",
          "position": 2,
          "name": "{{ section.title }}",
          "item": "{{ get_url(path=section.path) }}"
        },
        {
          "@type": "ListItem",
          "position": 3,
          "name": "{{ page_title }}",
          "item": "{{ canonical_url }}"
        }
        {% else -%}
        {
          "@type": "ListItem",
          "position": 2,
          "name": "{{ page_title }}",
          "item": "{{ canonical_url }}"
        }
        {% endif -%}
      ]
    }
    {% else %}
    {
      "@type": "WebPage",
      "@id": "{{ canonical_url }}",
      "url": "{{ canonical_url }}",
      "name": "{{ page_title }}",
      "isPartOf": {
        "@id": "{{ config.base_url }}/#website"
      },
      "description": "{{ page_description }}",
      "inLanguage": "{{ config.default_language | default(value='en') }}"
    }
    {% endif %}
  ]
}
</script>