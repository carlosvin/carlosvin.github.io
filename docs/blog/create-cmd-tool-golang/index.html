<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Easily creating a golang command line tool</title>

  <meta name="author" content="Carlos Martin Sanchez" />
  <link rel="stylesheet" href="https://carlosvin.github.io/css/base.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
  <link rel="icon" href="https://carlosvin.github.io/img/favicon.png" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/elasticlunr/0.9.6/elasticlunr.min.js"
    integrity="sha512-0QarUp4p9r5IqUgSRyP89BHga45OpEd7VR8lbRkJkf48p/EhcU742fWUpKpoDyu9N6XYAEq/vz6m6z1OolnsDw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="speculationrules">
    {
    "prerender": [
        {
        "where": {
            "selector_matches": "a"
        }
        }
    ]
    }
  </script>

  
  <meta name="description" content="Let&#x27;s see how to easily and quickly create a command line tool in golang" />
  
</head>

<body class="container">
  <header>
    <nav>
      <ul>
        <li><strong><a href="https://carlosvin.github.io">Carlos says bla, bla</a></strong></li>
      </ul>
      <ul>
        
        <li>
          <a href="https://carlosvin.github.io/blog">Blog</a>
        </li>
        
        <li>
          <a href="https://carlosvin.github.io/about">About</a>
        </li>
        
        <li>
          <input id="search" type="search" placeholder="Search the posts" aria-label="Search">
        </li>
      </ul>
    </nav>
    <div class="search-container">
      <div class="search-results">
        <div class="search-results__items"></div>
      </div>
    </div>

  </header>

  <main>
    
<article class="post">
  <header>
    <h1 class="post-title">Easily creating a golang command line tool</h1>
    <div class="post-meta">
      
      <time datetime=" 2021-02-14">
        February 14, 2021
      </time>
      
      
      
    </div>
  </header>

  
<ul>
  
  <li>
    <a href="https://carlosvin.github.io/blog/create-cmd-tool-golang/#flags">Flags</a>
    
    <ul>
      
      <li>
        <a href="https://carlosvin.github.io/blog/create-cmd-tool-golang/#print-help-menu">Print help menu</a>
      </li>
      
      <li>
        <a href="https://carlosvin.github.io/blog/create-cmd-tool-golang/#use-default-value">Use default value</a>
      </li>
      
      <li>
        <a href="https://carlosvin.github.io/blog/create-cmd-tool-golang/#pass-a-value-to-the-command-tool">Pass a value to the command tool</a>
      </li>
      
      <li>
        <a href="https://carlosvin.github.io/blog/create-cmd-tool-golang/#pass-an-invalid-value">Pass an invalid value</a>
      </li>
      
    </ul>
    
  </li>
  
  <li>
    <a href="https://carlosvin.github.io/blog/create-cmd-tool-golang/#viper">Viper</a>
    
  </li>
  
  <li>
    <a href="https://carlosvin.github.io/blog/create-cmd-tool-golang/#meta-viper">Meta-Viper</a>
    
    <ul>
      
      <li>
        <a href="https://carlosvin.github.io/blog/create-cmd-tool-golang/#firstly-create-a-go-modules-project-with-the-meta-viper-dependency">Firstly, create a go modules project with the meta-viper dependency</a>
      </li>
      
      <li>
        <a href="https://carlosvin.github.io/blog/create-cmd-tool-golang/#print-usage-help">Print usage (help)</a>
      </li>
      
      <li>
        <a href="https://carlosvin.github.io/blog/create-cmd-tool-golang/#run-with-default-values">Run with default values</a>
      </li>
      
      <li>
        <a href="https://carlosvin.github.io/blog/create-cmd-tool-golang/#read-the-port-from-environment-variable-and-host-from-input-param">Read the port from environment variable and host from input param</a>
      </li>
      
      <li>
        <a href="https://carlosvin.github.io/blog/create-cmd-tool-golang/#read-configuration-from-the-config-json-file-from-environment-and-from-input-params">Read configuration from the-config.json file, from environment and from input params</a>
      </li>
      
    </ul>
    
  </li>
  
</ul>


  <section class="post-content">
    <p><a href="https://golang.org/">Golang</a> is one of the most useful technologies I've recently learned. Golang has pretty nice support for networking, command line, or logging out of the boxâ€”you don't need any dependency. But there are libraries making developers' life even easier.</p>
<p>I've already talked about <a href="/langs/en/posts/rest-service-go-vs-java/">creating REST service in go</a>, today I'd like to focus on creating a command line tool.</p>
<h2 id="flags">Flags</h2>
<p>Command line tool to read number of lines as an input integer parameter (Golang):</p>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span style="color:#b48ead;">package </span><span style="color:#bf616a;">main
</span><span>
</span><span style="color:#b48ead;">import </span><span>(
</span><span> &quot;</span><span style="color:#a3be8c;">flag</span><span>&quot;
</span><span> &quot;</span><span style="color:#a3be8c;">fmt</span><span>&quot;
</span><span>)
</span><span>
</span><span style="color:#b48ead;">func </span><span style="color:#8fa1b3;">main</span><span>() {
</span><span> </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">nFlag </span><span>= </span><span style="color:#bf616a;">flag</span><span>.</span><span style="color:#bf616a;">Int</span><span>(&quot;</span><span style="color:#a3be8c;">lines</span><span>&quot;, </span><span style="color:#d08770;">1234</span><span>, &quot;</span><span style="color:#a3be8c;">number of lines</span><span>&quot;)
</span><span> </span><span style="color:#bf616a;">flag</span><span>.</span><span style="color:#bf616a;">Parse</span><span>()
</span><span> </span><span style="color:#bf616a;">fmt</span><span>.</span><span style="color:#bf616a;">Printf</span><span>(&quot;</span><span style="color:#a3be8c;">Lines </span><span style="color:#d08770;">%d</span><span style="color:#96b5b4;">\n</span><span>&quot;, *</span><span style="color:#bf616a;">nFlag</span><span>)
</span><span>}
</span></code></pre>
<p>With previous simple code we have already some useful capabilities:</p>
<h3 id="print-help-menu">Print help menu</h3>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> cmd</span><span style="color:#bf616a;"> --help
</span><span>
</span><span>&gt; Usage </span><span style="color:#bf616a;">of</span><span> cmd:
</span><span>    </span><span style="color:#bf616a;">-lines</span><span> int
</span><span>        </span><span style="color:#bf616a;">number</span><span> of lines (default 1234)
</span></code></pre>
<h3 id="use-default-value">Use default value</h3>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> cmd
</span><span>
</span><span>&gt; Lines </span><span style="color:#bf616a;">1234
</span></code></pre>
<h3 id="pass-a-value-to-the-command-tool">Pass a value to the command tool</h3>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> cmd</span><span style="color:#bf616a;"> --lines</span><span>=2
</span><span>
</span><span>&gt; Lines </span><span style="color:#bf616a;">2
</span></code></pre>
<h3 id="pass-an-invalid-value">Pass an invalid value</h3>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> cmd</span><span style="color:#bf616a;"> --lines</span><span>=asdf
</span><span>
</span><span>&gt; invalid </span><span style="color:#bf616a;">value </span><span>&quot;</span><span style="color:#a3be8c;">asdf</span><span>&quot; for flag</span><span style="color:#bf616a;"> -lines</span><span>: parse error
</span><span style="color:#bf616a;">Usage</span><span> of cmd:
</span><span>    </span><span style="color:#bf616a;">-lines</span><span> int
</span><span>        </span><span style="color:#bf616a;">number</span><span> of lines (default 1234)
</span><span style="color:#96b5b4;">exit</span><span> status 2
</span></code></pre>
<p>For a simple command line tool, in most cases, we will have enough with the default language support. But if we want to bring more features to the combo like reading configuration from environment variables or from files, then a library like the awesome <a href="https://github.com/spf13/viper">Viper</a> will come really handy.</p>
<h2 id="viper">Viper</h2>
<p>Viper is a very powerful and well-documented library widely used in many projects. I will not get into the details of how to use it, because I've created an abstraction to simplify its usage, I named it <a href="https://github.com/carlosvin/meta-viper">Meta-Viper</a>.</p>
<h2 id="meta-viper">Meta-Viper</h2>
<p><a href="https://github.com/carlosvin/meta-viper">Meta-Viper</a> abstracts you from the details of reading configuration from files, environment, or flags. This extra simplicity comes with a tradeoff: we are missing some flexibility.</p>
<p>Let's see some features with an example.</p>
<h3 id="firstly-create-a-go-modules-project-with-the-meta-viper-dependency">Firstly, create a go modules project with the meta-viper dependency</h3>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">go</span><span> mod init example.com/meta-viper </span><span style="color:#65737e;"># Create a go modules project
</span><span style="color:#bf616a;">go</span><span> get github.com/carlosvin/meta-viper </span><span style="color:#65737e;"># Install the meta-viper dependency
</span></code></pre>
<p>Now let's create a program that is configurable from files, command line params, and environment variables.</p>
<p><strong>main.go</strong></p>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span style="color:#b48ead;">package </span><span style="color:#bf616a;">main
</span><span>
</span><span style="color:#b48ead;">import </span><span>(
</span><span> &quot;</span><span style="color:#a3be8c;">log</span><span>&quot;
</span><span> &quot;</span><span style="color:#a3be8c;">os</span><span>&quot;
</span><span>
</span><span> </span><span style="color:#bf616a;">config </span><span>&quot;</span><span style="color:#a3be8c;">github.com/carlosvin/meta-viper</span><span>&quot;
</span><span>)
</span><span>
</span><span style="color:#65737e;">// Here is where you define the struct that will hold the configuration values
</span><span style="color:#65737e;">// cfg_name is the parameter name
</span><span style="color:#65737e;">// cfg_desc is the parameter description that will be shown in the command line help
</span><span style="color:#b48ead;">type </span><span>appConfig </span><span style="color:#b48ead;">struct </span><span>{
</span><span> </span><span style="color:#bf616a;">Host      </span><span style="color:#b48ead;">string </span><span>`</span><span style="color:#a3be8c;">cfg_name:&quot;host&quot; cfg_desc:&quot;Server host&quot;</span><span>`
</span><span> </span><span style="color:#bf616a;">Port      </span><span style="color:#b48ead;">int    </span><span>`</span><span style="color:#a3be8c;">cfg_name:&quot;port&quot; cfg_desc:&quot;Server port&quot;</span><span>`
</span><span> </span><span style="color:#bf616a;">SearchAPI </span><span style="color:#b48ead;">string </span><span>`</span><span style="color:#a3be8c;">cfg_name:&quot;apis.search&quot; cfg_desc:&quot;Search API endpoint&quot;</span><span>`
</span><span>}
</span><span>
</span><span style="color:#b48ead;">func </span><span style="color:#8fa1b3;">main</span><span>() {
</span><span> </span><span style="color:#65737e;">// Instantiate the structure with default values
</span><span> </span><span style="color:#bf616a;">cfg </span><span>:= &amp;</span><span style="color:#bf616a;">appConfig</span><span>{
</span><span>  </span><span style="color:#bf616a;">Host</span><span>:      &quot;</span><span style="color:#a3be8c;">localhost</span><span>&quot;,
</span><span>  </span><span style="color:#bf616a;">Port</span><span>:      </span><span style="color:#d08770;">6000</span><span>,
</span><span>  </span><span style="color:#bf616a;">SearchAPI</span><span>: &quot;</span><span style="color:#a3be8c;">google</span><span>&quot;,
</span><span> }
</span><span>
</span><span> </span><span style="color:#65737e;">// Meta-Viper instance is loading the configuration from wherever is available: files, env, or input params
</span><span> </span><span style="color:#bf616a;">_</span><span>, </span><span style="color:#bf616a;">err </span><span>:= </span><span style="color:#bf616a;">config</span><span>.</span><span style="color:#bf616a;">New</span><span>(</span><span style="color:#bf616a;">cfg</span><span>, </span><span style="color:#bf616a;">os</span><span>.</span><span style="color:#bf616a;">Args</span><span>)
</span><span> </span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">err </span><span>!= </span><span style="color:#d08770;">nil </span><span>{
</span><span>  </span><span style="color:#96b5b4;">panic</span><span>(</span><span style="color:#bf616a;">err</span><span>)
</span><span> }
</span><span> </span><span style="color:#bf616a;">log</span><span>.</span><span style="color:#bf616a;">Printf</span><span>(&quot;</span><span style="color:#a3be8c;">Loaded Configuration </span><span style="color:#d08770;">%v</span><span style="color:#a3be8c;">...</span><span>&quot;, </span><span style="color:#bf616a;">cfg</span><span>)
</span><span>}
</span></code></pre>
<p>Now let's see some examples of how this command line tool is able to load configuration.</p>
<h3 id="print-usage-help">Print usage (help)</h3>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> cmd</span><span style="color:#bf616a;"> --help
</span><span>
</span><span style="color:#bf616a;">Usage</span><span> of flagsConfig:
</span><span>    </span><span style="color:#bf616a;">--apis.search</span><span> string    Search API endpoint (default &quot;</span><span style="color:#a3be8c;">google</span><span>&quot;)
</span><span>    </span><span style="color:#bf616a;">--config</span><span> string         Configuration name
</span><span>    </span><span style="color:#bf616a;">--config-dirs</span><span> strings   Configuration directories search paths (default </span><span style="color:#b48ead;">[</span><span>.,config,configs,cfg</span><span style="color:#b48ead;">]</span><span>)
</span><span>    </span><span style="color:#bf616a;">--host</span><span> string           Server host (default &quot;</span><span style="color:#a3be8c;">localhost</span><span>&quot;)
</span><span>    </span><span style="color:#bf616a;">--port</span><span> int              Server port (default 6000)
</span><span style="color:#bf616a;">pflag:</span><span> help requested
</span><span style="color:#96b5b4;">exit</span><span> status 2
</span></code></pre>
<h3 id="run-with-default-values">Run with default values</h3>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> cmd
</span><span>
</span><span style="color:#bf616a;">2021/02/15</span><span> 23:12:48 No configuration name has been specified, so no configuration file will be loaded. Using flags and environment variables.
</span><span style="color:#bf616a;">2021/02/15</span><span> 23:12:48 Loaded Configuration &amp;</span><span style="color:#bf616a;">{localhost</span><span> 6000 google}</span><span style="color:#bf616a;">...
</span></code></pre>
<h3 id="read-the-port-from-environment-variable-and-host-from-input-param">Read the port from environment variable and host from input param</h3>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> PORT=9999 cmd</span><span style="color:#bf616a;"> --host</span><span>=myhost
</span><span>
</span><span style="color:#bf616a;">2021/02/15</span><span> 23:15:47 No configuration name has been specified, so no configuration file will be loaded. Using flags and environment variables.
</span><span style="color:#bf616a;">2021/02/15</span><span> 23:15:47 Loaded Configuration &amp;</span><span style="color:#bf616a;">{myhost</span><span> 9999 google}</span><span style="color:#bf616a;">...
</span></code></pre>
<p>The last example will aggregate all the possible sources of configuration, it will extend the previous one adding configuration from a file. So let's create a configuration file:</p>
<p><strong>the-config.json</strong></p>
<pre data-lang="json" style="background-color:#2b303b;color:#c0c5ce;" class="language-json "><code class="language-json" data-lang="json"><span>{
</span><span> &quot;</span><span style="color:#a3be8c;">apis</span><span>&quot;: {
</span><span>  &quot;</span><span style="color:#a3be8c;">search</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">duckduckgo</span><span>&quot;
</span><span> }
</span><span>}
</span></code></pre>
<h3 id="read-configuration-from-the-config-json-file-from-environment-and-from-input-params">Read configuration from the-config.json file, from environment and from input params</h3>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> PORT=9999 cmd</span><span style="color:#bf616a;"> --host</span><span>=myhost</span><span style="color:#bf616a;"> --config</span><span>=the-config
</span><span>
</span><span style="color:#bf616a;">2021/02/15</span><span> 23:22:17 Loaded Configuration &amp;</span><span style="color:#bf616a;">{myhost</span><span> 9999 duckduckgo}</span><span style="color:#bf616a;">...
</span></code></pre>
<p>TIP: Here you can find a <a href="https://github.com/carlosvin/meta-viper/tree/master/examples/multi-env">multi-environment example</a> a little bit more complete.</p>

  </section>

  <footer>
    <script src="https://utteranc.es/client.js" repo="carlosvin/carlosvin.github.io" issue-term="title"
      theme="github-light" crossorigin="anonymous" async defer>
      </script>
  </footer>
</article>

    <script src="/js/search.js"></script>

  </main>

  <footer>
    <nav>
      <small>&copy; 2025 Carlos Martin Sanchez | Powered by <a
          href="https://www.getzola.org/">Zola</a>
      </small>
      <span style="display: flex; gap: 1rem; align-items: flex-end;">
  <a href="https://github.com/carlosvin" target="_blank" rel="noopener">
    <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/github/github-original.svg" alt="GitHub" width="32"
      height="32" />
  </a>
  <a href="https://linkedin.com/in/carlosvin" target="_blank" rel="noopener">
    <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/linkedin/linkedin-original.svg" alt="LinkedIn"
      width="32" height="32" />
  </a>
</span>
    </nav>
  </footer>

  <script src="https://carlosvin.github.io/js/search.js"></script>
</body>

</html>