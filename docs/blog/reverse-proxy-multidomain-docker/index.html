<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Multi-Domain Docker Containers - Carlos says bla, bla</title>
  <link rel="stylesheet" href="https://carlosvin.github.io/css/base.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
  <link rel="icon" href="https://carlosvin.github.io/img/favicon.png" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/elasticlunr/0.9.6/elasticlunr.min.js"
    integrity="sha512-0QarUp4p9r5IqUgSRyP89BHga45OpEd7VR8lbRkJkf48p/EhcU742fWUpKpoDyu9N6XYAEq/vz6m6z1OolnsDw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="speculationrules">
    {
    "prerender": [
        {
        "where": {
            "selector_matches": "a"
        }
        }
    ]
    }
  </script>
</head>

<body class="container">
  <header>
    <nav>
      <ul>
        <li><strong><a href="https://carlosvin.github.io">Carlos says bla, bla</a></strong></li>
      </ul>
      <ul>
        
        <li>
          <a href="https://carlosvin.github.io/blog">Blog</a>
        </li>
        
        <li>
          <a href="https://carlosvin.github.io/about">About</a>
        </li>
        
        <li>
          <input id="search" type="search" placeholder="Search the posts" aria-label="Search">
        </li>
      </ul>

    </nav>
    <div class="search-container">
      <div class="search-results">
        <div class="search-results__items"></div>
      </div>
    </div>

  </header>

  <main>
    
<article class="post">
  <header>
    <h1 class="post-title">Multi-Domain Docker Containers</h1>
    <div class="post-meta">
      
      <time datetime=" 2016-11-24">
        November 24, 2016
      </time>
      
      
      
    </div>
  </header>

  
<ul>
  
  <li>
    <a href="https://carlosvin.github.io/blog/reverse-proxy-multidomain-docker/#use-case">Use case</a>
    
  </li>
  
  <li>
    <a href="https://carlosvin.github.io/blog/reverse-proxy-multidomain-docker/#how-to-configure-multi-domain-reverse-proxy">How to Configure Multi-Domain Reverse Proxy</a>
    
    <ul>
      
      <li>
        <a href="https://carlosvin.github.io/blog/reverse-proxy-multidomain-docker/#example-project-structure">Example Project Structure</a>
      </li>
      
      <li>
        <a href="https://carlosvin.github.io/blog/reverse-proxy-multidomain-docker/#architecture-configuration-docker-compose">Architecture Configuration (docker-compose)</a>
      </li>
      
      <li>
        <a href="https://carlosvin.github.io/blog/reverse-proxy-multidomain-docker/#docker-reverse-proxy-multi-domain-docker-compose-yaml">docker-reverse-proxy-multi-domain&#x2F;docker-compose.yaml</a>
      </li>
      
      <li>
        <a href="https://carlosvin.github.io/blog/reverse-proxy-multidomain-docker/#application-image-configuration">Application Image Configuration</a>
      </li>
      
      <li>
        <a href="https://carlosvin.github.io/blog/reverse-proxy-multidomain-docker/#a-dockerfile">a&#x2F;Dockerfile</a>
      </li>
      
      <li>
        <a href="https://carlosvin.github.io/blog/reverse-proxy-multidomain-docker/#b-dockerfile">b&#x2F;Dockerfile</a>
      </li>
      
      <li>
        <a href="https://carlosvin.github.io/blog/reverse-proxy-multidomain-docker/#adding-domain-names-to-your-development-environment-configuration">Adding domain names to your development environment configuration</a>
      </li>
      
      <li>
        <a href="https://carlosvin.github.io/blog/reverse-proxy-multidomain-docker/#etc-hosts">&#x2F;etc&#x2F;hosts</a>
      </li>
      
      <li>
        <a href="https://carlosvin.github.io/blog/reverse-proxy-multidomain-docker/#everything-ready">Everything ready</a>
      </li>
      
    </ul>
    
  </li>
  
</ul>


  <section class="post-content">
    <h2 id="use-case">Use case</h2>
<p>We have several server applications in the same development environment, each application is bundled in a Docker container, e.g: <strong>"Container A"</strong> and <strong>"Container B"</strong>.</p>
<p>With Docker those applications have the same IP address. One way to differentiate and access to an specific application is exposing different ports.</p>
<p><img src="https://carlosvin.github.io/blog/reverse-proxy-multidomain-docker/ip.png" alt="Containers exposing the same IP address and different ports." /></p>
<ul>
<li>If we want to call to <strong>"Application A"</strong> we will do: <code>GET http://10.20.30.40:8080/colors/red</code>.</li>
<li>If we want to call to <strong>"Application B"</strong> we will do: <code>GET http://10.20.30.40:8081/fruits/tomato</code>.</li>
</ul>
<p>But that solution is a little bit confusing, does 8080 mean we are accessing to "application A"?</p>
<p>It would be <strong>simpler and easier</strong> to remind something like:</p>
<ul>
<li>Calling <strong>"Application A"</strong>: <code>GET http://a.domain.com/colors/red</code>.</li>
<li>Calling <strong>"Application B"</strong>: <code>GET http://b.domain.com/fruits/tomato</code>.</li>
</ul>
<p><img src="https://carlosvin.github.io/blog/reverse-proxy-multidomain-docker/domain.png" alt="Accessing applications by domain name." /></p>
<p>Get that extra semantic value is much simpler than I thought at the beginning and you will see below.</p>
<h2 id="how-to-configure-multi-domain-reverse-proxy">How to Configure Multi-Domain Reverse Proxy</h2>
<p>I said it is easy, because we almost have to do nothing, another container will do it for us, especifically we are going to use <a href="https://github.com/jwilder/nginx-proxy">nginx-proxy</a>, it will automatically generate the required <a href="https://www.nginx.com">NGINX</a> configurations.</p>
<p>So, we will have 2 applications + 1 proxy, that is 3 containers.</p>
<p><img src="https://carlosvin.github.io/blog/reverse-proxy-multidomain-docker/proxy.png" alt="3 containers, 2 applications and 1 proxy" /></p>
<blockquote>
<p><strong>Note</strong>: You can download the full example at <a href="https://github.com/carlosvin/docker-reverse-proxy-multi-domain">https://github.com/carlosvin/docker-reverse-proxy-multi-domain</a>.</p>
</blockquote>
<h3 id="example-project-structure">Example Project Structure</h3>
<ul>
<li><strong>docker-compose.yaml</strong>: Main configuration file describing architecture in previous picture.</li>
<li><strong>a</strong>: Application A directory.
<ul>
<li><strong>Dockerfile</strong>: Container A configuration file.</li>
</ul>
</li>
<li><strong>b</strong>: Application B directory.
<ul>
<li><strong>Dockerfile</strong>: Container B configuration file.</li>
</ul>
</li>
</ul>
<p><a href="https://github.com/carlosvin/docker-reverse-proxy-multi-domain">View Project</a></p>
<h3 id="architecture-configuration-docker-compose">Architecture Configuration (docker-compose)</h3>
<p>The relationships between containers is the most interesting part in this example.</p>
<h3 id="docker-reverse-proxy-multi-domain-docker-compose-yaml">docker-reverse-proxy-multi-domain/docker-compose.yaml</h3>
<pre data-lang="yaml" style="background-color:#2b303b;color:#c0c5ce;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#bf616a;">a</span><span>:
</span><span>  </span><span style="color:#bf616a;">build</span><span>: </span><span style="color:#a3be8c;">a                </span><span style="color:#65737e;"># (4)
</span><span>  </span><span style="color:#bf616a;">environment</span><span>:
</span><span>    </span><span style="color:#bf616a;">VIRTUAL_HOST</span><span>: </span><span style="color:#a3be8c;">a.domain.com    </span><span style="color:#65737e;"># (1)
</span><span>  </span><span style="color:#bf616a;">restart</span><span>: </span><span style="color:#a3be8c;">always
</span><span>
</span><span style="color:#bf616a;">b</span><span>:
</span><span>  </span><span style="color:#bf616a;">build</span><span>: </span><span style="color:#a3be8c;">b                </span><span style="color:#65737e;"># (5)
</span><span>  </span><span style="color:#bf616a;">environment</span><span>:
</span><span>    </span><span style="color:#bf616a;">VIRTUAL_HOST</span><span>:  </span><span style="color:#a3be8c;">b.domain.com   </span><span style="color:#65737e;"># (2)
</span><span>  </span><span style="color:#bf616a;">restart</span><span>: </span><span style="color:#a3be8c;">always
</span><span>
</span><span style="color:#bf616a;">nginx-proxy</span><span>:              </span><span style="color:#65737e;"># (3)
</span><span>  </span><span style="color:#bf616a;">image</span><span>: </span><span style="color:#a3be8c;">jwilder/nginx-proxy
</span><span>  </span><span style="color:#bf616a;">ports</span><span>:
</span><span>    - &quot;</span><span style="color:#a3be8c;">80:80</span><span>&quot;
</span><span>    - &quot;</span><span style="color:#a3be8c;">443:443</span><span>&quot;
</span><span>  </span><span style="color:#bf616a;">volumes</span><span>:
</span><span>    - </span><span style="color:#a3be8c;">/var/run/docker.sock:/tmp/docker.sock:ro
</span><span>
</span><span>  </span><span style="color:#bf616a;">restart</span><span>: </span><span style="color:#a3be8c;">always
</span><span>  </span><span style="color:#bf616a;">privileged</span><span>: </span><span style="color:#d08770;">true
</span></code></pre>
<ol>
<li>Configure the domain name for app a.</li>
<li>Configure the domain name for app b.</li>
<li>From this line there is proxy configuration (copy/paste part).</li>
<li>We tell docker-compose has to build Docker images within specified directory.</li>
<li>For example, we are saying that docker-compose has to build a Docker image using ../b/Dockerfile file.</li>
</ol>
<h3 id="application-image-configuration">Application Image Configuration</h3>
<h3 id="a-dockerfile">a/Dockerfile</h3>
<pre data-lang="dockerfile" style="background-color:#2b303b;color:#c0c5ce;" class="language-dockerfile "><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#b48ead;">FROM</span><span> httpd:2.4                       # (1)
</span><span style="color:#b48ead;">RUN </span><span>echo &quot;</span><span style="color:#a3be8c;">&lt;html&gt;&lt;body&gt;&lt;h1&gt;A&lt;/h1&gt;App A works!&lt;/body&gt;&lt;/html&gt;</span><span>&quot; &gt; /usr/local/apache2/htdocs/index.html  # (2)
</span></code></pre>
<ol>
<li>We import an image with an apache server.</li>
<li>It serves a file that prints "Host A" as default page.</li>
</ol>
<p>The configuration for application B is pretty much the same:</p>
<h3 id="b-dockerfile">b/Dockerfile</h3>
<pre data-lang="dockerfile" style="background-color:#2b303b;color:#c0c5ce;" class="language-dockerfile "><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#b48ead;">FROM</span><span> httpd:2.4
</span><span style="color:#b48ead;">RUN </span><span>echo &quot;</span><span style="color:#a3be8c;">&lt;html&gt;&lt;body&gt;&lt;h1&gt;B&lt;/h1&gt;App B works!&lt;/body&gt;&lt;/html&gt;</span><span>&quot; &gt; /usr/local/apache2/htdocs/index.html
</span></code></pre>
<h3 id="adding-domain-names-to-your-development-environment-configuration">Adding domain names to your development environment configuration</h3>
<p>In Linux we just have to map the local address to domain names you have chosen, in the example <code>a.domain.com</code> and <code>b.domain.com</code>.</p>
<h3 id="etc-hosts">/etc/hosts</h3>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">127.0.0.1</span><span>    localhost.localdomain localhost
</span><span style="color:#bf616a;">::1</span><span>          localhost6.localdomain6 localhost6
</span><span style="color:#bf616a;">127.0.0.1</span><span>    a.domain.com         </span><span style="color:#65737e;"># (1)
</span><span style="color:#bf616a;">127.0.0.1</span><span>    b.domain.com
</span></code></pre>
<ol>
<li>We just added last 2 lines.</li>
</ol>
<h3 id="everything-ready">Everything ready</h3>
<p>Now we just have to test the example:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">docker-compose</span><span> build
</span><span style="color:#bf616a;">docker-compose</span><span> up
</span></code></pre>
<p>The 3 containers are running now.</p>
<p>So we can open our favorite web browser and go to <code>a.domain.com</code>. It will show <strong>App A works!</strong>. If we go to <code>b.domain.com</code> then we will see <strong>App B works!</strong>.</p>
<p><img src="https://carlosvin.github.io/blog/reverse-proxy-multidomain-docker/a.screenshot.png" alt="App A works!" /></p>
<p><img src="https://carlosvin.github.io/blog/reverse-proxy-multidomain-docker/b.screenshot.png" alt="App B works!" /></p>
<blockquote>
<p><strong>Note</strong>: In most of the Linux distros you will need privileges to run Docker commands (<code>sudo</code>).</p>
</blockquote>

  </section>

  <footer>
  </footer>
</article>

    <script src="/js/search.js"></script>

  </main>

  <footer class="grid">
    <span>&copy; 2025 Carlos says bla, bla</span>
    <span style="display: flex; gap: 1rem; align-items: flex-end;">
  <a href="https://github.com/carlosvin" target="_blank" rel="noopener">
    <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/github/github-original.svg" alt="GitHub" width="32"
      height="32" />
  </a>
  <a href="https://linkedin.com/in/carlosvin" target="_blank" rel="noopener">
    <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/linkedin/linkedin-original.svg" alt="LinkedIn"
      width="32" height="32" />
  </a>
</span>
  </footer>

  <script src="https://carlosvin.github.io/js/search.js"></script>
</body>

</html>